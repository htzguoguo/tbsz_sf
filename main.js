!function(e){function t(n){if(r[n])return r[n].exports;var a=r[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var r={};t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=93)}([function(e,t){e.exports=require("express")},function(e,t,r){"use strict";var n=function(e){return e&&e.__esModule?e:{default:e}}(r(47));e.exports.InternalServerError=function(e,t,r){var n={error:{code:"bf-500",message:t.message,context:r}};e.status(500),e.setHeader("Content-Type","application/json"),e.json(n)},e.exports.BadRequest=function(e,t,r){var n={error:{code:"bf-400",message:t,context:r}};e.status(400),e.setHeader("Content-Type","application/json"),e.json(n)},e.exports.ResourceNotFound=function(e,t,r){var n={error:{code:"bf-404",message:r||"Not Found",context:t}};e.status(404),e.setHeader("Content-Type","application/json"),e.json(n)},e.exports.ResourceDeleted=function(e){e.status(204),e.end()},e.exports.ResourceCreated=function(e,t){e.status(201),e.setHeader("Content-Type","application/json"),t?e.json(t):e.json({data:"Created"})},e.exports.ResourceUpdated=function(e,t){e.status(201),e.setHeader("Content-Type","application/json"),t?e.json(t):e.json({data:"Updated"})},e.exports.ResourceFound=function(e,t){var r=t;e.status(200),e.setHeader("Content-Type","application/json"),e.json(r)},e.exports.NotAuthorized=function(e,t){var r={error:{code:"bf-401",message:"Not Authorized",context:{url:e.url}}};t.status(401).json(r)},e.exports.ConvertNullToZeroString=function(e){var t=function(e){(0,n.default)(e).forEach(function(t){null===e[t]&&(e[t]="")})};Array.isArray(e)?e.forEach(function(e){return t(e)}):t(e)}},function(e,t){var r=e.exports={version:"2.5.1"};"number"==typeof __e&&(__e=r)},function(e,t,r){e.exports=r(98)},function(e,t,r){"use strict";t.__esModule=!0;var n=function(e){return e&&e.__esModule?e:{default:e}}(r(55));t.default=function(e){return function(){var t=e.apply(this,arguments);return new n.default(function(e,r){function a(u,s){try{var o=t[u](s),c=o.value}catch(e){return void r(e)}if(!o.done)return n.default.resolve(c).then(function(e){a("next",e)},function(e){a("throw",e)});e(c)}return a("next")})}}},function(e,t,r){var n=r(6),a=r(2),u=r(16),s=r(17),o="prototype",c=function(e,t,r){var i,p,l,f=e&c.F,d=e&c.G,y=e&c.S,h=e&c.P,m=e&c.B,v=e&c.W,x=d?a:a[t]||(a[t]={}),w=x[o],b=d?n:y?n[t]:(n[t]||{})[o];d&&(r=t);for(i in r)(p=!f&&b&&void 0!==b[i])&&i in x||(l=p?b[i]:r[i],x[i]=d&&"function"!=typeof b[i]?r[i]:m&&p?u(l,n):v&&b[i]==l?function(e){var t=function(t,r,n){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,r)}return new e(t,r,n)}return e.apply(this,arguments)};return t[o]=e[o],t}(l):h&&"function"==typeof l?u(Function.call,l):l,h&&((x.virtual||(x.virtual={}))[i]=l,e&c.R&&w&&!w[i]&&s(w,i,l)))};c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,c.U=64,c.R=128,e.exports=c},function(e,t){var r=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(e,t,r){var n=r(60)("wks"),a=r(41),u=r(6).Symbol,s="function"==typeof u;(e.exports=function(e){return n[e]||(n[e]=s&&u[e]||(s?u:a)("Symbol."+e))}).store=n},function(e,t,r){"use strict";var n=new(r(19))("TBSZ2000","sa","ghjsj",{host:"61.136.61.40",dialect:"mssql",dialectOptions:{options:{tdsVersion:"7_3_A"}},pool:{max:5,min:0,acquire:3e4,idle:1e4}});e.exports=n},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("webpack")},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t){e.exports=require("dateformat")},function(e,t,r){var n=r(14),a=r(101),u=r(102),s=Object.defineProperty;t.f=r(15)?Object.defineProperty:function(e,t,r){if(n(e),t=u(t,!0),n(r),a)try{return s(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(e[t]=r.value),e}},function(e,t,r){var n=r(11);e.exports=function(e){if(!n(e))throw TypeError(e+" is not an object!");return e}},function(e,t,r){e.exports=!r(18)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(e,t,r){var n=r(20);e.exports=function(e,t,r){if(n(e),void 0===t)return e;switch(r){case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,a){return e.call(t,r,n,a)}}return function(){return e.apply(t,arguments)}}},function(e,t,r){var n=r(13),a=r(58);e.exports=r(15)?function(e,t,r){return n.f(e,t,a(1,r))}:function(e,t,r){return e[t]=r,e}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t){e.exports=require("sequelize")},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t){var r={}.hasOwnProperty;e.exports=function(e,t){return r.call(e,t)}},function(e,t){e.exports={}},function(e,t){var r={}.toString;e.exports=function(e){return r.call(e).slice(8,-1)}},function(e,t,r){var n=r(16),a=r(113),u=r(114),s=r(14),o=r(39),c=r(64),i={},p={};(t=e.exports=function(e,t,r,l,f){var d,y,h,m,v=f?function(){return e}:c(e),x=n(r,l,t?2:1),w=0;if("function"!=typeof v)throw TypeError(e+" is not iterable!");if(u(v)){for(d=o(e.length);d>w;w++)if((m=t?x(s(y=e[w])[0],y[1]):x(e[w]))===i||m===p)return m}else for(h=v.call(e);!(y=h.next()).done;)if((m=a(h,x,y.value,t))===i||m===p)return m}).BREAK=i,t.RETURN=p},function(e,t){e.exports=require("webpack-merge")},function(e,t){e.exports=require("fs")},function(e,t,r){"use strict";var n=r(51),a=r(26),u=r(9);e.exports.toExcel=function(e,t,r){var s=a.readFileSync(u.join("./","assets","excel",e+".xlsx")),o=new n(s);return o.substitute(t,r),o.generate({type:"base64"})},e.exports.toExcelMultiSheets=function(e,t,r){for(var s=a.readFileSync(u.join("./","assets","excel",e+".xlsx")),o=new n(s),c=0;c<t.length;c++)o.substitute(t[c],r[c]);return o.generate({type:"base64"})}},function(e,t,r){var n=r(106),a=r(61);e.exports=Object.keys||function(e){return n(e,a)}},function(e,t,r){var n=r(38),a=r(35);e.exports=function(e){return n(a(e))}},function(e,t,r){var n=r(13).f,a=r(21),u=r(7)("toStringTag");e.exports=function(e,t,r){e&&!a(e=r?e:e.prototype,u)&&n(e,u,{configurable:!0,value:t})}},function(e,t,r){var n=r(35);e.exports=function(e){return Object(n(e))}},function(e,t,r){"use strict";var n=r(9),a={root:n.join(__dirname,"../../"),app:n.join(__dirname,"../../app"),build:n.join(__dirname,"../../build"),style:n.join(__dirname,"../../app/styles/index.less"),antStyle:n.join(__dirname,"../../node_modules/antd/dist/antd.css"),test:n.join(__dirname,"../../tests"),node_modules:n.join(__dirname,"../../node_modules")};e.exports=a},function(e,t,r){"use strict";var n=r(100)(!0);r(36)(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,r=this._i;return r>=t.length?{value:void 0,done:!0}:(e=n(t,r),this._i+=e.length,{value:e,done:!1})})},function(e,t){var r=Math.ceil,n=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?n:r)(e)}},function(e,t){e.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,r){"use strict";var n=r(57),a=r(5),u=r(103),s=r(17),o=r(21),c=r(22),i=r(104),p=r(30),l=r(109),f=r(7)("iterator"),d=!([].keys&&"next"in[].keys()),y="values",h=function(){return this};e.exports=function(e,t,r,m,v,x,w){i(r,t,m);var b,E,S,k=function(e){if(!d&&e in C)return C[e];switch(e){case"keys":case y:return function(){return new r(this,e)}}return function(){return new r(this,e)}},g=t+" Iterator",T=v==y,F=!1,C=e.prototype,q=C[f]||C["@@iterator"]||v&&C[v],I=q||k(v),A=v?T?k("entries"):I:void 0,L="Array"==t?C.entries||q:q;if(L&&(S=l(L.call(new e)))!==Object.prototype&&S.next&&(p(S,g,!0),n||o(S,f)||s(S,f,h)),T&&q&&q.name!==y&&(F=!0,I=function(){return q.call(this)}),n&&!w||!d&&!F&&C[f]||s(C,f,I),c[t]=I,c[g]=h,v)if(b={values:T?I:k(y),keys:x?I:k("keys"),entries:A},w)for(E in b)E in C||u(C,E,b[E]);else a(a.P+a.F*(d||F),t,b);return b}},function(e,t,r){var n=r(11),a=r(6).document,u=n(a)&&n(a.createElement);e.exports=function(e){return u?a.createElement(e):{}}},function(e,t,r){var n=r(23);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==n(e)?e.split(""):Object(e)}},function(e,t,r){var n=r(34),a=Math.min;e.exports=function(e){return e>0?a(n(e),9007199254740991):0}},function(e,t,r){var n=r(60)("keys"),a=r(41);e.exports=function(e){return n[e]||(n[e]=a(e))}},function(e,t){var r=0,n=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++r+n).toString(36))}},function(e,t,r){r(110);for(var n=r(6),a=r(17),u=r(22),s=r(7)("toStringTag"),o="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),c=0;c<o.length;c++){var i=o[c],p=n[i],l=p&&p.prototype;l&&!l[s]&&a(l,s,i),u[i]=u.Array}},function(e,t,r){var n=r(23),a=r(7)("toStringTag"),u="Arguments"==n(function(){return arguments}());e.exports=function(e){var t,r,s;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),a))?r:u?n(t):"Object"==(s=n(t))&&"function"==typeof t.callee?"Arguments":s}},function(e,t){e.exports=function(e,t,r,n){if(!(e instanceof t)||void 0!==n&&n in e)throw TypeError(r+": incorrect invocation!");return e}},function(e,t,r){"use strict";var n=r(20);e.exports.f=function(e){return new function(e){var t,r;this.promise=new e(function(e,n){if(void 0!==t||void 0!==r)throw TypeError("Bad Promise constructor");t=e,r=n}),this.resolve=n(t),this.reject=n(r)}(e)}},function(e,t,r){var n=r(17);e.exports=function(e,t,r){for(var a in t)r&&e[a]?e[a]=t[a]:n(e,a,t[a]);return e}},function(e,t,r){e.exports={default:r(121),__esModule:!0}},function(e,t,r){e.exports={default:r(168),__esModule:!0}},function(e,t,r){e.exports={default:r(170),__esModule:!0}},function(e,t,r){"use strict";t.__esModule=!0;var n=function(e){return e&&e.__esModule?e:{default:e}}(r(86));t.default=n.default||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}},function(e,t){e.exports=require("xlsx-template")},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){e[t]&&e[t].length>0&&(e[t]="%"+e[t]+"%")}function u(e,t,r,n,a,u){e[t]&&e[t].length>=1&&(u.push(r),n&&(a[n]=e[t]))}var s=n(r(50)),o=n(r(3)),c=n(r(4)),i=function(){var e=(0,c.default)(o.default.mark(function e(t,r){var n,a,u;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.pinyin,e.prev=1,a="\n        Select * from 水费单位基本信息查询 where 用户拼音 like :py \n        ",e.next=5,ue.query(a,{replacements:{py:"%"+n+"%"},type:ue.QueryTypes.SELECT});case 5:u=e.sent,ae.ResourceFound(r,u),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),ae.InternalServerError(r,e.t0,n);case 12:case"end":return e.stop()}},e,this,[[1,9]])}));return function(t,r){return e.apply(this,arguments)}}(),p=function(){var e=(0,c.default)(o.default.mark(function e(t,r){var n,a;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.num,e.prev=1,e.next=4,l(n);case 4:a=e.sent,ae.ResourceFound(r,a),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),ae.InternalServerError(r,e.t0,n);case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),l=function(){var e=(0,c.default)(o.default.mark(function e(t){var r,n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r="\n    Select 编号, 户名, 开户行行名 , 开户行行号, 银行代码, 帐号 , \n    帐户地址 ,组织代码,协议书号,业务种类,托收联系人 ,\n    托收电话,联系人,电话,区号,用水日期,装表日期,使用期限,\n    水贴费状态,水贴费,管径,申请水量,定额,装表费,节门状态,\n    现场负责,装表地点,退续用手续,拆表日期,表损日期,换表日期,\n    单位性质编号,用水形式编号,收费形式编号,抄表形式编号,\n    防火标准编号,扣水单位编号,用户简称,用户拼音 \n        from 水费单位信息 where 扣水单位编号=:num\n    ",e.next=3,ue.query(r,{replacements:{num:t},type:ue.QueryTypes.SELECT});case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),f=function(){var e=(0,c.default)(o.default.mark(function e(t,r){var n,a;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.num,e.prev=1,e.next=4,d(n);case 4:a=e.sent,ae.ResourceFound(r,a),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),ae.InternalServerError(r,e.t0,n);case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),d=function(){var e=(0,c.default)(o.default.mark(function e(t){var r,n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r="\n    Select 编号, 户名, 开户行行名 , 开户行行号, 银行代码, 帐号 , \n    帐户地址 ,组织代码,协议书号,业务种类,托收联系人 ,\n    托收电话,联系人,电话,区号,用水日期,装表日期,使用期限,\n    水贴费状态,水贴费,管径,申请水量,定额,装表费,节门状态,\n    现场负责,装表地点,退续用手续,拆表日期,表损日期,换表日期,\n    单位性质编号,用水形式编号,收费形式编号,抄表形式编号,\n    防火标准编号,扣水单位编号,用户简称,用户拼音 \n        from 水费单位信息 where 编号=:num\n    ",e.next=3,ue.query(r,{replacements:{num:t},type:ue.QueryTypes.SELECT});case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),y=function(){var e=(0,c.default)(o.default.mark(function e(t,r){var n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,h();case 3:n=e.sent,ae.ResourceFound(r,n),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),ae.InternalServerError(r,e.t0,{});case 10:case"end":return e.stop()}},e,this,[[0,7]])}));return function(t,r){return e.apply(this,arguments)}}(),h=function(){var e=(0,c.default)(o.default.mark(function e(){var t,r,n,a,u,s,c,i,p,l,f,d,y,h,m,v,x;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t={},r="\n    SELECT  * from 水费字典银行代码 order by 使用次数 desc \n    ",e.next=4,ue.query(r,{replacements:{},type:ue.QueryTypes.SELECT});case 4:return n=e.sent,t.banks=n,a="\n    SELECT  distinct 管径 from 水费单位信息 \n    ",e.next=9,ue.query(a,{replacements:{},type:ue.QueryTypes.SELECT});case 9:return u=e.sent,t.pipes=u,s="\n    SELECT 区号,单价 from 水费字典费用标准\n    ",e.next=14,ue.query(s,{replacements:{},type:ue.QueryTypes.SELECT});case 14:return c=e.sent,t.chargestandard=c,i="\n    SELECT * from 水费字典单位性质 \n    ",e.next=19,ue.query(i,{replacements:{},type:ue.QueryTypes.SELECT});case 19:return p=e.sent,t.unitkinds=p,l="\n    SELECT * from 水费字典用水形式 \n    ",e.next=24,ue.query(l,{replacements:{},type:ue.QueryTypes.SELECT});case 24:return f=e.sent,t.usekinds=f,d="\n    SELECT * from 水费字典抄表形式 \n    ",e.next=29,ue.query(d,{replacements:{},type:ue.QueryTypes.SELECT});case 29:return y=e.sent,t.inputkinds=y,h="\n    SELECT * from 水费字典收费形式 \n    ",e.next=34,ue.query(h,{replacements:{},type:ue.QueryTypes.SELECT});case 34:return m=e.sent,t.chargekinds=m,v="\n    SELECT 防火标准编号,管径,防火费 from 水费字典防火标准\n    ",e.next=39,ue.query(v,{replacements:{},type:ue.QueryTypes.SELECT});case 39:return x=e.sent,t.firestandard=x,e.abrupt("return",t);case 42:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),m=function(){var e=(0,c.default)(o.default.mark(function e(t,r){var n,a,u;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.name,e.prev=1,a="\n        Select 开户行行号,银行代码,帐号位数,帐号相同位数,帐号相同代码,\n        是否验证,业务种类 from 水费字典银行代码 \n            where 开户行行名=:name\n        ",e.next=5,ue.query(a,{replacements:{name:n},type:ue.QueryTypes.SELECT});case 5:u=e.sent,ae.ResourceFound(r,u),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),ae.InternalServerError(r,e.t0,n);case 12:case"end":return e.stop()}},e,this,[[1,9]])}));return function(t,r){return e.apply(this,arguments)}}(),v=function(){var e=(0,c.default)(o.default.mark(function e(t,r){var n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,x(n);case 4:"1"===e.sent?ae.ResourceUpdated(r,"编号"+n.编号+"用水企业信息更新完成！"):ae.ResourceCreated(r,"编号"+n.编号+"用水企业信息添加完成！"),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),ae.InternalServerError(r,e.t0,{num:n.编号});case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),x=function(){var e=(0,c.default)(o.default.mark(function e(t){var r,n,a,u,s,c,i,p,l,f,d,y,h,m,v,x,w,b,E,S,k,g,T,F,C,q,I,A,L,R,_,Q,N,D,M,U,O,j,B,P,H,W,z,G,J,K;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.编号,n=t.户名,a=t.开户行行名,u=t.帐号,s=t.联系人,c=t.电话,i=t.用水日期,p=t.装表日期,l=t.使用期限,f=t.水贴费状态,d=t.水贴费,y=t.管径,h=t.定额,m=t.申请水量,v=t.装表费,x=t.节门状态,w=t.现场负责,b=t.装表地点,E=t.退续用手续,S=t.拆表日期,k=t.表损日期,g=t.换表日期,T=t.区号,F=t.单位性质编号,C=t.用水形式编号,q=t.收费形式编号,I=t.抄表形式编号,A=t.防火标准编号,L=t.扣水单位编号,R=t.用户简称,_=t.用户拼音,Q=t.组织代码,N=t.帐户地址,D=t.开户行行号,M=t.托收联系人,U=t.托收电话,O=t.协议书号,j=t.银行代码,B=t.业务种类,P="\n    select 编号 from 水费单位信息 where 编号 =:num          \n    ",H={a1:r||"",a2:n||"",a3:a||"",a4:u||"",a5:s||"",a6:c||"",a7:i||"",a8:p||"",a9:l||"",a18:b||"",a16:x||"",a12:y?parseInt(y):"0",a13:h?parseFloat(h).toFixed(2):"0",a14:m?parseFloat(m).toFixed(2):"0",a10:f||"",a11:parseFloat(d).toFixed(2),a15:parseFloat(v).toFixed(2),a17:w||"",a19:E||"",a20:S||"",a21:k||"",a22:g||"",a23:T,a24:F&&F.length>0?F:T,a25:C,a26:q,a27:I,a29:L||"",a30:R||"",a31:_||"",a32:Q||"",a33:N||"",a34:D||"",a35:M||"",a36:U||"",a37:O||"",a38:j||"",a39:B||"",a28:A||""},e.next=5,ue.query(P,{replacements:{num:r},type:ue.QueryTypes.SELECT});case 5:if(W=e.sent,z=void 0,!(W.length>0)){e.next=14;break}return G="\n        update 水费单位信息 set  户名=:a2,开户行行名=:a3,帐号=:a4,联系人=:a5,电话=:a6,用水日期=:a7,装表日期=:a8,使用期限=:a9,水贴费状态=:a10,水贴费=:a11,管径=:a12,定额=:a13,申请水量=:a14, \n        装表费=:a15,节门状态=:a16,现场负责=:a17,装表地点=:a18,退续用手续=:a19,拆表日期=:a20,表损日期=:a21,换表日期=:a22,\n        区号=:a23,单位性质编号=:a24,用水形式编号=:a25,收费形式编号=:a26,抄表形式编号=:a27,防火标准编号=:a28,扣水单位编号=:a29,\n        用户简称=:a30,用户拼音=:a31,组织代码=:a32,帐户地址=:a33,开户行行号=:a34,托收联系人=:a35,托收电话=:a36,协议书号=:a37,银行代码=:a38,业务种类=:a39    \n            where 编号 =:a1 \n        ",e.next=11,ue.query(G,{replacements:H,type:ue.QueryTypes.UPDATE});case 11:z="1",e.next=18;break;case 14:return J="\n        Insert Into 水费单位信息 (编号,户名,开户行行名,帐号,联系人,电话,用水日期,装表日期,使用期限,水贴费状态,水贴费,管径,定额,申请水量,\n            装表费,节门状态,现场负责,装表地点,退续用手续,拆表日期,表损日期,换表日期,区号,单位性质编号,用水形式编号,收费形式编号,抄表形式编号,防火标准编号,扣水单位编号,\n            用户简称,用户拼音,组织代码,帐户地址,开户行行号,托收联系人,托收电话,协议书号,银行代码,业务种类 )\n            Values (:a1,:a2,:a3,:a4,:a5,:a6,:a7,:a8,:a9,     :a10,  :a11, :a12,:a13,    :a14,\n                :a15,    :a16,    :a17,    :a18,      :a19,     :a20,   :a21,   :a22,  :a23,       :a24,       :a25,          :a26,        :a27,        :a28,        :a29,    \n                :a30,       :a31,   :a32,    :a33,    :a34,        :a35,     :a36,   :a37,     :a38,  :a39 )      \n        ",e.next=17,ue.query(J,{replacements:H,type:ue.QueryTypes.INSERT});case 17:z="1";case 18:if(!(D&&D.length>0)){e.next=27;break}return K="\n        Select 开户行行号 from 水费字典银行代码 where 开户行行号=:code\n        ",e.next=22,ue.query(K,{replacements:{code:D},type:ue.QueryTypes.SELECT});case 22:if(0!==e.sent.length){e.next=27;break}return"\n            insert into 水费字典银行代码 \n                (开户行行号,开户行行名,银行代码,使用次数,业务种类,\n                帐号位数,帐号相同位数,是否验证,帐号相同代码) \n                values (:a1,:a2,:a3,:a4,:a5,:a6,:a7,:a8,:a9)\n            ",e.next=27,ue.query(K,{replacements:{"开户行行号":D,"开户行行名":a,"银行代码":j,"使用次数":1,"业务种类":B,"帐号位数":u.length,"帐号相同位数":0,"是否验证":"Y","帐号相同代码":u},type:ue.QueryTypes.INSERT});case 27:return e.abrupt("return",z);case 28:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),w=function(){var e=(0,c.default)(o.default.mark(function e(t,r){var n,a;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.usekind,e.prev=1,e.next=4,b(n);case 4:a=e.sent,ae.ResourceFound(r,a),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),ae.InternalServerError(r,e.t0,n);case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),b=function(){var e=(0,c.default)(o.default.mark(function e(t){var r,n,a,u,s;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return{},r="\n        Select max(编号) as num from 水费单位信息 where            \n        ",r+="0"===t?" 编号<'2000'":" 编号>'2000'",e.next=5,ue.query(r,{replacements:{},type:ue.QueryTypes.SELECT});case 5:return n=e.sent,a=parseInt(n[0].num)+1,3===(u=a.toString()).length&&(u="0"+u),s=void 0,s=u>"2000"?"2":"0",e.abrupt("return",{"编号":u,"用水形式编号":s});case 12:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),E=function(){var e=(0,c.default)(o.default.mark(function e(t,r,n){var a,u,s,c;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.params.num,u=void 0,e.prev=2,u="prior"===n?"\n            Select 编号 from 水费单位信息 where (编号<:no) \n            ":"\n            Select 编号 from 水费单位信息 where (编号>:no) \n            ",u+="prior"===n?" Order by 编号 desc":" Order by 编号",e.next=7,ue.query(u,{replacements:{no:a},type:ue.QueryTypes.SELECT});case 7:if(!((s=e.sent).length>0)){e.next=15;break}return e.next=11,d(s[0].编号);case 11:c=e.sent,ae.ResourceFound(r,c),e.next=16;break;case 15:ae.ResourceNotFound(r,{},"没有发现记录");case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(2),ae.InternalServerError(r,e.t0,a);case 21:case"end":return e.stop()}},e,this,[[2,18]])}));return function(t,r,n){return e.apply(this,arguments)}}(),S=function(){var e=(0,c.default)(o.default.mark(function e(t,r){var n,a;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,k(n);case 4:a=e.sent,ae.ResourceFound(r,a),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),ae.InternalServerError(r,e.t0,n);case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),k=function(){var e=(0,c.default)(o.default.mark(function e(t){var r,n,s,c,i;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r="\n    SELECT A.编号,A.户名,A.装表地点,A.开户行行名,A.帐号,A.联系人,A.电话,A.用水日期,A.使用期限,A.装表日期,A.水贴费状态,A.水贴费,A.管径,D.单位性质,\n        B.用水形式, E.抄表形式, A.区号, F.单价, C.收费形式, A.申请水量, A.定额, A.节门状态,A.扣水单位编号,A.装表费,\n        A.用户简称,A.用户拼音,A.组织代码,A.帐户地址,A.托收联系人,A.托收电话,A.防火标准编号,A.开户行行号,A.银行代码,A.协议书号,A.业务种类,A.拆表日期,A.退续用手续,A.现场负责,A.表损日期,A.换表日期\n        FROM 水费字典用水形式 B INNER JOIN 水费单位信息 A ON B.用水形式编号 = A.用水形式编号 INNER JOIN\n        水费字典收费形式 C ON A.收费形式编号 = C.收费形式编号 INNER JOIN 水费字典单位性质 D ON A.单位性质编号 = D.单位性质编号 INNER JOIN 水费字典抄表形式 E ON A.抄表形式编号 = E.抄表形式编号 INNER JOIN\n        水费字典费用标准 F ON A.区号 = F.区号  \n    ",n={},s=[],a(t,"编号"),a(t,"户名"),u(t,"编号"," (A.编号 like :num) ","num",n,s),u(t,"户名"," (A.户名 like :name) ","name",n,s),u(t,"用水形式编号"," (A.用水形式编号= :usekind) ","usekind",n,s),u(t,"抄表形式编号"," (A.抄表形式编号= :inputkind) ","inputkind",n,s),u(t,"单位性质编号"," (A.单位性质编号= :unitkind) ","unitkind",n,s),u(t,"区号"," (A.区号= :chargestandard) ","chargestandard",n,s),u(t,"开户行行名"," (A.开户行行名= :bankname) ","bankname",n,s),u(t,"收费形式编号"," (A.收费形式编号= :chargekind) ","chargekind",n,s),u(t,"用水日期"," (substring(A.用水日期,1,6)= :usedd) ","usedd",n,s),u(t,"装表日期"," (substring(A.装表日期,1,6)= :setupdd) ","setupdd",n,s),u(t,"续用水"," (substring(A.装表日期,1,6)<>substring(A.用水日期,1,6)) ",null,n,s),u(t,"签合同单位"," (A.编号=A.扣水单位编号) ",null,n,s),s.push(" (A.节门状态='开') "),c=s.join(" and "),r+=c.length>2?" where "+c:"",e.next=22,ue.query(r,{replacements:n,type:ue.QueryTypes.SELECT});case 22:return i=e.sent,e.abrupt("return",i);case 24:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),g=function(){var e=(0,c.default)(o.default.mark(function e(t,r){var n,a;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,T(n);case 4:a=e.sent,r.writeHead(200,[["Content-Type","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"]]),r.end(new Buffer(a,"base64")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),ae.InternalServerError(r,e.t0,{});case 12:case"end":return e.stop()}},e,this,[[1,9]])}));return function(t,r){return e.apply(this,arguments)}}(),T=function(){var e=(0,c.default)(o.default.mark(function e(t){var r,n,a,u,s;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k(t);case 2:return r=e.sent,n=re.readFileSync(ne.join("./","assets","excel","单位.xlsx")),a=new te(n),u="Sheet1",s={units:r},a.substitute(u,s),e.abrupt("return",a.generate({type:"base64"}));case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),F=function(){var e=(0,c.default)(o.default.mark(function e(t,r){var n,a;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,C(n);case 4:a=e.sent,r.writeHead(200,[["Content-Type","application/vnd.openxmlformats-officedocument.wordprocessingml.document"]]),r.end(new Buffer(a.buf,"base64")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),ae.InternalServerError(r,e.t0,{});case 12:case"end":return e.stop()}},e,this,[[1,9]])}));return function(t,r){return e.apply(this,arguments)}}(),C=function(){var e=(0,c.default)(o.default.mark(function e(t){var r,n,a;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k(t);case 2:return r=e.sent,ae.ConvertNullToZeroString(r),n={items:r},a=se("unit",n,!1),e.abrupt("return",a);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),q=function(){var e=(0,c.default)(o.default.mark(function e(t,r){var n,a;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.num,e.prev=1,e.next=4,I(n);case 4:a=e.sent,ae.ConvertNullToZeroString(a),ae.ResourceFound(r,a),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),ae.InternalServerError(r,e.t0,n);case 12:case"end":return e.stop()}},e,this,[[1,9]])}));return function(t,r){return e.apply(this,arguments)}}(),I=function(){var e=(0,c.default)(o.default.mark(function e(t){var r,n,a,u,c;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r="\n    Select 编号,户名,装表地点 from 水费单位信息 where 编号=:num\n    ",n={},e.next=4,ue.query(r,{replacements:{num:t},type:ue.QueryTypes.SELECT});case 4:if(!((a=e.sent)&&a.length>0)){e.next=11;break}return u="\n        Select * from 水费贴费表 where 编号=:num\n        ",e.next=9,ue.query(u,{replacements:{num:t},type:ue.QueryTypes.SELECT});case 9:c=e.sent,n=c&&c.length>0?(0,s.default)({},a[0],c[0]):a[0];case 11:return e.abrupt("return",n);case 12:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),A=function(){var e=(0,c.default)(o.default.mark(function e(t,r){var n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,L(n);case 4:"1"===e.sent?ae.ResourceUpdated(r,"编号"+n.编号+"用水企业信息更新完成！"):ae.ResourceCreated(r,"编号"+n.编号+"用水企业信息添加完成！"),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),ae.InternalServerError(r,e.t0,{num:n.编号});case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),L=function(){var e=(0,c.default)(o.default.mark(function e(t){var r,n,a,u,s,c,i,p,l,f,d,y,h,m,v,x,w,b,E,S,k,g,T,F,C,q,I,A,L,R,_,Q,N,D,M;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.编号,n=t.交费日期,a=t.水贴费,u=t.贴费状态,s=t.增容日期1,c=t.增容费1,i=t.增容日期2,p=t.增容费2,l=t.增容日期3,f=t.增容费3,d=t.增容日期4,y=t.增容费4,h=t.增容日期5,m=t.增容费5,v=t.合计,x=t.申请容量,w=t.增加容量1,b=t.增加容量2,E=t.增加容量3,S=t.增加容量4,k=t.增加容量5,g=t.容量合计,T=t.贴费备注,F=t.备注1,C=t.备注2,q=t.备注3,I=t.备注4,A=t.备注5,L="\n    Select * from 水费贴费表 where 编号=:num          \n    ",R={a1:r||"",a2:n||"",a3:parseFloat(a).toFixed(2),a4:u||"",a5:s||"",a6:parseFloat(c).toFixed(2),a7:i||"",a8:parseFloat(p).toFixed(2),a9:l||"",a10:parseFloat(f).toFixed(2),a11:d||"",a12:parseFloat(y).toFixed(2),a13:h||"",a14:parseFloat(m).toFixed(2),a15:parseFloat(v).toFixed(2),a16:parseFloat(x).toFixed(2),a17:parseFloat(w).toFixed(2),a18:parseFloat(b).toFixed(2),a19:parseFloat(E).toFixed(2),a20:parseFloat(S).toFixed(2),a21:parseFloat(k).toFixed(2),a22:parseFloat(g).toFixed(2),a23:T||"",a24:F||"",a25:C||"",a26:q||"",a27:I||"",a28:A||""},e.next=5,ue.query(L,{replacements:{num:r},type:ue.QueryTypes.SELECT});case 5:if(_=e.sent,Q=void 0,!(_.length>0)){e.next=14;break}return N="\n        Update 水费贴费表 set 交费日期=:a2,水贴费=:a3,贴费状态=:a4,  \n        增容日期1=:a5,增容费1=:a6,增容日期2=:a7,增容费2=:a8,增容日期3=:a9,增容费3=:a10,\n        增容日期4=:a11,增容费4=:a12,增容日期5=:a13,增容费5=:a14,合计=:a15,\n        申请容量=:a16,增加容量1=:a17,增加容量2=:a18,增加容量3=:a19,增加容量4=:a20,增加容量5=:a21,容量合计=:a22,    \n        贴费备注=:a23,备注1=:a24,备注2=:a25,备注3=:a26,备注4=:a27,备注5=:a28\n        where 编号 =:a1 \n        ",e.next=11,ue.query(N,{replacements:R,type:ue.QueryTypes.UPDATE});case 11:Q="1",e.next=18;break;case 14:return D="\n        Insert into 水费贴费表 (编号,交费日期,水贴费,贴费状态,增容日期1,增容费1,增容日期2,增容费2,增容日期3,增容费3,增容日期4,增容费4,增容日期5,增容费5,合计, \n            申请容量,增加容量1,增加容量2,增加容量3,增加容量4,增加容量5,容量合计,\n            贴费备注,备注1,备注2,备注3,备注4,备注5 )\n            values (:a1,:a2,:a3,:a4,:a5,:a6,:a7,:a8,:a9,:a10,:a11,:a12,:a13,:a14,:a15,:a16,:a17,:a18,:a19,:a20,:a21,:a22,:a23,:a24,:a25,:a26,:a27,:a28)   \n        ",e.next=17,ue.query(D,{replacements:R,type:ue.QueryTypes.INSERT});case 17:Q="1";case 18:return M="\n    Update 水费单位信息 set 拆表日期=:dd,水贴费=:allowance,水贴费状态=:status where 编号=:num\n    ",e.next=21,ue.query(M,{replacements:{dd:n,allowance:a,status:u,num:r},type:ue.QueryTypes.INSERT});case 21:return e.abrupt("return",Q);case 22:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),R=function(){var e=(0,c.default)(o.default.mark(function e(t,r,n){var a,u,s,c;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.params.num,u=void 0,e.prev=2,u="prior"===n?"\n            Select top 1 编号 from 水费单位信息 where (编号<:no) \n            ":"\n            Select top 1 编号 from 水费单位信息 where (编号>:no) \n            ",u+="prior"===n?" Order by 编号 desc":" Order by 编号",e.next=7,ue.query(u,{replacements:{no:a},type:ue.QueryTypes.SELECT});case 7:if(!((s=e.sent).length>0)){e.next=16;break}return e.next=11,I(s[0].编号);case 11:c=e.sent,ae.ConvertNullToZeroString(c),ae.ResourceFound(r,c),e.next=17;break;case 16:ae.ResourceNotFound(r,{},"没有发现记录");case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(2),ae.InternalServerError(r,e.t0,a);case 22:case"end":return e.stop()}},e,this,[[2,19]])}));return function(t,r,n){return e.apply(this,arguments)}}(),_=function(){var e=(0,c.default)(o.default.mark(function e(t,r){var n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,Q(n);case 4:"1"===e.sent?ae.ResourceUpdated(r,"编号"+n.编号+"用水企业托收信息更新完成！"):ae.ResourceCreated(r,"编号"+n.编号+"用水企业托收信息添加完成！"),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),ae.InternalServerError(r,e.t0,{num:n.编号});case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),Q=function(){var e=(0,c.default)(o.default.mark(function e(t){var r,n,a,u,s,c,i,p,l,f,d,y,h,m,v,x,w,b,E,S,k,g,T,F,C;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.编号,n=t.户名,a=t.开户行行名,u=t.帐号,s=t.联系人,c=t.电话,i=t.单位性质编号,p=t.扣水单位编号,l=t.用户简称,f=t.用户拼音,d=t.组织代码,y=t.帐户地址,h=t.开户行行号,m=t.托收联系人,v=t.托收电话,x=t.协议书号,w=t.银行代码,b=t.业务种类,E="\n    select 编号 from 水费单位信息 where 编号 =:num          \n    ",S={a1:r||"",a2:n||"",a3:a||"",a4:u||"",a5:s||"",a6:c||"",a24:i&&i.length>0?i:"",a29:p||"",a30:l||"",a31:f||"",a32:d||"",a33:y||"",a34:h||"",a35:m||"",a36:v||"",a37:x||"",a38:w||"",a39:b||""},e.next=5,ue.query(E,{replacements:{num:r},type:ue.QueryTypes.SELECT});case 5:if(k=e.sent,g=void 0,!(k.length>0)){e.next=14;break}return T="\n        update 水费单位信息 set  户名=:a2,开户行行名=:a3,帐号=:a4,联系人=:a5,电话=:a6,\n        单位性质编号=:a24, \n        用户简称=:a30,用户拼音=:a31,组织代码=:a32,帐户地址=:a33,开户行行号=:a34,托收联系人=:a35,托收电话=:a36,协议书号=:a37,银行代码=:a38,业务种类=:a39   \n            where 扣水单位编号 =:a1 \n        ",e.next=11,ue.query(T,{replacements:S,type:ue.QueryTypes.UPDATE});case 11:g="1",e.next=18;break;case 14:return F="\n        Insert Into 水费单位信息 (编号,户名,开户行行名,帐号,联系人,电话,用水日期,装表日期,使用期限,水贴费状态,水贴费,管径,定额,申请水量,\n            装表费,节门状态,现场负责,装表地点,退续用手续,拆表日期,表损日期,换表日期,区号,单位性质编号,用水形式编号,收费形式编号,抄表形式编号,防火标准编号,扣水单位编号,\n            用户简称,用户拼音,组织代码,帐户地址,开户行行号,托收联系人,托收电话,协议书号,银行代码,业务种类 )\n            Values (:a1,:a2,:a3,:a4,:a5,:a6,:a7,:a8,:a9,     :a10,  :a11, :a12,:a13,    :a14,\n                :a15,    :a16,    :a17,    :a18,      :a19,     :a20,   :a21,   :a22,  :a23,       :a24,       :a25,          :a26,        :a27,        :a28,        :a29,    \n                :a30,       :a31,   :a32,    :a33,    :a34,        :a35,     :a36,   :a37,     :a38,  :a39 )      \n        ",e.next=17,ue.query(F,{replacements:S,type:ue.QueryTypes.INSERT});case 17:g="1";case 18:if(!(h&&h.length>0)){e.next=30;break}return C="\n        Select 开户行行号 from 水费字典银行代码 where 开户行行号=:code\n        ",e.next=22,ue.query(C,{replacements:{code:h},type:ue.QueryTypes.SELECT});case 22:if(0!==e.sent.length){e.next=27;break}return"\n            insert into 水费字典银行代码 \n                (开户行行号,开户行行名,银行代码,使用次数,业务种类,\n                帐号位数,帐号相同位数,是否验证,帐号相同代码) \n                values (:a1,:a2,:a3,:a4,:a5,:a6,:a7,:a8,:a9)\n            ",e.next=27,ue.query(C,{replacements:{"开户行行号":h,"开户行行名":a,"银行代码":w,"使用次数":1,"业务种类":b,"帐号位数":u.length,"帐号相同位数":0,"是否验证":"Y","帐号相同代码":u},type:ue.QueryTypes.INSERT});case 27:return"\n        update 水费字典银行代码 set 使用次数=使用次数+1 where 开户行行号=:code\n            ",e.next=30,ue.query(C,{replacements:{code:h},type:ue.QueryTypes.UPDATE});case 30:return e.abrupt("return",g);case 31:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),N=function(){var e=(0,c.default)(o.default.mark(function e(t,r,n){var a,u,s,c,i,p;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.params,u=a.num,s=a.cb,c=void 0,e.prev=2,c="prior"===n?"\n            Select top 1 编号 from 水费单位信息 where (编号<:no) and 扣水单位编号=编号\n            ":"\n            Select top 1 编号 from 水费单位信息 where (编号>:no)  and 扣水单位编号=编号\n            ","true"===s&&(c+=" and 收费形式编号='1' "),c+="prior"===n?" Order by 编号 desc":" Order by 编号",e.next=8,ue.query(c,{replacements:{no:u},type:ue.QueryTypes.SELECT});case 8:if(!((i=e.sent).length>0)){e.next=16;break}return e.next=12,d(i[0].编号);case 12:p=e.sent,ae.ResourceFound(r,p),e.next=17;break;case 16:ae.ResourceNotFound(r,{},"没有发现记录");case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(2),ae.InternalServerError(r,e.t0,u);case 22:case"end":return e.stop()}},e,this,[[2,19]])}));return function(t,r,n){return e.apply(this,arguments)}}(),D=function(){var e=(0,c.default)(o.default.mark(function e(t,r){var n,a,u,s,c;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params,a=n.num,u=n.year,s=n.month,e.prev=1,e.next=4,M(a,u,s);case 4:c=e.sent,ae.ResourceFound(r,c),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),ae.InternalServerError(r,e.t0,a);case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),M=function(){var e=(0,c.default)(o.default.mark(function e(t,r,n){var a,u,c,i,p;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a="\n    Select 编号, 户名, 开户行行名 ,帐号 , 用水形式编号,\n    联系人,电话,用水日期,装表日期,使用期限,\n    装表地点, 管径,申请水量,定额,扣水单位编号,节门状态\n        from 水费单位信息 where 编号=:num\n    ",e.next=3,ue.query(a,{replacements:{num:t},type:ue.QueryTypes.SELECT});case 3:return u=e.sent,c="\n    Select 本月表底 from 水费基本表 where \n        编号=:num and 年=:year and 月=:month\n    ",e.next=7,ue.query(c,{replacements:{num:t,year:r,month:n},type:ue.QueryTypes.SELECT});case 7:if(0!==(i=e.sent).length){e.next=13;break}return c="\n        Select 本月表底 from 水费基本表 where \n            编号=:num and 年+月<:dd\n            order by 年,月 desc\n        ",e.next=12,ue.query(c,{replacements:{num:t,dd:r+n},type:ue.QueryTypes.SELECT});case 12:i=e.sent;case 13:return p={},u.length>0&&i.length>0&&(p=(0,s.default)({},u[0],i[0])),e.abrupt("return",p);case 16:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}(),U=function(){var e=(0,c.default)(o.default.mark(function e(t,r){var n,a,u,s;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params,a=n.num,u=n.usekind,e.prev=1,e.next=4,O(a,u);case 4:s=e.sent,ae.ResourceFound(r,s),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),ae.InternalServerError(r,e.t0,a);case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),O=function(){var e=(0,c.default)(o.default.mark(function e(t,r){var n,a;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={},a="\n    Select 过户编号 from 水费过户表 where 老户编号 =:num\n    ",e.next=4,ue.query(a,{replacements:{num:t},type:ue.QueryTypes.SELECT});case 4:if(!(e.sent.length>0)){e.next=9;break}n.desc="该单位已经过户，不能重复过户！",e.next=12;break;case 9:return e.next=11,b(r);case 11:n=e.sent;case 12:return e.abrupt("return",n);case 13:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}(),j=function(){var e=(0,c.default)(o.default.mark(function e(t,r){var n,a;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,B(n);case 4:a=e.sent,ae.ResourceUpdated(r,a),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),ae.InternalServerError(r,e.t0,{num:n.编号});case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),B=function(){var e=(0,c.default)(o.default.mark(function e(t){var r,n,a,u,s,c,i,p,l,f,d,y,h,m,v,x,w,b,E,S,k,g,T,F,C,q,I,A,L,R,_,Q;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.过户日期,n=t.编号,a=t.编号n,u=t.过户理由,s=t.沿用原指标,c=t.备注,i=t.户名n,p=t.开户行行名n,l=t.帐号n,f=t.电话n,d=t.联系人n,y=t.用水日期n,h=t.装表日期n,m=t.使用期限n,v=t.管径n,x=t.定额n,w=t.申请水量n,b=t.节门状态n,E=t.装表地点n,S=t.扣水单位编号n,k=t.本月表底n,g=void 0,T="\n    Select 过户编号 from 水费过户表 where 过户日期 =:dd order by 过户编号 desc\n    ",e.next=5,ue.query(T,{replacements:{dd:r},type:ue.QueryTypes.SELECT});case 5:return F=e.sent,C=void 0,C=0===F.length?r+"01":(parseInt(F[0].过户编号)+1).toString(),q={a1:C,a2:r,a3:n,a4:a,a5:u||"",a6:"true"===s?"T":"F",a7:c},I="\n    Insert Into 水费过户表 (过户编号,过户日期,老户编号,新户编号,过户理由,沿用原指标,备注) \n    Values (:a1,:a2,:a3,:a4,:a5,:a6,:a7)\n    ",e.next=12,ue.query(I,{replacements:q,type:ue.QueryTypes.INSERT});case 12:return A="update 水费单位信息 set 节门状态='闭' where 编号 =:no",e.next=15,ue.query(A,{replacements:{no:n},type:ue.QueryTypes.UPDATE});case 15:return L="\n    Insert Into 水费单位信息 (编号,户名,开户行行名,帐号,联系人,电话,用水日期,装表日期,使用期限,水贴费状态,水贴费,管径,定额,申请水量,\n        装表费,节门状态,现场负责,装表地点,退续用手续,拆表日期,表损日期,换表日期,区号,单位性质编号,用水形式编号,收费形式编号,抄表形式编号,防火标准编号,扣水单位编号 )\n        Values (:a1,:a2,:a3,:a4,:a5,:a6,:a7,:a8,:a9,:a10,:a11,:a12,:a13,:a14,:a15,:a16,:a17,:a18,:a19,:a20,:a21,:a22,:a23,:a24,:a25,:a26,:a27,:a28,:a29 )\n    ",R={a1:a,a2:i,a3:p||"",a4:l||"",a5:d||"",a6:f||"",a7:y,a8:h,a9:m,a10:"",a11:0,a12:v,a13:x,a14:w,a15:0,a16:b,a17:"",a18:E,a19:"",a20:"",a21:"",a22:"",a23:"1",a24:"1",a25:"1",a26:"1",a27:"1",a28:"1",a29:S},e.next=19,ue.query(L,{replacements:R,type:ue.QueryTypes.INSERT});case 19:return _="\n    Insert Into 水费基本表 (年,月,编号,户名,上月表底,本月表底,用水量,实收水费,欠费标志,大写,小写,操作员,操作时间,应收水费) \n    Values (:a1,:a2,:a3,:a4,:a5,:a6,:a7,:a8,:a9,:a10,:a11,:a12,:a13,:a14 )\n    ",Q={a1:r.slice(0,4),a2:r.slice(4),a3:a,a4:i,a5:parseInt(k),a6:parseInt(k),a7:0,a8:0,a9:"1",a10:"零元",a11:"￥0 0 0",a12:"管理员",a13:r,a14:0},e.next=23,ue.query(_,{replacements:Q,type:ue.QueryTypes.INSERT});case 23:return g="过户保存成功！",e.abrupt("return",g);case 25:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),P=function(){var e=(0,c.default)(o.default.mark(function e(t,r){var n,a,u,s;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params,a=n.start,u=n.end,e.prev=1,e.next=4,H(a,u);case 4:s=e.sent,ae.ResourceFound(r,s),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),ae.InternalServerError(r,e.t0,{start:a,end:u});case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),H=function(){var e=(0,c.default)(o.default.mark(function e(t,r){var n,a;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n="\n    SELECT * from 水费过户查询\n        where 过户日期>=:start and 过户日期<=:end\n        Order by  老户编号 \n    ",e.next=3,ue.query(n,{replacements:{start:t,end:r},type:ue.QueryTypes.SELECT});case 3:return a=e.sent,e.abrupt("return",a);case 5:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}(),W=function(){var e=(0,c.default)(o.default.mark(function e(t,r){var n,a,u,s;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params,a=n.start,u=n.end,e.prev=1,e.next=4,z(a,u);case 4:s=e.sent,r.writeHead(200,[["Content-Type","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"]]),r.end(new Buffer(s,"base64")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),ae.InternalServerError(r,e.t0,{});case 12:case"end":return e.stop()}},e,this,[[1,9]])}));return function(t,r){return e.apply(this,arguments)}}(),z=function(){var e=(0,c.default)(o.default.mark(function e(t,r){var n,a,u,s,c;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,H(t,r);case 2:return n=e.sent,a=re.readFileSync(ne.join("./","assets","excel","过户.xlsx")),u=new te(a),s="sheet1",c={change:n},u.substitute(s,c),e.abrupt("return",u.generate({type:"base64"}));case 9:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}(),G=function(){var e=(0,c.default)(o.default.mark(function e(t,r){var n,a;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,J(n);case 4:a=e.sent,ae.ResourceUpdated(r,a),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),ae.InternalServerError(r,e.t0,n);case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),J=function(){var e=(0,c.default)(o.default.mark(function e(t){var r,n,a,u,s,c,i,p,l,f,d,y,h,m,v,x,w,b,E,S,k,g,T,F,C,q;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.date,n=r.slice(0,4),a=r.slice(4),u="",s="",c=t.date1,i="",p="",l=t.date2,c&&c.length>0&&(u=c.slice(0,4),s=c.slice(4)),l&&l.length>0&&(i=l.slice(0,4),p=l.slice(4)),f="\n    Delete from 水费误差分析 where 年=:year and 月=:month \n    ",e.next=14,ue.query(f,{replacements:{year:n,month:a},type:ue.QueryTypes.DELETE});case 14:return d="\n    Select 编号 from 水费基本表 where 年=:year and 月=:month order by 编号\n    ",e.next=17,ue.query(d,{replacements:{year:n,month:a},type:ue.QueryTypes.SELECT});case 17:y=e.sent,h=0;case 19:if(!(h<y.length)){e.next=48;break}if(m=y[h],!t.para1){e.next=33;break}return v="\n            Select 用水量 from 水费基本表 where ((年=:year and 月=:month) or ( 年=:year1 and 月=:month1)) and (编号=:no) \n            ",e.next=25,ue.query(v,{replacements:{year:n,month:a,year1:u,month1:s,no:m.编号},type:ue.QueryTypes.SELECT});case 25:if(x=e.sent,w=0,b=0,2===x.length&&(w=parseInt(x[0].用水量),b=parseInt(x[1].用水量)),!(b>w*(1+parseFloat(t.proportion1))&&0!=w)){e.next=33;break}return E="\n                Insert into  水费误差分析 values (:a1,:a2,:a3,:a4,:a5,:a6,:a7,:a8,:a9,:a10 ) \n                ",e.next=33,ue.query(E,{replacements:{a1:n,a2:a,a3:(h+1).toString(),a4:m.编号,a5:b,a6:u,a7:s,a8:"超过比例 "+t.proportion1,a9:w,a10:""},type:ue.QueryTypes.INSERT});case 33:if(!t.para2){e.next=45;break}return S="\n            Select 用水量 from 水费基本表 where ((年=:year and 月=:month) or ( 年=:year1 and 月=:month1)) and (编号=:no) \n            ",e.next=37,ue.query(S,{replacements:{year:n,month:a,year1:i,month1:p,no:m.编号},type:ue.QueryTypes.SELECT});case 37:if(k=e.sent,g=0,T=0,2===k.length&&(g=parseInt(k[0].用水量),T=parseInt(k[1].用水量)),!(T<g*(1-parseFloat(t.proportion2))&&0!=g)){e.next=45;break}return F="\n                Insert into  水费误差分析 values (:a1,:a2,:a3,:a4,:a5,:a6,:a7,:a8,:a9,:a10 ) \n                ",e.next=45,ue.query(F,{replacements:{a1:n,a2:a,a3:(h+1).toString(),a4:m.编号,a5:T,a6:u,a7:s,a8:"小于比例 "+t.proportion1,a9:g,a10:""},type:ue.QueryTypes.INSERT});case 45:h++,e.next=19;break;case 48:return C="\n    SELECT A.年,A.月,A.编号,B.户名,B.装表地点,A.用水量,A.对比年,A.对比月,A.对比内容,A.对比水量 FROM 水费误差分析 A INNER JOIN 水费单位信息 B ON A.编号 = B.编号\n        where A.年=:year and 月=:month\n        ",e.next=51,ue.query(C,{replacements:{year:n,month:a},type:ue.QueryTypes.SELECT});case 51:return q=e.sent,e.abrupt("return",q);case 53:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),K=function(){var e=(0,c.default)(o.default.mark(function e(t,r){var n,a;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.date,e.prev=1,e.next=4,V(n);case 4:a=e.sent,r.writeHead(200,[["Content-Type","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"]]),r.end(new Buffer(a,"base64")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),ae.InternalServerError(r,e.t0,e.t0);case 12:case"end":return e.stop()}},e,this,[[1,9]])}));return function(t,r){return e.apply(this,arguments)}}(),V=function(){var e=(0,c.default)(o.default.mark(function e(t){var r,n,a,u,s,c,i,p;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.slice(0,4),n=t.slice(4),a="\n    SELECT A.年,A.月,A.编号,B.户名,B.装表地点,A.用水量,A.对比年,A.对比月,A.对比内容,A.对比水量 FROM 水费误差分析 A INNER JOIN 水费单位信息 B ON A.编号 = B.编号\n        where A.年=:year and 月=:month\n        ",e.next=5,ue.query(a,{replacements:{year:r,month:n},type:ue.QueryTypes.SELECT});case 5:return u=e.sent,s=re.readFileSync(ne.join("./","assets","excel","Error.xlsx")),c=new te(s),i="Sheet1",p={errors:u},c.substitute(i,p),e.abrupt("return",c.generate({type:"base64"}));case 12:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),Y=function(){var e=(0,c.default)(o.default.mark(function e(t,r){var n,a;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.num,e.prev=1,e.next=4,Z(n);case 4:a=e.sent,ae.ResourceFound(r,a),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),ae.InternalServerError(r,e.t0,{num:n});case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),Z=function(){var e=(0,c.default)(o.default.mark(function e(t){var r,n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r="\n    Select 编号 from 水费单位信息 where 编号 =:num\n        ",e.next=3,ue.query(r,{replacements:{num:t},type:ue.QueryTypes.SELECT});case 3:return n=e.sent,e.abrupt("return",0===n.length);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),$=function(){var e=(0,c.default)(o.default.mark(function e(t,r){var n,a;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,X(n);case 4:a=e.sent,ae.ResourceUpdated(r,a),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),ae.InternalServerError(r,e.t0,{num:n.编号});case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),X=function(){var e=(0,c.default)(o.default.mark(function e(t){var r,n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r="\n    update 水费单位信息 set 编号=:n1, 扣水单位编号=:n2 where 编号=:n3 \n    ",e.next=3,ue.query(r,{replacements:{n1:t.编号n,n2:t.扣水单位编号n,n3:t.编号},type:ue.QueryTypes.UPDATE});case 3:return n="\n    update 水费基本表 set 编号=:n1 where 编号=:n2 \n    ",e.next=6,ue.query(n,{replacements:{n1:t.编号n,n2:t.编号},type:ue.QueryTypes.UPDATE});case 6:return e.abrupt("return",!0);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),ee=function(){var e=(0,c.default)(o.default.mark(function e(t){var r,n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r="\n  select 编号, 托收联系人, 托收电话\n      from dbo.水费单位信息 \n      where 编号 in ("+t.join(",")+")\n  ",e.next=3,ue.query(r,{replacements:{},type:ue.QueryTypes.SELECT});case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),te=(r(19),r(51)),re=r(26),ne=r(9),ae=(r(12),r(1)),ue=r(8),se=r(53).toWord;e.exports.queryUnitsByPinYin=i,e.exports.queryUnitByDownNum=p,e.exports.queryUnitByDownNumImpt=l,e.exports.queryUnitByNum=f,e.exports.queryUnitByNumImpt=d,e.exports.queryUnitParas=y,e.exports.queryBankByName=m,e.exports.saveUnit=v,e.exports.createUnitNum=w,e.exports.MoveUnitPosition=E,e.exports.searchUnits=S,e.exports.unitsToExcel=g,e.exports.unitsToWord=F,e.exports.queryAllowanceByNum=q,e.exports.saveAllowance=A,e.exports.MoveAllowancePosition=R,e.exports.saveCollection=_,e.exports.MoveCollectionPosition=N,e.exports.queryUnitChangeName=D,e.exports.createChangeNameNum=U,e.exports.saveUnitChange=j,e.exports.searchUnitChange=P,e.exports.changeToExcel=W,e.exports.checkError=G,e.exports.checkErrorToExcel=K,e.exports.changeIdCheck=Y,e.exports.saveUnitChangeId=$,e.exports.queryPersonAndNumber=ee},function(e,t,r){"use strict";var n=r(195),a=r(196),u=r(26),s=r(9),o=r(197);e.exports.toWord=function(e,t,r){var c=u.readFileSync(s.join("./","assets","word",e+".docx"),"binary"),i=new n(c),p=new a;p.loadZip(i),p.setData(t),p.render();var l=p.getZip().generate({type:"base64"});if(l=new Buffer(l,"base64"),r){var f=o();return u.writeFileSync(s.join("./","output","word",f+".docx"),l),{buf:l,savename:f}}return{buf:l}}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(){return f.base32String(h)}function u(e,t){var r=a(),n=a(),u={access_token:r,token_type:"Bearer",expires_in:y,refresh_token:n};!function(e,t){var r=p.clone(e);r.username=t,m[r.access_token]=r,v[r.refresh_token]=r,setTimeout(function(){s(r.access_token)},1e3*y)}(u),t(u)}function s(e){delete m[e]}var o=n(r(3)),c=n(r(4)),i=function(){var e=(0,c.default)(o.default.mark(function e(t,r,n){var a,s,c,i,f,y;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.grant_type,s=t.username,c=t.password,"password"===a){e.next=3;break}return e.abrupt("return",l.BadRequest(n,"用户名或者密码错误",{username:s}));case 3:if(s&&c){e.next=5;break}return e.abrupt("return",l.BadRequest(n,"用户名或者密码错误",{username:s}));case 5:return e.prev=5,i="\n        Select * from 人事操作权限 where 姓名=:username \n        ",e.next=9,d.query(i,{replacements:{username:s},type:d.QueryTypes.SELECT});case 9:1===(f=e.sent).length?(y=f[0]).密码===c?u(0,function(e){l.ResourceFound(n,p.extend({status:"online",desc:"0",user:y},e))}):l.ResourceNotFound(n,{username:s},"密码错误"):l.ResourceNotFound(n,{username:s},"用户名不存在"),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(5),l.ResourceNotFound(n,{username:s},"用户名或者密码错误");case 16:case"end":return e.stop()}},e,this,[[5,13]])}));return function(t,r,n){return e.apply(this,arguments)}}(),p=r(120),l=r(1),f=(r(70),r(125)),d=r(8),y=3600,h=20,m={},v={};e.exports={logout:function(e,t){var r=(e.headers.authorization||"").split(" "),n=(r[0],r[1]);s(n),l.ResourceFound(t,p.extend({status:"offline",desc:"1"},n))},authenticate:function(e,t){i(e.body||{},e,t)},authorizationRequired:function(e,t,r){var n=e.headers.authorization||"";if(!n)return l.NotAuthorized(e,t);var a=n.split(" "),u=a[0],s=a[1];if(!u||"Bearer"!==u||!s)return l.NotAuthorized(e,t);!function(e,t){p.has(m,e)?t({valid:!0,token:m[e]}):t({valid:!1,token:null})}(s,function(n){if(!n.valid)return l.NotAuthorized(e,t);r()})}}},function(e,t,r){e.exports={default:r(99),__esModule:!0}},function(e,t){},function(e,t){e.exports=!0},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,r){var n=r(14),a=r(105),u=r(61),s=r(40)("IE_PROTO"),o=function(){},c=function(){var e,t=r(37)("iframe"),n=u.length;for(t.style.display="none",r(62).appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),c=e.F;n--;)delete c.prototype[u[n]];return c()};e.exports=Object.create||function(e,t){var r;return null!==e?(o.prototype=n(e),r=new o,o.prototype=null,r[s]=e):r=c(),void 0===t?r:a(r,t)}},function(e,t,r){var n=r(6),a="__core-js_shared__",u=n[a]||(n[a]={});e.exports=function(e){return u[e]||(u[e]={})}},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t,r){var n=r(6).document;e.exports=n&&n.documentElement},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,r){var n=r(43),a=r(7)("iterator"),u=r(22);e.exports=r(2).getIteratorMethod=function(e){if(void 0!=e)return e[a]||e["@@iterator"]||u[n(e)]}},function(e,t,r){var n=r(14),a=r(20),u=r(7)("species");e.exports=function(e,t){var r,s=n(e).constructor;return void 0===s||void 0==(r=n(s)[u])?t:a(r)}},function(e,t,r){var n,a,u,s=r(16),o=r(115),c=r(62),i=r(37),p=r(6),l=p.process,f=p.setImmediate,d=p.clearImmediate,y=p.MessageChannel,h=p.Dispatch,m=0,v={},x="onreadystatechange",w=function(){var e=+this;if(v.hasOwnProperty(e)){var t=v[e];delete v[e],t()}},b=function(e){w.call(e.data)};f&&d||(f=function(e){for(var t=[],r=1;arguments.length>r;)t.push(arguments[r++]);return v[++m]=function(){o("function"==typeof e?e:Function(e),t)},n(m),m},d=function(e){delete v[e]},"process"==r(23)(l)?n=function(e){l.nextTick(s(w,e,1))}:h&&h.now?n=function(e){h.now(s(w,e,1))}:y?(u=(a=new y).port2,a.port1.onmessage=b,n=s(u.postMessage,u,1)):p.addEventListener&&"function"==typeof postMessage&&!p.importScripts?(n=function(e){p.postMessage(e+"","*")},p.addEventListener("message",b,!1)):n=x in i("script")?function(e){c.appendChild(i("script"))[x]=function(){c.removeChild(this),w.call(e)}}:function(e){setTimeout(s(w,e,1),0)}),e.exports={set:f,clear:d}},function(e,t){e.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},function(e,t,r){var n=r(14),a=r(11),u=r(45);e.exports=function(e,t){if(n(e),a(t)&&t.constructor===e)return t;var r=u.f(e);return(0,r.resolve)(t),r.promise}},function(e,t,r){"use strict";var n=r(6),a=r(2),u=r(13),s=r(15),o=r(7)("species");e.exports=function(e){var t="function"==typeof a[e]?a[e]:n[e];s&&t&&!t[o]&&u.f(t,o,{configurable:!0,get:function(){return this}})}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var a=n(r(3)),u=n(r(4)),s=function(){var e=(0,u.default)(a.default.mark(function e(t,r){var n,u;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.username,e.prev=1,e.next=4,o(n);case 4:(u=e.sent)&&u.length>0?p.ResourceFound(r,u[0]):p.ResourceNotFound(r,{username:n}),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),p.InternalServerError(r,e.t0,{username:n});case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),o=function(){var e=(0,u.default)(a.default.mark(function e(t){var n,u,s;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n="\n    Select * from 人事操作权限 where 姓名=:username \n    ",e.next=3,i.query(n,{replacements:{username:t},type:i.QueryTypes.SELECT});case 3:return u=e.sent,s=r(71)("./"+u[0].权限1),u[0].items=s,e.abrupt("return",u);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),c=r(19),i=(r(124),r(8)),p=r(1),l=i.define("user",{"姓名":{type:c.STRING},"单位编号":{type:c.STRING},"单位名称":{type:c.STRING},"部门编号":{type:c.STRING},"部门名称":{type:c.STRING},"密码":{type:c.STRING}},{timestamps:!1,tableName:"人事操作权限"});l.prototype.checkPassword=function(e,t){e===this.密码?t(null,!0):t(null,!1)},l.prototype.initAdminUser=function(e,t,r){l.findAll({where:{"姓名":"admin1"}}).then(function(e){0===e.length?l.build({"姓名":"admin1","密码":"123456"}).save().then(function(e){console.log("Creating Admin user")}).catch(function(e){console.log(e)}):console.log("Admin user already exist")}).catch(function(e){console.log(e)})},e.exports=l,e.exports.queryUser=s},function(e,t,r){function n(e){return r(a(e))}function a(e){var t=u[e];if(!(t+1))throw new Error("Cannot find module '"+e+"'.");return t}var u={"./manager":72,"./manager.js":72,"./operator":73,"./operator.js":73,"./unit":74,"./unit.js":74};n.keys=function(){return Object.keys(u)},n.resolve=a,e.exports=n,n.id=71},function(e,t,r){"use strict";e.exports={menus:[{key:"menu2",name:"查询管理",icon:"user",baseurl:"/app/search",url:"/app/search/unit",child:[{key:"sub21",name:"查询",icon:"user",child:[{key:"sidebarsub211",name:"单位信息查询",icon:"user",matchurl:"/app/search/unit",url:"/app/search/unit"},{key:"sidebarsub212",name:"水费信息查询",icon:"user",matchurl:"/app/search/toll",url:"/app/search/toll"},{key:"sidebarsub213",name:"统计水费",icon:"user",matchurl:"/app/search/stattoll",url:"/app/search/stattoll"}]},{key:"sub22",name:"欠费",icon:"user",child:[{key:"sidebarsub221",name:"按欠费单位统计",icon:"user",matchurl:"/app/search/lackunit",url:"/app/search/lackunit"},{key:"sidebarsub222",name:"催缴管理",icon:"user",matchurl:"/app/search/reminderlist",url:"/app/search/reminderlist"}]}]},{key:"menu3",name:"报表管理",icon:"laptop",baseurl:"/app/report",url:"/app/report/commission",child:[{key:"sub31",name:"报表",icon:"user",child:[{key:"sidebarsub311",name:"委托收款报表",icon:"user",matchurl:"/app/report/commission",url:"/app/report/commission"},{key:"sidebarsub312",name:"水费结算单",icon:"user",matchurl:"/app/report/detail",url:"/app/report/detail"},{key:"sidebarsub313",name:"月汇总表",icon:"user",matchurl:"/app/report/chargemonth",url:"/app/report/chargemonth"},{key:"sidebarsub314",name:"年汇总表",icon:"user",matchurl:"/app/report/chargeyear",url:"/app/report/chargeyear"},{key:"sidebarsub315",name:"贴费汇总表",icon:"user",matchurl:"/app/report/allowance",url:"/app/report/allowance"},{key:"sidebarsub316",name:"委托收款报表_临时",icon:"user",matchurl:"/app/report/commissiontemp",url:"/app/report/commissiontemp"}]}]},{key:"menu4",name:"明细管理",icon:"notification",baseurl:"/app/detail",url:"/app/detail/allowance",child:[{key:"sub41",name:"明细",icon:"user",child:[{key:"sidebarsub411",name:"水贴费",icon:"user",matchurl:"/app/detail/allowance",url:"/app/detail/allowance"},{key:"sidebarsub412",name:"装表费",icon:"user",matchurl:"/app/detail/fixwatch",url:"/app/detail/fixwatch"},{key:"sidebarsub413",name:"用水指标",icon:"user",matchurl:"/app/detail/ration",url:"/app/detail/ration"},{key:"sidebarsub414",name:"供水合同",icon:"user",matchurl:"/app/detail/contract",url:"/app/detail/contract"},{key:"sidebarsub415",name:"市政公司用水",icon:"user",matchurl:"/app/detail/countshizheng",url:"/app/detail/countshizheng"},{key:"sidebarsub416",name:"公司销售水清单",icon:"user",matchurl:"/app/detail/countall",url:"/app/detail/countall"}]}]}]}},function(e,t,r){"use strict";e.exports={menus:[{key:"menu1",name:"录入管理",icon:"home",baseurl:"/app/toll",url:"/app/toll/take/0/0/0",child:[{key:"sub11",name:"录入",icon:"user",child:[{key:"sidebarsub111",name:"录入月水费",icon:"user",matchurl:"/app/toll/take/:num/:year/:month",url:"/app/toll/take/0/0/0"},{key:"sidebarsub112",name:"缴费确认",icon:"user",matchurl:"/app/toll/payment",url:"/app/toll/payment"},{key:"sidebarsub113",name:"浏览月水费",icon:"user",matchurl:"/app/toll/list",url:"/app/toll/list"},{key:"sidebarsub114",name:"查询月水费",icon:"user",matchurl:"/app/toll/search",url:"/app/toll/search"},{key:"sidebarsub115",name:"自动创建月水费",icon:"user",matchurl:"/app/toll/prepare",url:"/app/toll/prepare"}]},{key:"sub12",name:"单位",icon:"user",child:[{key:"sidebarsub121",name:"录入单位基本信息",icon:"user",matchurl:"/app/unit/entry",url:"/app/unit/entry"},{key:"sidebarsub122",name:"录入修改托收信息",icon:"user",matchurl:"/app/unit/collection",url:"/app/unit/collection"},{key:"sidebarsub123",name:"单位信息查询",icon:"user",matchurl:"/app/unit/search",url:"/app/unit/search"},{key:"sidebarsub124",name:"录入水贴费",icon:"user",matchurl:"/app/unit/allowedit",url:"/app/unit/allowedit"},{key:"sidebarsub125",name:"水表过户",icon:"user",matchurl:"/app/unit/change",url:"/app/unit/change"},{key:"sidebarsub126",name:"浏览过户信息",icon:"user",matchurl:"/app/unit/changebrowse",url:"/app/unit/changebrowse"},{key:"sidebarsub127",name:"水量错误检查",icon:"user",matchurl:"/app/unit/errorcheck",url:"/app/unit/errorcheck"},{key:"sidebarsub128",name:"更改用户编号",icon:"user",matchurl:"/app/unit/changeid",url:"/app/unit/changeid"}]}]},{key:"menu2",name:"查询管理",icon:"user",baseurl:"/app/search",url:"/app/search/unit",child:[{key:"sub21",name:"查询",icon:"user",child:[{key:"sidebarsub211",name:"单位信息查询",icon:"user",matchurl:"/app/search/unit",url:"/app/search/unit"},{key:"sidebarsub212",name:"水费信息查询",icon:"user",matchurl:"/app/search/toll",url:"/app/search/toll"},{key:"sidebarsub213",name:"单表查询",icon:"user",matchurl:"/app/search/usage/unit",url:"/app/search/usage/unit"},{key:"sidebarsub214",name:"用水企业查询",icon:"user",matchurl:"/app/search/usage/company",url:"/app/search/usage/company"},{key:"sidebarsub215",name:"统计水费",icon:"user",matchurl:"/app/search/stattoll",url:"/app/search/stattoll"}]},{key:"sub22",name:"欠费",icon:"user",child:[{key:"sidebarsub221",name:"按欠费单位统计",icon:"user",matchurl:"/app/search/lackunit",url:"/app/search/lackunit"},{key:"sidebarsub222",name:"催缴管理",icon:"user",matchurl:"/app/search/reminderlist",url:"/app/search/reminderlist"}]}]},{key:"menu3",name:"报表管理",icon:"laptop",baseurl:"/app/report",url:"/app/report/commission",child:[{key:"sub31",name:"报表",icon:"user",child:[{key:"sidebarsub311",name:"委托收款报表",icon:"user",matchurl:"/app/report/commission",url:"/app/report/commission"},{key:"sidebarsub312",name:"水费结算单",icon:"user",matchurl:"/app/report/detail",url:"/app/report/detail"},{key:"sidebarsub313",name:"月汇总表",icon:"user",matchurl:"/app/report/chargemonth",url:"/app/report/chargemonth"},{key:"sidebarsub314",name:"年汇总表",icon:"user",matchurl:"/app/report/chargeyear",url:"/app/report/chargeyear"},{key:"sidebarsub315",name:"贴费汇总表",icon:"user",matchurl:"/app/report/allowance",url:"/app/report/allowance"},{key:"sidebarsub316",name:"委托收款报表_临时",icon:"user",matchurl:"/app/report/commissiontemp",url:"/app/report/commissiontemp"}]}]},{key:"menu4",name:"明细管理",icon:"notification",baseurl:"/app/detail",url:"/app/detail/allowance",child:[{key:"sub41",name:"明细",icon:"user",child:[{key:"sidebarsub411",name:"水贴费",icon:"user",matchurl:"/app/detail/allowance",url:"/app/detail/allowance"},{key:"sidebarsub412",name:"装表费",icon:"user",matchurl:"/app/detail/fixwatch",url:"/app/detail/fixwatch"},{key:"sidebarsub413",name:"用水指标",icon:"user",matchurl:"/app/detail/ration",url:"/app/detail/ration"},{key:"sidebarsub414",name:"供水合同",icon:"user",matchurl:"/app/detail/contract",url:"/app/detail/contract"},{key:"sidebarsub415",name:"市政公司用水",icon:"user",matchurl:"/app/detail/countshizheng",url:"/app/detail/countshizheng"},{key:"sidebarsub416",name:"公司销售水清单",icon:"user",matchurl:"/app/detail/countall",url:"/app/detail/countall"}]}]},{key:"menu5",name:"托收管理",icon:"notification",baseurl:"/app/collection",url:"/app/collection/outputbank",child:[{key:"sub51",name:"托收",icon:"user",child:[{key:"sidebarsub511",name:"按银行生成托收",icon:"user",matchurl:"/app/collection/outputbank",url:"/app/collection/outputbank"},{key:"sidebarsub512",name:"按用户生成托收",icon:"user",matchurl:"/app/collection/outputuser",url:"/app/collection/outputuser"},{key:"sidebarsub513",name:"打印托收信封及清单",icon:"user",matchurl:"/app/collection/rsoutputbank",url:"/app/collection/rsoutputbank"},{key:"sidebarsub514",name:"读取回盘信息",icon:"user",matchurl:"/app/collection/inputdisk",url:"/app/collection/inputdisk"},{key:"sidebarsub515",name:"打印托收明细",icon:"user",matchurl:"/app/collection/outputdetail",url:"/app/collection/outputdetail"},{key:"sidebarsub516",name:"托收统计",icon:"user",matchurl:"/app/collection/outputcount",url:"/app/collection/outputcount"},{key:"sidebarsub517",name:"银行默认设置",icon:"user",matchurl:"/app/collection/banksetup",url:"/app/collection/banksetup"}]}]},{key:"menu6",name:"字典管理",icon:"notification",baseurl:"/app/dict",url:"/app/dict/usekind",child:[{key:"sub61",name:"字典",icon:"user",child:[{key:"sidebarsub611",name:"用水形式字典",icon:"user",matchurl:"/app/dict/usekind",url:"/app/dict/usekind"},{key:"sidebarsub612",name:"收费形式字典",icon:"user",matchurl:"/app/dict/chargekind",url:"/app/dict/chargekind"},{key:"sidebarsub613",name:"抄表形式字典",icon:"user",matchurl:"/app/dict/InputKind",url:"/app/dict/InputKind"},{key:"sidebarsub614",name:"费用标准字典",icon:"user",matchurl:"/app/dict/chargestandard",url:"/app/dict/chargestandard"},{key:"sidebarsub615",name:"防火费标准字典",icon:"user",matchurl:"/app/dict/firestandard",url:"/app/dict/firestandard"}]}]},{key:"menu7",name:"文档管理",icon:"notification",baseurl:"/app/contract",url:"/app/contract/creation",child:[{key:"sub71",name:"供水合同",icon:"user",child:[{key:"sidebarsub711",name:"供水合同创建",icon:"user",matchurl:"/app/contract/creation",url:"/app/contract/creation"},{key:"sidebarsub712",name:"查询",icon:"user",matchurl:"/app/contract/list",url:"/app/contract/list"}]},{key:"sub73",name:"终止供水合同",icon:"user",child:[{key:"sidebarsub731",name:"合同创建",icon:"user",matchurl:"/app/contract/teardowncreation",url:"/app/contract/teardowncreation"},{key:"sidebarsub732",name:"查询",icon:"user",matchurl:"/app/contract/teardownlist",url:"/app/contract/teardownlist"}]},{key:"sub72",name:"文件",icon:"user",child:[{key:"sidebarsub721",name:"资料上传",icon:"user",matchurl:"/app/contract/upload",url:"/app/contract/upload"},{key:"sidebarsub722",name:"资料查询",icon:"user",matchurl:"/app/contract/search",url:"/app/contract/search"}]}]}]}},function(e,t,r){"use strict";e.exports={menus:[{key:"menu1",name:"用水企业",icon:"home",baseurl:"/app/unit",url:"/app/unit/summary",child:[{key:"sub11",name:"信息",icon:"user",child:[{key:"sidebarsub111",name:"水费信息",icon:"user",matchurl:"/app/unit/summary",url:"/app/unit/summary"}]}]}]}},function(e,t,r){"use strict";e.exports=function(e){return{module:{rules:[{test:/\.(js|jsx)$/,loaders:["babel-loader"],include:e}]}}}},function(e,t,r){e.exports={default:r(137),__esModule:!0}},function(e,t,r){"use strict";e.exports=function(e){return{module:{rules:[{test:/\.(css)$/,loaders:["style-loader","css-loader"]}]}}}},function(e,t,r){"use strict";e.exports=function(e){return{module:{rules:[{test:/\.less$/,include:e,loaders:["style-loader","css-loader","less-loader"]}]}}}},function(e,t,r){"use strict";var n=r(142);e.exports=function(e,t){return{plugins:[new n([{context:e,from:"**/*",to:t}])]}}},function(e,t){e.exports=require("extract-text-webpack-plugin")},function(e,t){e.exports=require("clean-webpack-plugin")},function(e,t){e.exports={name:"tbsz_sf",version:"1.0.0",description:"天保市政水费收费系统",main:"index.js",repository:{type:"git",url:"https://github.com/htzguoguo/tbsz_sf.git"},scripts:{stats:"webpack --profile --json > stats.json",test:"karma start","build:client":"webpack --config webpack/client.webpack.config.js --progress -p","build:server":"cross-env NODE_ENV=production webpack --config webpack/server.webpack.config.js --progress",start:"nodemon server/app.js",pru:"set NODE_ENV=production&& node main.js",pru1:"set NODE_ENV=production&& pm2 start main.js --name tbsf",deploy:"gh-pages -d build",tdd:"karma start --auto-watch --no-single-run",flow:"flow check",lint:"eslint ./app ./tests --ext .js --ext .jsx","lint:style":"stylelint app/**/*.css"},keywords:[],author:"",license:"ISC",devDependencies:{"@types/react":"^16.4.6","@types/react-dom":"^16.0.6",alt:"^0.18.6","alt-container":"^1.1.1","alt-utils":"^2.0.0","axios-mock-adapter":"^1.10.0","babel-core":"^6.26.0","babel-eslint":"^8.0.3","babel-loader":"^7.1.2","babel-plugin-import":"^1.6.2","babel-plugin-syntax-decorators":"^6.13.0","babel-plugin-syntax-dynamic-import":"^6.18.0","babel-plugin-transform-class-properties":"^6.24.1","babel-plugin-transform-decorators-legacy":"^1.3.4","babel-plugin-transform-object-rest-spread":"^6.26.0","babel-plugin-transform-runtime":"^6.23.0","babel-preset-env":"^1.6.1","babel-preset-es2015":"^6.24.1","babel-preset-flow":"^6.23.0","babel-preset-latest":"^6.24.1","babel-preset-react":"^6.24.1","babel-preset-react-hmre":"^1.1.1","bcrypt-nodejs":"0.0.3","bignumber.js":"^8.0.1","body-parser":"^1.18.2","clean-webpack-plugin":"^0.1.17",compression:"^1.7.3","compression-webpack-plugin":"^1.1.12","cookie-parser":"^1.4.3","copy-webpack-plugin":"^4.3.0","crispy-string":"0.0.2","cross-env":"^5.1.3","css-loader":"^0.28.7",cssnano:"^3.10.0",docxtemplater:"^3.9.2","es6-shim":"^0.35.3",eslint:"^4.12.1","eslint-loader":"^1.9.0","eslint-plugin-react":"^7.5.1",express:"^4.16.2","express-cache-control":"^1.0.2","express-session":"^1.15.6","express-static-gzip":"^1.1.1","extract-text-webpack-plugin":"^3.0.2","file-loader":"^1.1.5","flow-bin":"^0.60.1",formidable:"^1.2.1","gh-pages":"^1.1.0","html-webpack-plugin":"^2.30.1","html-webpack-template":"^6.1.0","iconv-lite":"^0.4.24","isparta-instrumenter-loader":"^1.0.1","isparta-loader":"^2.0.0",jscs:"^3.0.7","jscs-loader":"^0.3.0",jszip:"^2.6.1",karma:"^1.7.1","karma-chrome-launcher":"^2.2.0","karma-coverage":"^1.1.1","karma-mocha":"^1.3.0","karma-phantomjs-launcher":"^1.0.4","karma-sourcemap-loader":"^0.3.7","karma-spec-reporter":"0.0.31","karma-webpack":"^2.0.6",less:"^2.7.3","less-loader":"^4.0.5",lodash:"^4.17.4",mocha:"^4.0.1","node-uuid":"^1.4.8","npm-install-webpack-plugin":"^4.0.5",nzh:"^1.0.3","optimize-css-assets-webpack-plugin":"^3.2.0","phantomjs-polyfill":"0.0.2","phantomjs-prebuilt":"^2.1.16","postcss-loader":"^2.0.9","react-addons-test-utils":"^15.6.2","react-addons-update":"^15.6.2","react-dnd":"^2.5.4","react-dnd-html5-backend":"^2.5.4","react-dnd-test-backend":"^2.5.4","react-hot-loader":"^3.1.3","redux-devtools":"^3.4.1","redux-devtools-dock-monitor":"^1.1.2","redux-devtools-log-monitor":"^1.4.0",sequelize:"^4.28.6","style-loader":"^0.19.0",stylelint:"^8.3.1","stylelint-config-recommended":"^2.0.0",tedious:"^2.1.5","uglifyjs-webpack-plugin":"^1.1.5",underscore:"^1.8.3","url-loader":"^0.6.2","util.promisify":"^1.0.0",uuid:"^3.1.0",webpack:"^3.8.1","webpack-dev-middleware":"^2.0.3","webpack-dev-server":"^2.9.4","webpack-hot-middleware":"^2.21.0","webpack-merge":"^4.1.1","webpack-node-externals":"^1.6.0",xlsx:"^0.13.2","xlsx-style":"^0.8.13","xlsx-template":"^0.3.1"},dependencies:{antd:"^3.8.2",axios:"^0.17.1","print-html-element":"^0.5.1","print-js":"^1.0.47","prop-types":"^15.6.2",react:"^16.1.1","react-dom":"^16.1.1","react-intl":"^2.4.0","react-redux":"^5.0.6","react-router":"^4.2.0","react-router-dom":"^4.2.2",redux:"^3.7.2","redux-thunk":"^2.2.0","viser-react":"^2.4.2"},bundledDependencies:["cross-env","express"]}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t,r,n){d.default.all([X.query("\n    SELECT A.编号, A.户名, A.区号, F.单价, D.单位性质编号, D.单位性质, E.抄表形式编号,E.抄表形式,F.排污费单价 FROM 水费单位信息 A RIGHT OUTER JOIN 水费字典单位性质 D ON A.单位性质编号 = D.单位性质编号 RIGHT OUTER JOIN \n    水费字典抄表形式 E ON A.抄表形式编号 = E.抄表形式编号 RIGHT OUTER JOIN 水费字典费用标准 F ON A.区号 = F.区号 where A.编号= :no\n    ",{replacements:{no:e},type:X.QueryTypes.SELECT}),X.query("\n    SELECT 年,月,上月表底,本月表底,用水量,计划水量,计划水费,超额水量,超额水费,防火费,手续费\n    ,实收水费,排污费,其它,申请水量,年用水量,剩余水量,减免水量,减免单价,减免水费,减排污费\n    ,减其它,应收水费, 欠费标志 from 水费基本表 where (编号=:no) and (年=:y) and (月=:m)\n    ",{replacements:{no:e,y:t,m:r},type:X.QueryTypes.SELECT})]).then(function(t){var r=[(0,f.default)({},t[0][0],t[1][0])];t?$.ResourceFound(n,r):$.ResourceNotFound(n,{num:e})}).catch(function(t){$.InternalServerError(n,t,{num:e})})}function u(e,t,r,n,a,u){var s="起始"+t,o="终止"+t,c="s"+n,i="t"+n;e[s]&&e[s].length>0&&(u.push(" ("+r+">=:"+c+") "),a[c]=e[s]),e[o]&&e[o].length>0&&(u.push(" ("+r+"<=:"+i+") "),a[i]=e[o])}function s(e,t,r,n,a,u){e[t]&&e[t].length>=1&&(u.push(r),a[n]=e[t])}var o=n(r(48)),c=n(r(49)),i=n(r(86)),p=n(r(3)),l=n(r(4)),f=n(r(50)),d=n(r(55)),y=function(){var e=(0,l.default)(p.default.mark(function e(t,r){var n,a;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,h(n,"Select * from 水费报表查询 ");case 4:a=e.sent,$.ResourceFound(r,a),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),$.InternalServerError(r,e.t0,n);case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),h=function(){var e=(0,l.default)(p.default.mark(function e(t,r){var n,a,o,c,i;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r,a={},o=[],t["户名"]&&t["户名"].length>1&&(t["户名"]="%"+t["户名"]+"%"),u(t,"年月","年+月","date",a,o),u(t,"编号","编号","num",a,o),s(t,"户名"," (户名 like :name) ","name",a,o),s(t,"费用标准"," (区号 = :chargestandard) ","chargestandard",a,o),s(t,"抄表形式"," (抄表形式编号 = :inputkind) ","inputkind",a,o),s(t,"用水形式"," (用水形式编号 = :usekind) ","usekind",a,o),s(t,"收费形式"," (收费形式编号 = :chargekind) ","chargekind",a,o),u(t,"上月表底","上月表底","lastmonth",a,o),u(t,"本月表底","本月表底","currentmonth",a,o),u(t,"用水量","用水量","usewater",a,o),u(t,"计划水量","计划水量","planwater",a,o),u(t,"计划水费","计划水费","plancharge",a,o),u(t,"应收水费","应收水费","accountcharge",a,o),u(t,"超额水量","超额水量","overwater",a,o),u(t,"超额水费","超额水费","overcharge",a,o),u(t,"排污费","排污费","pollute",a,o),u(t,"防火费","防火费","fire",a,o),u(t,"手续费","手续费","commission",a,o),u(t,"其它","其它","others",a,o),u(t,"申请水量","申请水量","applywater",a,o),u(t,"年用水量","年用水量","yearwater",a,o),u(t,"剩余水量","剩余水量","remainwater",a,o),u(t,"减免水费","减免水费","minuscharge",a,o),u(t,"减其它","减其它","minusothers",a,o),u(t,"实收水费","实收水费","truecharge",a,o),function(e,t,r,n){e[t]&&n.push(r)}(t,"欠费标志"," (欠费标志='2') ",o),c=o.join(" and "),n+=c.length>2?" where "+c:"",e.next=34,X.query(n,{replacements:a,type:X.QueryTypes.SELECT});case 34:return i=e.sent,e.abrupt("return",i);case 36:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}(),m=function(){var e=(0,l.default)(p.default.mark(function e(t,r){var n,a,u,s,o;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params,a=n.year,u=n.month,e.prev=1,s="\n        select 编号 from 水费基本表 where (年=:y) and (月=:m) \n        ",e.next=5,X.query(s,{replacements:{y:a,m:u},type:X.QueryTypes.SELECT});case 5:o=e.sent,$.ResourceFound(r,o),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),$.InternalServerError(r,e.t0,{year:a,month:u});case 12:case"end":return e.stop()}},e,this,[[1,9]])}));return function(t,r){return e.apply(this,arguments)}}(),v=function(){var e=(0,l.default)(p.default.mark(function e(t,r){var n,a,u,s,o;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params,a=n.num,u=n.year,e.prev=1,s="\n        select * from 水费基本表 where (年=:y) and (编号=:no) order by 月 desc\n        ",e.next=5,X.query(s,{replacements:{y:u,no:a},type:X.QueryTypes.SELECT});case 5:o=e.sent,$.ResourceFound(r,o),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),$.InternalServerError(r,e.t0,{year:u,num:a});case 12:case"end":return e.stop()}},e,this,[[1,9]])}));return function(t,r){return e.apply(this,arguments)}}(),x=function(){var e=(0,l.default)(p.default.mark(function e(t,r){var n;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,w();case 3:n=e.sent,$.ResourceFound(r,n),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),$.InternalServerError(r,e.t0,{});case 10:case"end":return e.stop()}},e,this,[[0,7]])}));return function(t,r){return e.apply(this,arguments)}}(),w=function(){var e=(0,l.default)(p.default.mark(function e(){var t,r,n,a,u,s,o,c,i;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t={},r="\n    SELECT  区号,单位类别,单价 from 水费字典费用标准 Order By 区号 \n    ",e.next=4,X.query(r,{replacements:{},type:X.QueryTypes.SELECT});case 4:return n=e.sent,t.charges=n,a="\n    SELECT  * from 水费字典抄表形式 Order By 抄表形式编号 \n    ",e.next=9,X.query(a,{replacements:{},type:X.QueryTypes.SELECT});case 9:return u=e.sent,t.inputkinds=u,s="\n    SELECT  * from 水费字典用水形式 Order By 用水形式编号 \n    ",e.next=14,X.query(s,{replacements:{},type:X.QueryTypes.SELECT});case 14:return o=e.sent,t.usekinds=o,c="\n    SELECT  * from 水费字典收费形式 Order By 收费形式编号 \n    ",e.next=19,X.query(c,{replacements:{},type:X.QueryTypes.SELECT});case 19:return i=e.sent,t.chargekinds=i,t.dd=Z(new Date,"yyyymm"),e.abrupt("return",t);case 23:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),b=function(){var e=(0,l.default)(p.default.mark(function e(t,r){var n,a,u,s,o;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params,a=n.year,u=n.month,e.prev=1,s="\n        delete from  水费基本表  where 实收水费=0 and (年=:y) and (月=:m) \n        ",e.next=5,X.query(s,{replacements:{y:a,m:u},type:X.QueryTypes.DELETE});case 5:o=e.sent,$.ResourceFound(r,o),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),$.InternalServerError(r,e.t0,{year:a,month:u});case 12:case"end":return e.stop()}},e,this,[[1,9]])}));return function(t,r){return e.apply(this,arguments)}}(),E=function(){var e=(0,l.default)(p.default.mark(function e(t,r){var n,a;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,S(n);case 4:a=e.sent,$.ResourceFound(r,a),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),$.InternalServerError(r,e.t0,n);case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),S=function(){var e=(0,l.default)(p.default.mark(function e(t){var r,n,a,u,s,o,c,i,l,f,d=t.year,y=t.month,h=t.commission,m=t.others,v=t.user;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=void 0,n=void 0,"01"===y?(r=(parseInt(d)-1).toString(),n="12"):(r=d,n=(n=parseInt(y)-1)<10?"0"+n.toString():n.toString()),a="\n    delete from 水费基本表  where (年=:y) and (月=:m) \n    ",e.next=5,X.query(a,{replacements:{y:d,m:y},type:X.QueryTypes.DELETE});case 5:return u="\n        Insert Into 水费基本表 (年,月,编号,户名,上月表底,本月表底,用水量,计划水量,计划水费,超额水量,超额水费,防火费,手续费,实收水费,排污费,其它,欠费标志,大写,操作员,操作时间,申请水量,年用水量,剩余水量) \n            select :year, :month,编号,户名,本月表底,本月表底,0,0,0,0,0,0,手续费,0,0,:others,'1','','','',申请水量,0,0 from 水费基本表      \n            where (年=:y) and (月=:m)\n        ",e.next=8,X.query(u,{replacements:{y:r,m:n,year:d,month:y,others:m},type:X.QueryTypes.INSERT});case 8:return s="\n    Insert Into 水费基本表 (年,月,编号,户名,上月表底,本月表底,用水量,计划水量,计划水费,超额水量,超额水费,防火费,手续费,实收水费,排污费,其它,大写,操作员,操作时间,申请水量,年用水量,剩余水量,欠费标志)\n        select :y, :m, 编号,户名,0,0,0,0,0,0,0,0, :commission, 0,0,0,'','','',申请水量,0,0, '1' from 水费单位信息\n        Where 编号 not in ( Select 编号 from 水费基本表 where (年=:y) and (月=:m))  and 节门状态='开'\n        ",e.next=11,X.query(s,{replacements:{y:d,m:y,commission:h},type:X.QueryTypes.INSERT});case 11:return o="\n    delete from  水费基本表\n        Where 编号 in ( Select 编号 from 水费单位信息 where 节门状态='闭') and 年=:y and 月=:m    \n    ",e.next=14,X.query(o,{replacements:{y:d,m:y},type:X.QueryTypes.DELETE});case 14:return c="\n    update 水费基本表 set 防火费=(SELECT B.防火费 FROM 水费字典防火标准 B INNER JOIN 水费单位信息 A ON B.防火标准编号 = A.防火标准编号 Where A.编号=水费基本表.编号)\n        where (年=:y) and (月=:m)\n    ",e.next=17,X.query(c,{replacements:{y:d,m:y},type:X.QueryTypes.UPDATE});case 17:return i="\n    update 水费基本表 \n        set 单价=(SELECT B.单价 FROM 水费字典费用标准 B INNER JOIN 水费单位信息 A ON B.区号 = A.收费形式编号 Where A.编号=水费基本表.编号)\n        where (年=:y) and (月=:m)\n    ",e.next=20,X.query(i,{replacements:{y:d,m:y},type:X.QueryTypes.UPDATE});case 20:return l="\n    update 水费基本表 set 操作员=:user,操作时间=:dd\n        where (年=:y) and (月=:m)\n    ",e.next=23,X.query(l,{replacements:{y:d,m:y,user:v,dd:Z(new Date,"yyyy-mm-dd")},type:X.QueryTypes.UPDATE});case 23:return f="\n    update 水费基本表 set 实收水费=计划水费+超额水费+防火费+手续费+排污费+其它\n        where (年=:y) and (月=:m)\n    ",e.next=26,X.query(f,{replacements:{y:d,m:y},type:X.QueryTypes.UPDATE});case 26:return e.abrupt("return",{desc:"月水费自动创建完毕!"});case 27:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),k=function(){var e=(0,l.default)(p.default.mark(function e(t,r){var n,a,u,s,o;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params,a=n.year,u=n.month,s=n.type,e.prev=1,e.next=4,g(a,u,s);case 4:o=e.sent,$.ResourceFound(r,[o]),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),$.InternalServerError(r,e.t0,{year:a,month:u,type:s});case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),g=function(){var e=(0,l.default)(p.default.mark(function e(t,r,n){var a,u,s,o;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a="\n    select sum(用水量) as 水量,count(编号) as 户数,sum(应收水费) as 水费 from 水费修改计算 \n        where (年=:y) and (月=:m) and 编号<'2000' \n    ",e.next=3,X.query(a,{replacements:{y:t,m:r},type:X.QueryTypes.SELECT});case 3:return u=e.sent,s="\n    select sum(用水量) as 水量,count(编号) as 户数,sum(应收水费) as 水费 from 水费修改计算 \n        where (年=:y) and (月=:m) and 编号>='2000' \n    ",e.next=7,X.query(s,{replacements:{y:t,m:r},type:X.QueryTypes.SELECT});case 7:if(o=e.sent,1!==u.length||1!==o.length){e.next=14;break}return u=u[0],o=o[0],e.abrupt("return",{"临时户":u.户数,"临时户水量":u.水量?u.水量:0,"临时户水费":u.水费?u.水费:0,"正式户":o.户数,"正式户水量":o.水量?o.水量:0,"正式户水费":o.水费?o.水费:0,"总水量":o.水量&&u.水量?parseInt(u.水量)+parseInt(o.水量):0});case 14:return e.abrupt("return",{});case 15:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}(),T=function(){var e=(0,l.default)(p.default.mark(function e(t,r){var n,a,u,s,o;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params,a=n.year,u=n.month,s=n.type,e.prev=1,e.next=4,F(a,u,s);case 4:o=e.sent,r.writeHead(200,[["Content-Type","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"]]),r.end(new Buffer(o,"base64")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),$.InternalServerError(r,e.t0,{year:a,month:u,type:s});case 12:case"end":return e.stop()}},e,this,[[1,9]])}));return function(t,r){return e.apply(this,arguments)}}(),F=function(){var e=(0,l.default)(p.default.mark(function e(t,r,n){var a,u,s,o,c,i,l,d,y;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a="\n    Select * from 水费报表查询  where (年=:y) and (月=:m) Order by 编号\n    ",e.next=3,X.query(a,{replacements:{y:t,m:r},type:X.QueryTypes.SELECT});case 3:if(!((u=e.sent).length>0)){e.next=12;break}return s="\n        Select  count(*) as 户, sum(上月表底) as 上月表底, sum(本月表底) as 本月表底,\n        sum(实际用水量) as 实际用水量, sum(实际计划水费) as 实际计划水费, \n        sum(超额水量) as 超额水量, sum(超额水费) as 超额水费,   \n        sum(排污费) as 排污费, sum(防火费) as 防火费, \n        sum(手续费) as 手续费, sum(其它) as 其它,\n        sum(减水费) as 减水费, sum(实收水费) as 实收水费\n            from 水费报表查询\n            where (年=:y) and (月=:m)\n        ",e.next=8,X.query(s,{replacements:{y:t,m:r},type:X.QueryTypes.SELECT});case 8:o=e.sent,u.forEach(function(e,t){e.水费合计="=S"+(t+4)+"-M"+(t+4)}),c=u.length,u.push((0,f.default)({"编号":"合计","户名":o[0].户+"户","装表地点":"","单价":"","排污费单价":"","超额水价":"","申请水量":"","水费合计":"=SUM(R4:R"+(c+3)+")","使用期限":"","剩余水量":""},o[0]));case 12:return i=J.readFileSync(K.join("./","assets","excel","水费浏览.xlsx")),l=new G(i),d="Sheet1",y={year:t,month:r,date:Z(new Date,"yyyy-mm-dd"),fees:u},l.substitute(d,y),e.abrupt("return",l.generate({type:"base64"}));case 18:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}(),C=function(){var e=(0,l.default)(p.default.mark(function e(t,r){var n,a;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,q(n);case 4:a=e.sent,r.writeHead(200,[["Content-Type","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"]]),r.end(new Buffer(a,"base64")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),$.InternalServerError(r,e.t0,{});case 12:case"end":return e.stop()}},e,this,[[1,9]])}));return function(t,r){return e.apply(this,arguments)}}(),q=function(){var e=(0,l.default)(p.default.mark(function e(t){var r,n,a,u,s,o,c,i;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h(t,"Select * from 水费报表查询 ");case 2:if(!((r=e.sent).length>0)){e.next=11;break}return n="\n        Select  count(*) as 户, sum(上月表底) as 上月表底, sum(本月表底) as 本月表底,\n        sum(实际用水量) as 实际用水量, sum(实际计划水费) as 实际计划水费, \n        sum(超额水量) as 超额水量, sum(超额水费) as 超额水费,   \n        sum(排污费) as 排污费, sum(防火费) as 防火费, \n        sum(手续费) as 手续费, sum(其它) as 其它,\n        sum(减水费) as 减水费, sum(实收水费) as 实收水费\n            from 水费报表查询\n        ",e.next=7,h(t,n);case 7:a=e.sent,r.forEach(function(e,t){e.水费合计="=U"+(t+4)+"-O"+(t+4)}),u=r.length,r.push((0,f.default)({"编号":"","户名":"","装表地点":"","单价":"","排污费单价":"","年":"合计","月":a[0].户+"户","超额水价":"","申请水量":"","水费合计":"=SUM(T4:T"+(u+3)+")","使用期限":"","剩余水量":""},a[0]));case 11:return s=J.readFileSync(K.join("./","assets","excel","水费查询.xlsx")),o=new G(s),c="Sheet2",i={date:Z(new Date,"yyyy-mm-dd"),fees:r},o.substitute(c,i),e.abrupt("return",o.generate({type:"base64"}));case 17:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),I=function(){var e=(0,l.default)(p.default.mark(function e(t,r,n){var u,s,o,c,i,l,f;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return u=t.params,s=u.num,o=u.year,c=u.month,i=u.type,l=void 0,l="prior"===n?"\n        Select 编号 from 水费用水量查询 where (编号<:no) and (年=:y) and (月=:m)\n        ":"\n        Select 编号 from 水费用水量查询 where (编号>:no) and (年=:y) and (月=:m)\n        ","1"===i?l+="and (抄表形式编号='1')":"2"===i&&(l+=" and (抄表形式编号='2')"),l+="prior"===n?" Order by 编号 desc":" Order by 编号",e.next=7,X.query(l,{replacements:{no:s,y:o,m:c},type:X.QueryTypes.SELECT});case 7:(f=e.sent).length>0?a(f[0].编号,o,c,r):$.ResourceNotFound(r,{},"没有发现记录");case 9:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}(),A=function(){var e=(0,l.default)(p.default.mark(function e(t,r){var n,a;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,L(n);case 4:a=e.sent,$.ResourceFound(r,[a]),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),$.InternalServerError(r,e.t0,{num:n.编号});case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),L=function(){var e=(0,l.default)(p.default.mark(function e(t){var r,n,a,u,s,o,c,i,l,f,d,y,h,m,v,x,w,b,E,S,k,g,T,F,C,q,I,A,L,R,_,Q,N,D,M,U,O,j,B,P,H,W,z,G,J,K,Y;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.编号,n=t.年,a=t.月,u=t.本月表底,s=t.上月表底,o=t.手续费,c=t.其它,i=t.减免水量,l=t.减免单价,t.减排污费,f=t.减其它,d=t.老表水费,y=void 0,h=void 0,m=void 0,v=void 0,x=void 0,w=void 0,b=void 0,E=0,S=0,k=0,g=0,T=parseFloat(i),F=parseFloat(l),C=parseFloat(f),q=parseFloat(d),I="\n    SELECT 编号,用水量,手续费,其它,原申请水量,用水日期,使用期限,定额,单价,防火费,超计划,排污费单价,排污费超额,扣水单位编号 \n        FROM 水费修改计算 where (编号=:no) and (年=:y) and (月=:m)\n    ",e.next=13,X.query(I,{replacements:{no:r,y:n,m:a},type:X.QueryTypes.SELECT});case 13:if(A=e.sent,!((L=Number(u-s))<0)){e.next=17;break}throw new Error("出现错误,请检查录入数据的准确性! 错误原因: 本月表底 < 上月表底");case 17:if(R=A[0],_=parseFloat(R.单价),h=parseFloat(R.超计划),Q=parseFloat(R.排污费单价),N=parseFloat(R.排污费超额),D=parseFloat(R.防火费),M=parseFloat(o),U=parseFloat(c),O=parseFloat(R.定额),j=parseFloat(R.原申请水量),B=R.使用期限,P=R.用水日期,!(j>0)){e.next=46;break}if(H=void 0,!(P<"20030101")){e.next=38;break}return W="Select sum(用水量) as sss from 水费用水量查询 where (年+月>='200301') and  (扣水单位编号=:no)",e.next=35,X.query(W,{replacements:{no:R.扣水单位编号},type:X.QueryTypes.SELECT});case 35:H=e.sent,e.next=42;break;case 38:return z="Select sum(用水量) as sss from 水费用水量查询 where (年+月>=:dd) and  (扣水单位编号=:no)",e.next=41,X.query(z,{replacements:{dd:P,no:R.扣水单位编号},type:X.QueryTypes.SELECT});case 41:H=e.sent;case 42:G=parseInt(H[0].sss),S=G-parseInt(R.用水量)+L,(E=j-S)<0?-E>=L?(k=L,g=0):(k=-E,g=L+E):(k=0,g=L);case 46:if(0!==j){e.next=56;break}return J="Select sum(用水量) as sss from 水费用水量查询 where (扣水单位编号=:no) and (年=:y) and (月=:m)",e.next=50,X.query(J,{replacements:{no:R.扣水单位编号,y:n,m:a},type:X.QueryTypes.SELECT});case 50:K=e.sent,Y=parseInt(K[0].sss),j=O*V(n+"-"+a,"YYYY-MM").daysInMonth(),S=Y-parseInt(R.用水量)+L,E=30*O-S,n+a>B.slice(0,6)?(k=L,g=0):E<0?-E>=L?(k=L,g=0):(k=-E,g=L+E):(k=0,g=L);case 56:return y=L*_,h=k*(h-_)+k*(N-Q),m=L*Q,v=y+h+D+M+m+U,x=T*F,w=T*Q,b=v-x-w-C,b+=q,A={"用水量":L,"计划水量":g,"计划水费":y,"超额水量":k,"超额水费":h,"防火费":D,"手续费":M,"排污费":parseFloat(m).toFixed(2),"应收水费":parseFloat(v).toFixed(2),"年用水量":S,"剩余水量":E,"申请水量":0===j?30*O:j,"减免水费":x,"减排污费":w,"实收水费":parseFloat(b).toFixed(2)},e.abrupt("return",A);case 66:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),R=function(){var e=(0,l.default)(p.default.mark(function e(t,r){var n,a,u,s;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.body||{},e.prev=1,!(n&&n.length>0)){e.next=15;break}a=0;case 4:if(!(a<n.length)){e.next=15;break}return u=n[a],e.next=8,L(u);case 8:return s=e.sent,u=(0,i.default)({},u,s),e.next=12,Q(u);case 12:a++,e.next=4;break;case 15:$.ResourceUpdated(r,{result:!0,msg:"ok"}),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(1),$.InternalServerError(r,e.t0,{result:!1,msg:e.t0.message});case 21:case"end":return e.stop()}},e,this,[[1,18]])}));return function(t,r){return e.apply(this,arguments)}}(),_=function(){var e=(0,l.default)(p.default.mark(function e(t,r){var n;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,Q(n);case 4:"1"===e.sent?$.ResourceUpdated(r,"编号"+n.编号+"收费信息更新完成！"):$.ResourceCreated(r,"编号"+n.编号+"收费信息添加完成！"),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),$.InternalServerError(r,e.t0,{num:n.编号});case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),Q=function(){var e=(0,l.default)(p.default.mark(function e(t){var r,n,a,u,s,o,c,i,l,f,d,y,h,m,v,x,w,b,E,S,k,g,T,F,C,q,I,A,L,R,_,Q,N;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.编号,n=t.年,a=t.月,u=t.户名,s=t.上月表底,o=t.本月表底,c=t.用水量,i=t.计划水量,l=t.计划水费,f=t.超额水量,d=t.超额水费,y=t.防火费,h=t.手续费,m=t.实收水费,v=t.排污费,x=t.其它,w=t.欠费标志,b=t.操作员,E=t.申请水量,S=t.年用水量,k=t.剩余水量,g=t.减免水量,T=t.减免单价,F=t.减免水费,C=t.减其它,q=t.减排污费,I=t.应收水费,A="\n    select 编号 from 水费基本表 where (编号=:no) and (年=:y) and (月=:m)           \n    ",L={a1:n,a2:a,a3:r,a4:u,a5:parseInt(s),a6:parseInt(o),a7:parseInt(c),a8:parseFloat(i).toFixed(2),a9:parseFloat(l).toFixed(2),a10:parseFloat(f).toFixed(2),a11:parseFloat(d).toFixed(2),a12:parseFloat(y).toFixed(2),a13:parseFloat(h).toFixed(2),a14:parseFloat(m).toFixed(2),a15:parseFloat(v).toFixed(2),a16:parseFloat(x).toFixed(2),a17:w?"2":"1",a18:z.toMoney(parseFloat(m).toFixed(2)),a19:function(e){var t=void 0;try{Y.config({DECIMAL_PLACES:2}),t=Y(e).multipliedBy(100).toString().split("")}catch(e){throw new Error("钱数不是合法的浮点数,请检查!")}return"￥"+t.join(" ")}(parseFloat(m).toFixed(2)),a20:b,a21:Z(new Date,"yyyy-mm-dd"),a22:parseFloat(E).toFixed(2),a23:parseFloat(S).toFixed(2),a24:parseFloat(k).toFixed(2),a25:parseFloat(g).toFixed(2),a26:parseFloat(T).toFixed(2),a27:parseFloat(F).toFixed(2),a28:parseFloat(C).toFixed(2),a29:parseFloat(I).toFixed(2),a30:parseFloat(q).toFixed(2)},e.next=5,X.query(A,{replacements:{no:r,y:n,m:a},type:X.QueryTypes.SELECT});case 5:if(R=e.sent,_=void 0,!(R.length>0)){e.next=14;break}return Q="\n        update 水费基本表 set  户名=:a4,上月表底=:a5,本月表底=:a6,用水量=:a7,计划水量=:a8,计划水费=:a9,超额水量=:a10,超额水费=:a11,防火费=:a12,手续费=:a13,实收水费=:a14,排污费=:a15,其它=:a16, \n        欠费标志=:a17,大写=:a18,小写=:a19,操作员=:a20,操作时间=:a21,申请水量=:a22,年用水量=:a23,剩余水量=:a24,减免水量=:a25,减免单价=:a26,减免水费=:a27,减其它=:a28,应收水费=:a29,减排污费=:a30\n            where (年=:a1) and (月=:a2) and (编号 =:a3)\n        ",e.next=11,X.query(Q,{replacements:L,type:X.QueryTypes.UPDATE});case 11:_="1",e.next=18;break;case 14:return N="\n        Insert Into 水费基本表 (年,月,编号,户名,上月表底,本月表底,用水量,计划水量,计划水费,超额水量,超额水费,防火费,手续费,实收水费,排污费,其它,欠费标志,大写,小写,操作员,操作时间,申请水量,年用水量,剩余水量,\n            减免水量,减免单价,减免水费,减其它,应收水费,减排污费 )\n            Values (:a1,:a2,:a3,:a4,:a5,:a6,:a7,:a8,:a9,:a10,:a11,:a12,:a13,:a14,:a15,:a16,:a17,:a18,:a19,:a20,:a21,:a22,:a23,:a24,:a25,:a26,:a27,:a28,:a29,:a30 )                \n        ",e.next=17,X.query(N,{replacements:L,type:X.QueryTypes.INSERT});case 17:_="1";case 18:return e.abrupt("return",_);case 19:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),N=function(){var e=(0,l.default)(p.default.mark(function e(t,r){var n,a,u,s,o;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params,a=n.num,u=n.year,s=n.month,e.prev=1,e.next=4,D(a,u,s);case 4:o=e.sent,$.ResourceFound(r,[o]),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),$.InternalServerError(r,e.t0,{num:a,year:u,month:s});case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),D=function(){var e=(0,l.default)(p.default.mark(function e(t,r,n){var a,u;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a="\n    delete from 水费基本表\n        where (年=:y) and (月=:m) and (编号=:no) \n    ",e.next=3,X.query(a,{replacements:{no:t,y:r,m:n},type:X.QueryTypes.SELECT});case 3:return u=e.sent,e.abrupt("return",u);case 5:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}(),M=function(){var e=(0,l.default)(p.default.mark(function e(t,r){var n,a;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body,e.prev=1,e.next=4,U(n);case 4:a=e.sent,$.ResourceFound(r,[a]),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),$.InternalServerError(r,e.t0,n);case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),U=function(){var e=(0,l.default)(p.default.mark(function e(t){var r,n,a,u,s;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=re(t,"编号"),n=t[0].年,a=t[0].月,u="\n  Update 水费基本表 set 欠费标志=:a2 where \n    (编号 in ("+r.join(",")+")) \n    and (年=:year) and (月=:month)\n  ",e.next=6,X.query(u,{replacements:{year:n,month:a,a2:"1"},type:X.QueryTypes.UPDATE});case 6:return s=e.sent,e.abrupt("return",s);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),O=function(){var e=(0,l.default)(p.default.mark(function e(t,r){var n,a;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,j(n);case 4:a=e.sent,$.ResourceFound(r,a),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),$.InternalServerError(r,e.t0,{obj:n});case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),j=function(){var e=(0,l.default)(p.default.mark(function e(t){var r,n,a;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=[],e.next=3,te([t.编号]);case 3:if(!((n=e.sent)&&n.length>0&&n[0].托收电话)){e.next=11;break}return e.next=7,ee(n[0].托收电话,"贵企业用本月份水量已超计划, 超计划水量为["+Math.abs(t.超额水量)+"]。");case 7:a=e.sent,r.push((0,f.default)({},t,{desc:a.data})),e.next=12;break;case 11:r.push((0,f.default)({},t,{desc:"error:Missing recipient"}));case 12:return e.abrupt("return",r);case 13:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),B=function(){var e=(0,l.default)(p.default.mark(function e(t,r){var n,a;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body,e.prev=1,e.next=4,P(n);case 4:a=e.sent,$.ResourceFound(r,a),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),$.InternalServerError(r,e.t0,n);case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),P=function(){var e=(0,l.default)(p.default.mark(function e(t){var r,n,a,u,s,i,l,f,d;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h(t,"Select * from 水费报表查询 ");case 2:for(r=e.sent,n=new c.default,r.forEach(function(e){e.户名=t.户名.substring(1,t.户名.length-1),e.上月表底="",e.本月表底="";var r=e.年+e.月;if(n.has(r)){var a=n.get(r);a.实际用水量=ne(a.实际用水量,e.实际用水量),a.实际计划水费=ne(a.实际计划水费,e.实际计划水费),a.超额水量=ne(a.超额水量,e.超额水量),a.超额水费=ne(a.超额水费,e.超额水费),a.防火费=ne(a.防火费,e.防火费),a.手续费=ne(a.手续费,e.手续费),a.减水费=ne(a.减水费,e.减水费),a.实收水费=ne(a.实收水费,e.实收水费),a.排污费=ne(a.排污费,e.排污费),a.其它=ne(a.其它,e.其它)}else n.set(r,e)}),a=[],u=!0,s=!1,i=void 0,e.prev=9,l=(0,o.default)(n);!(u=(f=l.next()).done);u=!0)d=f.value,a.push(d[1]);e.next=17;break;case 13:e.prev=13,e.t0=e.catch(9),s=!0,i=e.t0;case 17:e.prev=17,e.prev=18,!u&&l.return&&l.return();case 20:if(e.prev=20,!s){e.next=23;break}throw i;case 23:return e.finish(20);case 24:return e.finish(17);case 25:return e.abrupt("return",a);case 26:case"end":return e.stop()}},e,this,[[9,13,17,25],[18,,20,24]])}));return function(t){return e.apply(this,arguments)}}(),H=function(){var e=(0,l.default)(p.default.mark(function e(t,r){var n,a;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,W(n);case 4:a=e.sent,r.writeHead(200,[["Content-Type","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"]]),r.end(new Buffer(a,"base64")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),$.InternalServerError(r,e.t0,{});case 12:case"end":return e.stop()}},e,this,[[1,9]])}));return function(t,r){return e.apply(this,arguments)}}(),W=function(){var e=(0,l.default)(p.default.mark(function e(t){var r,n;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P(t,"Select * from 水费报表查询 ");case 2:return r=e.sent,n={date:Z(new Date,"yyyy-mm-dd"),items:r},e.abrupt("return",ae("chargeyearcorp","Sheet2",n));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),z=(r(19),r(88)),G=r(51),J=r(26),K=r(9),V=r(90),Y=r(91),Z=r(12),$=r(1),X=r(8),ee=r(92).sendSMS,te=r(52).queryPersonAndNumber,re=r(201).getPropertyFromArray,ne=r(202).plus,ae=r(27).toExcel;Y.config({DECIMAL_PLACES:2}),e.exports.queryWaterFee=a,e.exports.queryWaterFees=function(e,t,r,n){var a="\n    Select * from 水费修改计算  where (年=:y) and (月=:m) \n    ";"1"===r?a+="and (抄表形式编号='1')":"2"===r&&(a+=" and (抄表形式编号='2')"),X.query(a,{replacements:{y:e,m:t},type:X.QueryTypes.SELECT}).then(function(r){r.length>0?$.ResourceFound(n,r):$.ResourceNotFound(n,{y:e,m:t})}).catch(function(r){$.InternalServerError(n,r,{y:e,m:t})})},e.exports.searchWaterFees=y,e.exports.queryWaterFeesNum=m,e.exports.queryWaterFeesYearlyByNum=v,e.exports.queryFeeParas=x,e.exports.eraseZeroWaterFees=b,e.exports.prepareWaterFees=E,e.exports.statisticsWaterFees=k,e.exports.waterFeeToExcel=T,e.exports.searchToExcel=C,e.exports.MoveWaterFeePosition=I,e.exports.calculateWaterFee=A,e.exports.saveWaterFees=R,e.exports.saveWaterFee=_,e.exports.deleteWaterFee=N,e.exports.CompletePayment=M,e.exports.sendOverUsageSMS=O,e.exports.SearchFeesByCompany=B,e.exports.searchByCompanyToExcel=H},function(e,t,r){var n=r(41)("meta"),a=r(11),u=r(21),s=r(13).f,o=0,c=Object.isExtensible||function(){return!0},i=!r(18)(function(){return c(Object.preventExtensions({}))}),p=function(e){s(e,n,{value:{i:"O"+ ++o,w:{}}})},l=e.exports={KEY:n,NEED:!1,fastKey:function(e,t){if(!a(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!u(e,n)){if(!c(e))return"F";if(!t)return"E";p(e)}return e[n].i},getWeak:function(e,t){if(!u(e,n)){if(!c(e))return!0;if(!t)return!1;p(e)}return e[n].w},onFreeze:function(e){return i&&l.NEED&&c(e)&&!u(e,n)&&p(e),e}}},function(e,t,r){var n=r(11);e.exports=function(e,t){if(!n(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e}},function(e,t,r){e.exports={default:r(185),__esModule:!0}},function(e,t){t.f={}.propertyIsEnumerable},function(e,t,r){var n=r(189),a={s:r(191),b:r(192)};e.exports=n(a.s,a.b)},function(e,t,r){"use strict";var n=/^([+-])?0*(\d+)(\.(\d+))?$/,a=/^([+-])?0*(\d+)(\.(\d+))?e(([+-])?(\d+))$/i,u=t.e2ten=function(e){var t=a.exec(e.toString());if(!t)return e;var r=t[2],n=t[4]||"",u=t[5]?+t[5]:0;if(u>0){var s=n.substr(0,u);s=s.length<u?s+new Array(u-s.length+1).join("0"):s,n=n.substr(u),r+=s}else{u=-u;var o=r.length-u;o=o<0?0:o;var c=r.substr(o,u);c=c.length<u?new Array(u-c.length+1).join("0")+c:c,r=r.substring(0,o),n=c+n}return r=""==r?"0":r,("-"==t[1]?"-":"")+r+(n?"."+n:"")};t.getNumbResult=function(e){var t=n.exec(e.toString());if(!t&&a.test(e.toString())&&(t=n.exec(u(e.toString()))),t)return{int:t[2],decimal:t[4],minus:"-"==t[1],num:t.slice(1,3).join("")}},t.centerArray=function e(t,r){if(t.splice.apply(t,[0,r.length].concat(r.splice(0,r.length))),arguments.length>2){var n=[].slice.call(arguments,2);n.unshift(t),e.apply(null,n)}return t};var s=t.hasAttr=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};t.extend=function(e){for(var t,r=arguments[0]||{},n=Array.prototype.slice.call(arguments,1),a=0;a<n.length;a++){var u=n[a];for(t in u)s(u,t)&&(r[t]=u[t])}return r},t.getDigit=function(e){return e>=5?4*(e-4)+4:e},t.unshiftZero=function(e,t){if(null==t&&(t=1),!(t<=0))for(;t--;)e.unshift(0)},t.clearZero=function(e,t,r){if(null==e)return"";var n=~"*.?+$^[](){}|\\/".indexOf(t)?"\\"+t:t,a=new RegExp("^"+n+"+"),u=new RegExp(n+"+$"),s=new RegExp(n+"{2}","g");return e=e.toString(),"^"==r&&(e=e.replace(a,"")),r&&"$"!=r||(e=e.replace(u,"")),r&&"nto1"!=r||(e=e.replace(s,t)),e}},function(e,t){e.exports=require("moment")},function(e,t){e.exports=require("bignumber.js")},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var a=n(r(3)),u=n(r(4)),s=r(193),o=r(194);e.exports.sendSMS=function(){var e=(0,u.default)(a.default.mark(function e(t,r){var n,u,c;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.stringify({content:r}),u="http://m.5c.com.cn/api/send/?apikey=b693a36ea67a3677ad8ba03220df6798&username=rongshu1&password=rstjftz1&mobile="+t+"&"+n,e.next=4,s.get(u);case 4:return c=e.sent,e.abrupt("return",c);case 6:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},function(e,t,r){"use strict";var n=r(0),a=(r(9),r(94)),u=r(95),s=r(96),o=(new(r(97))).middleware,c=r(54),i=r(126),p=r(156),l=r(157),f=r(230),d=n(),y=Object({NODE_ENV:"production"}).PORT||8181;d.use(s.json()),d.use(s.urlencoded({extended:!1})),d.use(u("login")),d.use(a({secret:"TKRv0IJs=HYqrvagQ#&!F!%V]Ww/4KiVs$s,<<MX",resave:!0,saveUninitialized:!0,cookie:{maxAge:3e5}})),i(d),d.use("/api/v1/auth",o("minutes",2),p),d.use("/api/v1",c.authorizationRequired,l),d.use("/api/v2",f),e.exports=d;d.listen(y).setTimeout(5e5)},function(e,t){e.exports=require("express-session")},function(e,t){e.exports=require("cookie-parser")},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("express-cache-control")},function(e,t){e.exports=require("regenerator-runtime")},function(e,t,r){r(56),r(33),r(42),r(112),r(118),r(119),e.exports=r(2).Promise},function(e,t,r){var n=r(34),a=r(35);e.exports=function(e){return function(t,r){var u,s,o=String(a(t)),c=n(r),i=o.length;return c<0||c>=i?e?"":void 0:(u=o.charCodeAt(c))<55296||u>56319||c+1===i||(s=o.charCodeAt(c+1))<56320||s>57343?e?o.charAt(c):u:e?o.slice(c,c+2):s-56320+(u-55296<<10)+65536}}},function(e,t,r){e.exports=!r(15)&&!r(18)(function(){return 7!=Object.defineProperty(r(37)("div"),"a",{get:function(){return 7}}).a})},function(e,t,r){var n=r(11);e.exports=function(e,t){if(!n(e))return e;var r,a;if(t&&"function"==typeof(r=e.toString)&&!n(a=r.call(e)))return a;if("function"==typeof(r=e.valueOf)&&!n(a=r.call(e)))return a;if(!t&&"function"==typeof(r=e.toString)&&!n(a=r.call(e)))return a;throw TypeError("Can't convert object to primitive value")}},function(e,t,r){e.exports=r(17)},function(e,t,r){"use strict";var n=r(59),a=r(58),u=r(30),s={};r(17)(s,r(7)("iterator"),function(){return this}),e.exports=function(e,t,r){e.prototype=n(s,{next:a(1,r)}),u(e,t+" Iterator")}},function(e,t,r){var n=r(13),a=r(14),u=r(28);e.exports=r(15)?Object.defineProperties:function(e,t){a(e);for(var r,s=u(t),o=s.length,c=0;o>c;)n.f(e,r=s[c++],t[r]);return e}},function(e,t,r){var n=r(21),a=r(29),u=r(107)(!1),s=r(40)("IE_PROTO");e.exports=function(e,t){var r,o=a(e),c=0,i=[];for(r in o)r!=s&&n(o,r)&&i.push(r);for(;t.length>c;)n(o,r=t[c++])&&(~u(i,r)||i.push(r));return i}},function(e,t,r){var n=r(29),a=r(39),u=r(108);e.exports=function(e){return function(t,r,s){var o,c=n(t),i=a(c.length),p=u(s,i);if(e&&r!=r){for(;i>p;)if((o=c[p++])!=o)return!0}else for(;i>p;p++)if((e||p in c)&&c[p]===r)return e||p||0;return!e&&-1}}},function(e,t,r){var n=r(34),a=Math.max,u=Math.min;e.exports=function(e,t){return(e=n(e))<0?a(e+t,0):u(e,t)}},function(e,t,r){var n=r(21),a=r(31),u=r(40)("IE_PROTO"),s=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=a(e),n(e,u)?e[u]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?s:null}},function(e,t,r){"use strict";var n=r(111),a=r(63),u=r(22),s=r(29);e.exports=r(36)(Array,"Array",function(e,t){this._t=s(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,r=this._i++;return!e||r>=e.length?(this._t=void 0,a(1)):a(0,"keys"==t?r:"values"==t?e[r]:[r,e[r]])},"values"),u.Arguments=u.Array,n("keys"),n("values"),n("entries")},function(e,t){e.exports=function(){}},function(e,t,r){"use strict";var n,a,u,s,o=r(57),c=r(6),i=r(16),p=r(43),l=r(5),f=r(11),d=r(20),y=r(44),h=r(24),m=r(65),v=r(66).set,x=r(116)(),w=r(45),b=r(67),E=r(68),S="Promise",k=c.TypeError,g=c.process,T=c[S],F="process"==p(g),C=function(){},q=a=w.f,I=!!function(){try{var e=T.resolve(1),t=(e.constructor={})[r(7)("species")]=function(e){e(C,C)};return(F||"function"==typeof PromiseRejectionEvent)&&e.then(C)instanceof t}catch(e){}}(),A=function(e){var t;return!(!f(e)||"function"!=typeof(t=e.then))&&t},L=function(e,t){if(!e._n){e._n=!0;var r=e._c;x(function(){for(var n=e._v,a=1==e._s,u=0,s=function(t){var r,u,s=a?t.ok:t.fail,o=t.resolve,c=t.reject,i=t.domain;try{s?(a||(2==e._h&&Q(e),e._h=1),!0===s?r=n:(i&&i.enter(),r=s(n),i&&i.exit()),r===t.promise?c(k("Promise-chain cycle")):(u=A(r))?u.call(r,o,c):o(r)):c(n)}catch(e){c(e)}};r.length>u;)s(r[u++]);e._c=[],e._n=!1,t&&!e._h&&R(e)})}},R=function(e){v.call(c,function(){var t,r,n,a=e._v,u=_(e);if(u&&(t=b(function(){F?g.emit("unhandledRejection",a,e):(r=c.onunhandledrejection)?r({promise:e,reason:a}):(n=c.console)&&n.error&&n.error("Unhandled promise rejection",a)}),e._h=F||_(e)?2:1),e._a=void 0,u&&t.e)throw t.v})},_=function(e){if(1==e._h)return!1;for(var t,r=e._a||e._c,n=0;r.length>n;)if((t=r[n++]).fail||!_(t.promise))return!1;return!0},Q=function(e){v.call(c,function(){var t;F?g.emit("rejectionHandled",e):(t=c.onrejectionhandled)&&t({promise:e,reason:e._v})})},N=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),L(t,!0))},D=function(e){var t,r=this;if(!r._d){r._d=!0,r=r._w||r;try{if(r===e)throw k("Promise can't be resolved itself");(t=A(e))?x(function(){var n={_w:r,_d:!1};try{t.call(e,i(D,n,1),i(N,n,1))}catch(e){N.call(n,e)}}):(r._v=e,r._s=1,L(r,!1))}catch(e){N.call({_w:r,_d:!1},e)}}};I||(T=function(e){y(this,T,S,"_h"),d(e),n.call(this);try{e(i(D,this,1),i(N,this,1))}catch(e){N.call(this,e)}},(n=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=r(46)(T.prototype,{then:function(e,t){var r=q(m(this,T));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=F?g.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&L(this,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),u=function(){var e=new n;this.promise=e,this.resolve=i(D,e,1),this.reject=i(N,e,1)},w.f=q=function(e){return e===T||e===s?new u(e):a(e)}),l(l.G+l.W+l.F*!I,{Promise:T}),r(30)(T,S),r(69)(S),s=r(2)[S],l(l.S+l.F*!I,S,{reject:function(e){var t=q(this);return(0,t.reject)(e),t.promise}}),l(l.S+l.F*(o||!I),S,{resolve:function(e){return E(o&&this===s?T:this,e)}}),l(l.S+l.F*!(I&&r(117)(function(e){T.all(e).catch(C)})),S,{all:function(e){var t=this,r=q(t),n=r.resolve,a=r.reject,u=b(function(){var r=[],u=0,s=1;h(e,!1,function(e){var o=u++,c=!1;r.push(void 0),s++,t.resolve(e).then(function(e){c||(c=!0,r[o]=e,--s||n(r))},a)}),--s||n(r)});return u.e&&a(u.v),r.promise},race:function(e){var t=this,r=q(t),n=r.reject,a=b(function(){h(e,!1,function(e){t.resolve(e).then(r.resolve,n)})});return a.e&&n(a.v),r.promise}})},function(e,t,r){var n=r(14);e.exports=function(e,t,r,a){try{return a?t(n(r)[0],r[1]):t(r)}catch(t){var u=e.return;throw void 0!==u&&n(u.call(e)),t}}},function(e,t,r){var n=r(22),a=r(7)("iterator"),u=Array.prototype;e.exports=function(e){return void 0!==e&&(n.Array===e||u[a]===e)}},function(e,t){e.exports=function(e,t,r){var n=void 0===r;switch(t.length){case 0:return n?e():e.call(r);case 1:return n?e(t[0]):e.call(r,t[0]);case 2:return n?e(t[0],t[1]):e.call(r,t[0],t[1]);case 3:return n?e(t[0],t[1],t[2]):e.call(r,t[0],t[1],t[2]);case 4:return n?e(t[0],t[1],t[2],t[3]):e.call(r,t[0],t[1],t[2],t[3])}return e.apply(r,t)}},function(e,t,r){var n=r(6),a=r(66).set,u=n.MutationObserver||n.WebKitMutationObserver,s=n.process,o=n.Promise,c="process"==r(23)(s);e.exports=function(){var e,t,r,i=function(){var n,a;for(c&&(n=s.domain)&&n.exit();e;){a=e.fn,e=e.next;try{a()}catch(n){throw e?r():t=void 0,n}}t=void 0,n&&n.enter()};if(c)r=function(){s.nextTick(i)};else if(u){var p=!0,l=document.createTextNode("");new u(i).observe(l,{characterData:!0}),r=function(){l.data=p=!p}}else if(o&&o.resolve){var f=o.resolve();r=function(){f.then(i)}}else r=function(){a.call(n,i)};return function(n){var a={fn:n,next:void 0};t&&(t.next=a),e||(e=a,r()),t=a}}},function(e,t,r){var n=r(7)("iterator"),a=!1;try{var u=[7][n]();u.return=function(){a=!0},Array.from(u,function(){throw 2})}catch(e){}e.exports=function(e,t){if(!t&&!a)return!1;var r=!1;try{var u=[7],s=u[n]();s.next=function(){return{done:r=!0}},u[n]=function(){return s},e(u)}catch(e){}return r}},function(e,t,r){"use strict";var n=r(5),a=r(2),u=r(6),s=r(65),o=r(68);n(n.P+n.R,"Promise",{finally:function(e){var t=s(this,a.Promise||u.Promise),r="function"==typeof e;return this.then(r?function(r){return o(t,e()).then(function(){return r})}:e,r?function(r){return o(t,e()).then(function(){throw r})}:e)}})},function(e,t,r){"use strict";var n=r(5),a=r(45),u=r(67);n(n.S,"Promise",{try:function(e){var t=a.f(this),r=u(e);return(r.e?t.reject:t.resolve)(r.v),t.promise}})},function(e,t){e.exports=require("underscore")},function(e,t,r){r(122),e.exports=r(2).Object.keys},function(e,t,r){var n=r(31),a=r(28);r(123)("keys",function(){return function(e){return a(n(e))}})},function(e,t,r){var n=r(5),a=r(2),u=r(18);e.exports=function(e,t){var r=(a.Object||{})[e]||Object[e],s={};s[e]=t(r),n(n.S+n.F*u(function(){r(1)}),"Object",s)}},function(e,t){e.exports=require("bcrypt-nodejs")},function(e,t){e.exports=require("crispy-string")},function(e,t,r){"use strict";var n=r(9),a=r(0);e.exports=function(e){var t=n.join("./","build");e.get("*.js.gz",function(e,t,r){t.set("Content-Encoding","gzip"),t.set("Content-Type","text/javascript"),r()}),e.get("*.css.gz",function(e,t,r){t.set("Content-Encoding","gzip"),t.set("Content-Type","text/css"),r()}),e.use(a.static(t)),e.get("/",function(e,t){t.sendFile(n.join("./","build","index.html"))})}},function(e,t){e.exports=require("webpack-dev-middleware")},function(e,t){e.exports=require("webpack-hot-middleware")},function(e,t,r){"use strict";r(10);var n=r(25),a=r(130),u=r(136),s=r(143),o=r(154),c=Object({NODE_ENV:"production"}).npm_lifecycle_event;if(Object({NODE_ENV:"production"}).BABEL_ENV=c,"start"!==c&&c||(e.exports=n(a,u)),"build:client"!==c&&"stats"!==c||(e.exports=n(a,s)),"test"===c||"tdd"===c){var i=n(a,o);i.entry=null,e.exports=i}},function(e,t,r){"use strict";r(10);var n=r(25),a=r(32),u=r(131),s=r(75),o=(r(133),r(134),n({resolve:{extensions:[".js",".jsx"]},output:{path:a.build,filename:"[name].[hash].js",chunkFilename:"[hash].js"}},u({title:"天保市政水费收费管理系统",appMountId:"root"}),s(a.app)));e.exports=o},function(e,t,r){"use strict";var n=r(132);e.exports=function(e){return{plugins:[new n({template:"./node_modules/html-webpack-template/index.ejs",title:e.title,appMountId:e.appMountId,inject:!1})]}}},function(e,t){e.exports=require("html-webpack-plugin")},function(e,t,r){"use strict";e.exports=function(e){return{module:{rules:[{test:/\.(js|jsx)$/,loaders:["eslint-loader"],enforce:"pre",include:e}]}}}},function(e,t,r){"use strict";e.exports=function(e){return{module:{rules:[{test:/\.css$/,loader:"postcss-loader",enforce:"pre",include:e,options:{plugins:function(){return[r(135)({ignoreFiles:"node_modules/!**!/!*.css"})]}}}]}}}},function(e,t){e.exports=require("stylelint")},function(e,t,r){"use strict";var n=function(e){return e&&e.__esModule?e:{default:e}}(r(76)),a=r(10),u=r(25),s=r(32),o=r(77),c=r(78),i=r(138),p=r(140),l=r(141),f=r(79),d=u({devtool:"eval-source-map",entry:["webpack-hot-middleware/client?reload=true",s.app+"/index.jsx"],plugins:[new a.optimize.OccurrenceOrderPlugin,new a.HotModuleReplacementPlugin,new a.NoErrorsPlugin,new a.DefinePlugin({"process.env.NODE_ENV":(0,n.default)("development")})]},o(s.app),c(s.app),p(),l(),i({save:!0}),f(s.app+"/assets",s.build+"/assets"));e.exports=d},function(e,t,r){var n=r(2),a=n.JSON||(n.JSON={stringify:JSON.stringify});e.exports=function(e){return a.stringify.apply(a,arguments)}},function(e,t,r){"use strict";var n=r(139);e.exports=function(e){return e=e||{},{plugins:[new n(e)]}}},function(e,t){e.exports=require("npm-install-webpack-plugin")},function(e,t,r){"use strict";e.exports=function(){return{module:{rules:[{test:/\.(woff|woff2|eot|ttf|otf)$/,use:["url-loader"]}]}}}},function(e,t,r){"use strict";e.exports=function(){return{module:{rules:[{test:/\.(png|svg|jpg|gif)$/,use:["url-loader"]}]}}}},function(e,t){e.exports=require("copy-webpack-plugin")},function(e,t,r){"use strict";r(10);var n=r(25),a=(r(80),r(81),r(82),r(32)),u=r(144),s=r(145),o=r(146),c=r(147),i=r(148),p=r(79),l=r(149),f=r(152),d=n({entry:{app:a.app+"/index.jsx",style:a.style}},o(a.build),c("process.env.NODE_ENV","production"),s(),i(),u(a.app),p(a.app+"/assets",a.build+"/assets"),l({options:{discardComments:{removeAll:!0},safe:!0}}),f());e.exports=d},function(e,t,r){"use strict";var n=r(80);e.exports=function(e){return{module:{rules:[{test:/\.css$/,use:n.extract({fallback:"style-loader",use:["css-loader"]})},{test:/\.less$/,use:n.extract({fallback:"style-loader",use:["css-loader","less-loader"]}),include:e},{test:/\.(png|jpg)$/,loader:"url-loader?name=assets/images/[name].[ext]&limit=8192"}]},plugins:[new n("[name].[hash].css")]}}},function(e,t,r){"use strict";var n=function(e){return e&&e.__esModule?e:{default:e}}(r(47)),a=r(10),u=r(82);e.exports=function(e){return{entry:{vendor:(0,n.default)(u.dependencies).filter(function(e){return"alt-utils"!==e})},plugins:[new a.optimize.CommonsChunkPlugin({names:["vendor","manifest"]})]}}},function(e,t,r){"use strict";var n=r(81);e.exports=function(e){return{plugins:[new n([e],{root:process.cwd()})]}}},function(e,t,r){"use strict";var n=function(e){return e&&e.__esModule?e:{default:e}}(r(76)),a=r(10);e.exports=function(e,t){var r={};return r[e]=(0,n.default)(t),{plugins:[new a.DefinePlugin(r)]}}},function(e,t,r){"use strict";var n=r(10);e.exports=function(){return{plugins:[new n.optimize.UglifyJsPlugin({compress:{warnings:!1},minimize:!0,mangle:!0,comments:!1}),new n.optimize.AggressiveMergingPlugin,new n.optimize.OccurrenceOrderPlugin,new n.optimize.DedupePlugin]}}},function(e,t,r){"use strict";var n=r(150),a=r(151);e.exports=function(e){var t=e.options;return{plugins:[new n({cssProcessor:a,cssProcessorOptions:t,canPrint:!1})]}}},function(e,t){e.exports=require("optimize-css-assets-webpack-plugin")},function(e,t){e.exports=require("cssnano")},function(e,t,r){"use strict";r(10);var n=r(153);e.exports=function(){return{plugins:[new n({asset:"[path].gz[query]",algorithm:"gzip",test:/\.js$|\.css$|\.html$/,threshold:10240,minRatio:1})]}}},function(e,t){e.exports=require("compression-webpack-plugin")},function(e,t,r){"use strict";r(10);var n=r(25),a=r(32),u=r(155),s=r(77),o=(r(75),r(78)),c=n({entry:{app:a.app+"/index.jsx",style:a.style},devtool:"inline-source-map"},u(a.app),s(a.app),o(a.app));e.exports=c},function(e,t,r){"use strict";e.exports=function(e){return{module:{rules:[{test:/\.(js|jsx)$/,loaders:["isparta-instrumenter-loader"],enforce:"pre",include:e}]}}}},function(e,t,r){"use strict";var n=r(0).Router(),a=r(54);n.post("/",a.authenticate),n.delete("/",a.logout),e.exports=n},function(e,t,r){"use strict";var n=r(0).Router(),a=r(158),u=r(159),s=r(160),o=r(167),c=r(203),i=r(204),p=r(206),l=r(208),f=r(210),d=r(221),y=r(223),h=r(225),m=r(227),v=r(228);n.use("/users",a),n.use("/menu",u),n.use("/workitems",s),n.use("/water",o),n.use("/unit",c),n.use("/stat",i),n.use("/report",p),n.use("/detail",l),n.use("/collection",f),n.use("/upload",d),n.use("/dict",y),n.use("/contract",h),n.use("/files",m),n.use("/reminder",v),e.exports=n},function(e,t,r){"use strict";r(1);var n=r(0),a=r(70).queryUser,u=n.Router();u.get("/my/:username",a),e.exports=u},function(e,t,r){"use strict";var n=r(1),a=r(0).Router();a.get("/:menu",function(e,t,a){var u="undefine"!==e.params.menu?e.params.menu:"operator",s=r(71)("./"+u);n.ResourceFound(t,s)}),e.exports=a},function(e,t,r){"use strict";r(1);var n=r(0),a=r(161),u=n.Router();u.get("/",function(e,t,r){a.pagingQuery(e,t)}),e.exports=u},function(e,t,r){"use strict";var n=function(e){return e&&e.__esModule?e:{default:e}}(r(162)),a=r(19),u=r(166),s=r(1),o=u.define("workitem",{ID:{type:a.INTEGER},CaseCatalog:{type:a.STRING},ParentCatalogName:{type:a.STRING},SubName:{type:a.STRING},ViewResult:{type:a.STRING},DealWithDesc:{type:a.STRING},FacilityDesc:{type:a.STRING},MonitoringUnit:{type:a.STRING},FinishedStandard:{type:a.STRING},RegistStandard:{type:a.STRING}},{timestamps:!1,tableName:"V_W_WorkingItems_Prices"});o.pagingQuery=function(e,t){var r=Number(e.query.page)||1,c=Number(e.query.results)||10,i=e.query.sortField||"ID",p=function(e){return e?e.replace("end",""):"asc"}(e.query.sortOrder),l=e.query.SubName||"%",f=e.query.ParentCatalogName||"%";c>100&&(c=100);var d="declare @rowsPerPage as bigint; declare @pageNum as bigint;set @rowsPerPage="+c+"; set @pageNum="+r+";   With SQLPaging As   ( Select Top(@rowsPerPage * @pageNum) ROW_NUMBER() OVER ( ORDER BY "+i+" "+p+") as resultNum, * FROM V_W_WorkingItems_Prices where SubName like :subName and ParentCatalogName like :parentName)select * from SQLPaging with (nolock) where resultNum > ((@pageNum - 1) * @rowsPerPage); ",y={};o.count({where:{SubName:(0,n.default)({},a.Op.like,"%"+l+"%"),ParentCatalogName:(0,n.default)({},a.Op.like,"%"+f+"%")}}).then(function(e){return y.count=e,u.query(d,{replacements:{subName:"%"+l+"%",parentName:"%"+f+"%"},model:o})}).then(function(e){e?(y.data=e,s.ResourceFound(t,y)):s.ResourceNotFound(t,{ID:all})}).catch(function(e){console.log("error",e),s.InternalServerError(t,e,{ID:all})})},e.exports=o},function(e,t,r){"use strict";t.__esModule=!0;var n=function(e){return e&&e.__esModule?e:{default:e}}(r(163));t.default=function(e,t,r){return t in e?(0,n.default)(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}},function(e,t,r){e.exports={default:r(164),__esModule:!0}},function(e,t,r){r(165);var n=r(2).Object;e.exports=function(e,t,r){return n.defineProperty(e,t,r)}},function(e,t,r){var n=r(5);n(n.S+n.F*!r(15),"Object",{defineProperty:r(13).f})},function(e,t,r){"use strict";var n=new(r(19))("SUP_APP_RoadInspectCaseDatabase2011_20110428-G","sa","ghjsj",{host:"61.136.61.40",dialect:"mssql",dialectOptions:{options:{tdsVersion:"7_3_A"}},pool:{max:5,min:0,acquire:3e4,idle:1e4}});e.exports=n},function(e,t,r){"use strict";var n=r(0),a=r(83),u=a.queryWaterFee,s=a.queryWaterFees,o=a.calculateWaterFee,c=a.saveWaterFee,i=a.MoveWaterFeePosition,p=a.statisticsWaterFees,l=a.waterFeeToExcel,f=a.deleteWaterFee,d=a.queryWaterFeesNum,y=a.prepareWaterFees,h=a.eraseZeroWaterFees,m=a.queryFeeParas,v=a.searchWaterFees,x=a.searchToExcel,w=a.CompletePayment,b=a.queryWaterFeesYearlyByNum,E=a.sendOverUsageSMS,S=a.SearchFeesByCompany,k=a.searchByCompanyToExcel,g=n.Router();g.get("/fee/:num/:year/:month",function(e,t,r){var n=e.params,a=n.num,s=n.year,o=n.month;u(a,s,o,t)}),g.delete("/fee/:num/:year/:month",f),g.delete("/feezero/:year/:month",h),g.get("/fees/:year/:month/:type",function(e,t,r){var n=e.params,a=n.year,u=n.month,o=n.type;s(a,u,o,t)}),g.get("/feesstat/:year/:month/:type",p),g.get("/feesnum/:year/:month",d),g.get("/feesyear/:num/:year",b),g.get("/feeparas",m),g.get("/feestoexcel/:year/:month/:type",l),g.get("/feeprior/:num/:year/:month/:type",function(e,t){i(e,t,"prior")}),g.get("/feenext/:num/:year/:month/:type",function(e,t){i(e,t,"next")}),g.post("/calfee",o),g.post("/feesearch",v),g.post("/feesbycompany",S),g.post("/feesbycompanytoexcel",k),g.post("/feesearchtoexcel",x),g.post("/feesprepare",y),g.put("/fee",c),g.post("/payment",w),g.post("/fees/sms",E),e.exports=g},function(e,t,r){r(42),r(33),e.exports=r(169)},function(e,t,r){var n=r(14),a=r(64);e.exports=r(2).getIterator=function(e){var t=a(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return n(t.call(e))}},function(e,t,r){r(56),r(33),r(42),r(171),r(178),r(181),r(183),e.exports=r(2).Map},function(e,t,r){"use strict";var n=r(172),a=r(85);e.exports=r(173)("Map",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{get:function(e){var t=n.getEntry(a(this,"Map"),e);return t&&t.v},set:function(e,t){return n.def(a(this,"Map"),0===e?0:e,t)}},n,!0)},function(e,t,r){"use strict";var n=r(13).f,a=r(59),u=r(46),s=r(16),o=r(44),c=r(24),i=r(36),p=r(63),l=r(69),f=r(15),d=r(84).fastKey,y=r(85),h=f?"_s":"size",m=function(e,t){var r,n=d(t);if("F"!==n)return e._i[n];for(r=e._f;r;r=r.n)if(r.k==t)return r};e.exports={getConstructor:function(e,t,r,i){var p=e(function(e,n){o(e,p,t,"_i"),e._t=t,e._i=a(null),e._f=void 0,e._l=void 0,e[h]=0,void 0!=n&&c(n,r,e[i],e)});return u(p.prototype,{clear:function(){for(var e=y(this,t),r=e._i,n=e._f;n;n=n.n)n.r=!0,n.p&&(n.p=n.p.n=void 0),delete r[n.i];e._f=e._l=void 0,e[h]=0},delete:function(e){var r=y(this,t),n=m(r,e);if(n){var a=n.n,u=n.p;delete r._i[n.i],n.r=!0,u&&(u.n=a),a&&(a.p=u),r._f==n&&(r._f=a),r._l==n&&(r._l=u),r[h]--}return!!n},forEach:function(e){y(this,t);for(var r,n=s(e,arguments.length>1?arguments[1]:void 0,3);r=r?r.n:this._f;)for(n(r.v,r.k,this);r&&r.r;)r=r.p},has:function(e){return!!m(y(this,t),e)}}),f&&n(p.prototype,"size",{get:function(){return y(this,t)[h]}}),p},def:function(e,t,r){var n,a,u=m(e,t);return u?u.v=r:(e._l=u={i:a=d(t,!0),k:t,v:r,p:n=e._l,n:void 0,r:!1},e._f||(e._f=u),n&&(n.n=u),e[h]++,"F"!==a&&(e._i[a]=u)),e},getEntry:m,setStrong:function(e,t,r){i(e,t,function(e,r){this._t=y(e,t),this._k=r,this._l=void 0},function(){for(var e=this._k,t=this._l;t&&t.r;)t=t.p;return this._t&&(this._l=t=t?t.n:this._t._f)?p(0,"keys"==e?t.k:"values"==e?t.v:[t.k,t.v]):(this._t=void 0,p(1))},r?"entries":"values",!r,!0),l(t)}}},function(e,t,r){"use strict";var n=r(6),a=r(5),u=r(84),s=r(18),o=r(17),c=r(46),i=r(24),p=r(44),l=r(11),f=r(30),d=r(13).f,y=r(174)(0),h=r(15);e.exports=function(e,t,r,m,v,x){var w=n[e],b=w,E=v?"set":"add",S=b&&b.prototype,k={};return h&&"function"==typeof b&&(x||S.forEach&&!s(function(){(new b).entries().next()}))?(b=t(function(t,r){p(t,b,e,"_c"),t._c=new w,void 0!=r&&i(r,v,t[E],t)}),y("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),function(e){var t="add"==e||"set"==e;e in S&&(!x||"clear"!=e)&&o(b.prototype,e,function(r,n){if(p(this,b,e),!t&&x&&!l(r))return"get"==e&&void 0;var a=this._c[e](0===r?0:r,n);return t?this:a})}),x||d(b.prototype,"size",{get:function(){return this._c.size}})):(b=m.getConstructor(t,e,v,E),c(b.prototype,r),u.NEED=!0),f(b,e),k[e]=b,a(a.G+a.W+a.F,k),x||m.setStrong(b,e,v),b}},function(e,t,r){var n=r(16),a=r(38),u=r(31),s=r(39),o=r(175);e.exports=function(e,t){var r=1==e,c=2==e,i=3==e,p=4==e,l=6==e,f=5==e||l,d=t||o;return function(t,o,y){for(var h,m,v=u(t),x=a(v),w=n(o,y,3),b=s(x.length),E=0,S=r?d(t,b):c?d(t,0):void 0;b>E;E++)if((f||E in x)&&(h=x[E],m=w(h,E,v),e))if(r)S[E]=m;else if(m)switch(e){case 3:return!0;case 5:return h;case 6:return E;case 2:S.push(h)}else if(p)return!1;return l?-1:i||p?p:S}}},function(e,t,r){var n=r(176);e.exports=function(e,t){return new(n(e))(t)}},function(e,t,r){var n=r(11),a=r(177),u=r(7)("species");e.exports=function(e){var t;return a(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!a(t.prototype)||(t=void 0),n(t)&&null===(t=t[u])&&(t=void 0)),void 0===t?Array:t}},function(e,t,r){var n=r(23);e.exports=Array.isArray||function(e){return"Array"==n(e)}},function(e,t,r){var n=r(5);n(n.P+n.R,"Map",{toJSON:r(179)("Map")})},function(e,t,r){var n=r(43),a=r(180);e.exports=function(e){return function(){if(n(this)!=e)throw TypeError(e+"#toJSON isn't generic");return a(this)}}},function(e,t,r){var n=r(24);e.exports=function(e,t){var r=[];return n(e,!1,r.push,r,t),r}},function(e,t,r){r(182)("Map")},function(e,t,r){"use strict";var n=r(5);e.exports=function(e){n(n.S,e,{of:function(){for(var e=arguments.length,t=Array(e);e--;)t[e]=arguments[e];return new this(t)}})}},function(e,t,r){r(184)("Map")},function(e,t,r){"use strict";var n=r(5),a=r(20),u=r(16),s=r(24);e.exports=function(e){n(n.S,e,{from:function(e){var t,r,n,o,c=arguments[1];return a(this),(t=void 0!==c)&&a(c),void 0==e?new this:(r=[],t?(n=0,o=u(c,arguments[2],2),s(e,!1,function(e){r.push(o(e,n++))})):s(e,!1,r.push,r),new this(r))}})}},function(e,t,r){r(186),e.exports=r(2).Object.assign},function(e,t,r){var n=r(5);n(n.S+n.F,"Object",{assign:r(187)})},function(e,t,r){"use strict";var n=r(28),a=r(188),u=r(87),s=r(31),o=r(38),c=Object.assign;e.exports=!c||r(18)(function(){var e={},t={},r=Symbol(),n="abcdefghijklmnopqrst";return e[r]=7,n.split("").forEach(function(e){t[e]=e}),7!=c({},e)[r]||Object.keys(c({},t)).join("")!=n})?function(e,t){for(var r=s(e),c=arguments.length,i=1,p=a.f,l=u.f;c>i;)for(var f,d=o(arguments[i++]),y=p?n(d).concat(p(d)):n(d),h=y.length,m=0;h>m;)l.call(d,f=y[m++])&&(r[f]=d[f]);return r}:c},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,r){var n=r(190),a=r(89);e.exports=function(e,t){return{encodeS:function(t,r){return r=a.extend({ww:!0,tenMin:!0},r),n.CL.call(e,t,r)},encodeB:function(e,r){return r=a.extend({ww:!0},r),n.CL.call(t,e,r)},decodeS:function(){return n.unCL.apply(e,arguments)},decodeB:function(){return n.unCL.apply(t,arguments)},toMoney:function(e,r){return r=a.extend({ww:!0},r),n.toMoney.call(t,e,r)}}}},function(e,t,r){function n(e,t){var r=a.getNumbResult(e);if(!r)return e;t=t||{};var n=this.ch,u=this.ch_u,s=this.ch_f||"",o=this.ch_d||"",c=n.charAt(0),i=r.int,p=r.decimal,l="",f="",d=r.minus?s:"";if(p){p=a.clearZero(p,"0","$");for(var y=0;y<p.length;y++)f+=n.charAt(+p.charAt(y));f=f?o+f:""}if(l=function e(r,s,o){r=a.getNumbResult(r).int;var i="",p=arguments.length>1?arguments[1]:t.tenMin,l=r.length;if(1==l)return n.charAt(+r);if(l<=4)for(var f=0,d=l;d--;){var y=+r.charAt(f);i+=p&&2==l&&0==f&&1==y?"":n.charAt(y),i+=y&&d?u.charAt(d):"",f++}else{for(var h=r.length/4>>0,m=r.length%4;0==m||!u.charAt(3+h);)m+=4,h--;i=e(r.substr(0,m),p)+u.charAt(3+h)+(~r.substr(m-1,2).indexOf("0")?c:"")+e(r.substr(m),p)}return i=a.clearZero(i,c)}(i),t.ww&&u.length>5){var h=u.charAt(4),m=u.charAt(5),v=l.lastIndexOf(m);~v&&(l=l.substring(0,v).replace(new RegExp(m,"g"),h+h)+l.substring(v))}return d+l+f}var a=r(89);e.exports={CL:n,unCL:function(e){for(var t=(e=e.toString()).split(this.ch_d),r=t[0].replace(this.ch_f,""),n=t[1],u=!!~t[0].indexOf(this.ch_f),s=this.ch_u.charAt(1),o=this.ch_u.charAt(4),c=this.ch_u.charAt(5),i=(r=r.replace(new RegExp(o+"{2}","g"),c)).split(""),p=0,l=0,f=[],d=[],y=[],h=0;h<i.length;h++){var m=i[h],v=0,x=0;if(~(v=this.ch.indexOf(m)))v>0&&y.unshift(v);else if(~(x=this.ch_u.indexOf(m))){var w=a.getDigit(x);p>x?(a.unshiftZero(y,w),a.centerArray(d,y)):x>=l?(0==h&&(y=[1]),a.centerArray(f,d,y),f.length>0&&a.unshiftZero(f,w),l=x):(0==y.length&&s==m&&(y=[1]),a.centerArray(d,y),a.unshiftZero(d,a.getDigit(x)),p=x)}}a.centerArray(f,d,y).reverse(),0==f.length&&f.push(0);var b=0;if(n){for(f.push("."),b="0.",h=0;h<n.length;h++)b+=this.ch.indexOf(n.charAt(h)),f.push(this.ch.indexOf(n.charAt(h)));b=+b}return u&&f.unshift("-"),parseFloat(f.join(""))},toMoney:function(e,t){var r=a.getNumbResult(e),u=this.ch.charAt(0);if(t="object"==typeof t?t:{},!r)return e;t=a.extend({ww:!0,complete:!1,outSymbol:!0},t);var s=r.num,o=r.decimal||"",c=t.outSymbol?this.m_t:"",i=o?"":this.m_z,p="";if(t.complete){for(var l=1;l<this.m_u.length;l++)p+=n.call(this,o.charAt(l-1)||"0")+this.m_u.charAt(l);i=n.call(this,s,t)+this.m_u.charAt(0)}else{if(o=a.clearZero(o,"0","$")){var f;for(l=0;l<this.m_u.length-1;l++)o.charAt(l)&&"0"!=o.charAt(l)&&(p+=n.call(this,o.charAt(l))+this.m_u.charAt(l+1),f=!1),"0"!==o.charAt(l)||f||(0==l&&"0"==s||(p+=u),f=!0)}"0"==s&&!i&&p||(i=n.call(this,s,t)+this.m_u.charAt(0)+i)}return c+i+p}}},function(e,t){e.exports={ch:"零一二三四五六七八九",ch_u:"个十百千万亿",ch_f:"负",ch_d:"点"}},function(e,t){e.exports={ch:"零壹贰叁肆伍陆柒捌玖",ch_u:"个拾佰仟万亿",ch_f:"负",ch_d:"点",m_t:"人民币",m_z:"整",m_u:"元角分"}},function(e,t){e.exports=require("axios")},function(e,t){e.exports=require("querystring")},function(e,t){e.exports=require("jszip")},function(e,t){e.exports=require("docxtemplater")},function(e,t,r){var n=r(198),a=r(200);e.exports=function(e,t,r){var u=t&&r||0;"string"==typeof e&&(t="binary"==e?new Array(16):null,e=null);var s=(e=e||{}).random||(e.rng||n)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t)for(var o=0;o<16;++o)t[u+o]=s[o];return t||a(s)}},function(e,t,r){var n=r(199).randomBytes;e.exports=function(){return n(16)}},function(e,t){e.exports=require("crypto")},function(e,t){for(var r=[],n=0;n<256;++n)r[n]=(n+256).toString(16).substr(1);e.exports=function(e,t){var n=t||0,a=r;return a[e[n++]]+a[e[n++]]+a[e[n++]]+a[e[n++]]+"-"+a[e[n++]]+a[e[n++]]+"-"+a[e[n++]]+a[e[n++]]+"-"+a[e[n++]]+a[e[n++]]+"-"+a[e[n++]]+a[e[n++]]+a[e[n++]]+a[e[n++]]+a[e[n++]]+a[e[n++]]}},function(e,t,r){"use strict";e.exports.getPropertyFromArray=function(e,t){return e.map(function(e){return e[t]})}},function(e,t,r){"use strict";e.exports.plus=function(e,t){return parseFloat((e+t).toFixed(10))}},function(e,t,r){"use strict";var n=r(0),a=r(52),u=a.queryUnitsByPinYin,s=a.queryUnitByNum,o=a.queryUnitByDownNum,c=a.queryUnitParas,i=(a.queryBankByName,a.saveUnit),p=a.createUnitNum,l=a.MoveUnitPosition,f=a.searchUnits,d=a.unitsToExcel,y=a.queryAllowanceByNum,h=a.saveAllowance,m=a.MoveAllowancePosition,v=a.saveCollection,x=a.MoveCollectionPosition,w=a.queryUnitChangeName,b=a.createChangeNameNum,E=a.saveUnitChange,S=a.searchUnitChange,k=a.changeToExcel,g=a.checkError,T=a.checkErrorToExcel,F=a.changeIdCheck,C=a.saveUnitChangeId,q=a.unitsToWord,I=n.Router();I.get("/unitsabbr/:pinyin",u),I.get("/units/:num",s),I.get("/units/down/:num",o),I.get("/allowance/:num",y),I.get("/unitparas",c),I.get("/unitnum/:usekind",p),I.put("/unit",i),I.put("/collection",v),I.get("/prior/:num",function(e,t){l(e,t,"prior")}),I.get("/next/:num",function(e,t){l(e,t,"next")}),I.post("/unitsearch",f),I.post("/unitstoexcel",d),I.post("/unitstoword",q),I.put("/allowance",h),I.get("/allowance/prior/:num",function(e,t){m(e,t,"prior")}),I.get("/allowance/next/:num",function(e,t){m(e,t,"next")}),I.get("/collection/prior/:num/:cb",function(e,t){x(e,t,"prior")}),I.get("/collection/next/:num/:cb",function(e,t){x(e,t,"next")}),I.get("/change/:num/:year/:month",w),I.get("/changecreate/:num/:usekind",b),I.put("/change",E),I.get("/change/:start/:end",S),I.get("/changetoexcel/:start/:end",k),I.post("/errorcheck",g),I.get("/error/excel/:date",T),I.get("/changeid/check/:num",F),I.post("/changeid",C),e.exports=I},function(e,t,r){"use strict";var n=r(0).Router(),a=r(205),u=a.queryStatTollStatus,s=a.handleStatToll,o=a.JingYingToExcel,c=a.StandardToExcel,i=a.DetailToExcel,p=a.JianBaoToExcel,l=a.QingDanToExcel,f=a.GongYeToExcel,d=a.ShuiSunToExcel,y=a.ShiZhengToExcel,h=a.handleLackUnit,m=a.deleteLackUnit,v=a.LackUnitToExcel;n.get("/toll/:date",u),n.post("/toll",s),n.post("/excel/jingying",o),n.post("/excel/standard",c),n.post("/excel/detail",i),n.post("/excel/jianbao",p),n.post("/excel/qingdan",l),n.post("/excel/gongye",f),n.post("/excel/shuisun",d),n.post("/excel/shizheng",y),n.post("/excel/lackunit",v),n.post("/lackunit",h),n.delete("/lackunit/:num/:date",m),e.exports=n},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var a=n(r(3)),u=n(r(4)),s=function(){var e=(0,u.default)(a.default.mark(function e(t,r){var n,u;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.date,e.prev=1,e.next=4,o(n);case 4:u=e.sent,_.ConvertNullToZeroString(u),_.ResourceFound(r,u),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),_.InternalServerError(r,e.t0,n);case 12:case"end":return e.stop()}},e,this,[[1,9]])}));return function(t,r){return e.apply(this,arguments)}}(),o=function(){var e=(0,u.default)(a.default.mark(function e(t){var r,n,u,s;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.slice(0,4),n=t.slice(4),u="\n    SELECT 购水日期1, 购水量1, 购水单价1, 购水费1, 购水日期2, 购水量2, 购水单价2, 购水费2,统计标志  from 水费统计总表\n        where 年=:year and 月=:month\n    ",e.next=5,Q.query(u,{replacements:{year:r,month:n},type:Q.QueryTypes.SELECT});case 5:return s=e.sent,e.abrupt("return",s);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),c=function(){var e=(0,u.default)(a.default.mark(function e(t,r){var n,u;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,i(n);case 4:return e.next=6,o(n.用水日期);case 6:u=e.sent,_.ConvertNullToZeroString(u),_.ResourceFound(r,u),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),_.InternalServerError(r,e.t0,n);case 14:case"end":return e.stop()}},e,this,[[1,11]])}));return function(t,r){return e.apply(this,arguments)}}(),i=function(){var e=(0,u.default)(a.default.mark(function e(t){var r,n,u,s,o,c,i,p,l,f,d,y;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.用水日期,n=r.slice(0,4),u=r.slice(4),s=Array.apply(null,Array(31)).map(function(){return""}),o=Array.apply(null,Array(61)).map(function(){return 0}),c=Array.apply(null,Array(11)).map(function(){return 0}),i="\n    Delete from 水费统计总表 where 年=:year and 月=:month\n    ",e.next=9,Q.query(i,{replacements:{year:n,month:u},type:Q.QueryTypes.DELETE});case 9:return p="\n    insert into 水费统计总表 (年,月) values (:a1,:a2)\n    ",e.next=12,Q.query(p,{replacements:{a1:n,a2:u},type:Q.QueryTypes.INSERT});case 12:return l="\n    update 水费统计总表 set 购水日期1=:a3,购水量1=:a4,购水单价1=:a5,购水费1=:a6,购水日期2=:a7,购水量2=:a8,购水单价2=:a9,购水费2=:a10 \n        where 年=:a1 and 月=:a2 \n    ",e.next=15,Q.query(l,{replacements:{a1:n,a2:u,a3:t.购水日期1,a4:t.购水量1,a5:t.购水单价1,a6:t.购水费1,a7:t.购水日期2,a8:t.购水量2,a9:t.购水单价2,a10:t.购水费2},type:Q.QueryTypes.UPDATE});case 15:return o[1]=parseFloat(t.购水量1)+parseFloat(t.购水量2),o[2]=parseFloat(t.购水费1)+parseFloat(t.购水费2),i="\n    Delete from 水费统计水费标准 where 年=:year and 月=:month\n    ",e.next=20,Q.query(i,{replacements:{year:n,month:u},type:Q.QueryTypes.DELETE});case 20:return p="\n    Insert into 水费统计水费标准 (年,月,区号,单位类型,水费标准,用水量,计划水费,超额水费,防火费,手续费,其它,水费收入,排污费,备注) \n        SELECT :year,:month,区号,单位类别,单价,sum(用水量-减免水量) as 用水量,sum(计划水费-减免水费) as 计划水费,sum(超额水费) ,sum(防火费),sum(手续费),\n        sum(其它),sum(实收水费),sum(排污费-减排污费) as 排污费,'' FROM 水费统计查询\n        where (年=:year) and (月=:month)  \n        group by 区号,单位类别,单价\n    ",e.next=23,Q.query(p,{replacements:{year:n,month:u},type:Q.QueryTypes.INSERT});case 23:return f="\n    Select sum(用水量) as a1,sum(水费收入) as a2 from  水费统计水费标准\n        where (年=:year) and (月=:month)\n    ",e.next=26,Q.query(f,{replacements:{year:n,month:u},type:Q.QueryTypes.SELECT});case 26:return d=e.sent,s[1]=d[0].a1,s[2]=d[0].a2,l="\n    update  水费统计水费标准  \n        set 总水量百分比=用水量*100/"+s[1]+",总水费百分比=水费收入*100/"+s[2]+" \n        where (年=:year) and (月=:month)\n    ",e.next=32,Q.query(l,{replacements:{year:n,month:u},type:Q.QueryTypes.UPDATE});case 32:return f="\n    Select count(distinct 编号) as 用户数,sum(用水量-减免水量) as 供水量,sum(计划水量-减免水量) as 计划水量,sum(计划水费-减免水费) as 计划水费,sum(超额水量) as 超额水量,\n        sum(超额水费) as 超额水费,sum(排污费-减排污费) as 排污费,sum(防火费) as 防火费,sum(手续费) as 手续费,sum(其它-减其它) as 其它,sum(实收水费) as 水费\n        from 水费统计查询\n        where (年=:year) and (月=:month)\n    ",e.next=35,Q.query(f,{replacements:{year:n,month:u},type:Q.QueryTypes.SELECT});case 35:return d=e.sent,c[1]=parseInt(d[0]["用户数"]),o[3]=parseFloat(d[0]["供水量"]),o[4]=parseFloat(d[0]["计划水量"]),o[5]=parseFloat(d[0]["计划水费"]),o[6]=parseFloat(d[0]["超额水量"]),o[7]=parseFloat(d[0]["超额水费"]),o[8]=parseFloat(d[0]["排污费"]),o[9]=parseFloat(d[0]["防火费"]),o[10]=parseFloat(d[0]["手续费"]),o[11]=parseFloat(d[0]["其它"]),o[12]=parseFloat(d[0]["水费"]),o[13]=o[1]-o[3],0!=o[1]?o[14]=o[13]/o[1]:o[14]=0,f="\n    Select count(distinct 编号) as 正式用户数\n        from 水费统计查询\n        where (年=:year) and (月=:month) and  用水形式编号='2'\n    ",e.next=52,Q.query(f,{replacements:{year:n,month:u},type:Q.QueryTypes.SELECT});case 52:return d=e.sent,c[2]=parseInt(d[0]["正式用户数"]),f="\n    Select count(distinct 编号) as 临时用户数\n        from 水费统计查询\n        where (年=:year) and (月=:month) and  用水形式编号='0'\n    ",e.next=57,Q.query(f,{replacements:{year:n,month:u},type:Q.QueryTypes.SELECT});case 57:if(d=e.sent,c[3]=parseInt(d[0]["临时用户数"]),c[1]==c[2]+c[3]){e.next=61;break}throw new Error("用户数计算错误");case 61:return l="\n    update 水费统计总表 set 用户个数=:a3,正式个数=:a4,临时个数=:a5,供水量=:a6,水费=:a7,计划水量=:a8,计划水费=:a9,超额水量=:a10,超额水费=:a11,排污费=:a12,防火费=:a13,\n        手续费=:a14,其它=:a15,与供水差值=:a16,水损率=:a17\n        where 年=:a1 and 月=:a2\n    ",e.next=64,Q.query(l,{replacements:{a1:n,a2:u,a3:c[1],a4:c[2],a5:c[3],a6:o[3],a7:o[12],a8:o[4],a9:o[5],a10:o[6],a11:o[7],a12:o[8],a13:o[9],a14:o[10],a15:o[11],a16:o[13],a17:o[14]},type:Q.QueryTypes.UPDATE});case 64:return i="\n    Delete from 水费统计市政公司 where 年=:year and 月=:month\n    ",e.next=67,Q.query(i,{replacements:{year:n,month:u},type:Q.QueryTypes.DELETE});case 67:return p="\n    insert into 水费统计市政公司\n        Select distinct :year,:month,REPLACE(SUBSTRING(户名, 10, 30), '）', ''),SUM(用水量),SUM(实收水费),''\n        From 水费报表查询 where (年=:year) and (月=:month) and 户名 like '%天保市政%'\n        Group by REPLACE(SUBSTRING(户名, 10, 30), '）', '')\n    ",e.next=70,Q.query(p,{replacements:{year:n,month:u},type:Q.QueryTypes.INSERT});case 70:return y=1,f="\n    select sum(实收水费) as a1 from 水费统计查询 where (年=:year) and (月=:month)\n        group by 收费形式编号\n    ",e.next=74,Q.query(f,{replacements:{year:n,month:u},type:Q.QueryTypes.SELECT});case 74:return d=e.sent,y=1,d.forEach(function(e){o[y+14]=parseFloat(e.a1),y+=1}),f="\n    select sum(实收水费) as a1 from 水费统计查询 where (年=:year) and (月=:month)\n        group by 用水形式编号\n    ",e.next=80,Q.query(f,{replacements:{year:n,month:u},type:Q.QueryTypes.SELECT});case 80:return d=e.sent,y=1,d.forEach(function(e){o[y+17]=parseFloat(e.a1),y+=1}),l="\n    update 水费统计总表 set 托收水费=:a3,支票水费=:a4,内结水费=:a5,临时水费=:a6,正式水费=:a7\n        where 年=:a1 and 月=:a2\n    ",e.next=86,Q.query(l,{replacements:{a1:n,a2:u,a3:o[15],a4:o[16],a5:o[17],a6:o[18],a7:o[19]},type:Q.QueryTypes.UPDATE});case 86:return l="\n        update 水费统计总表 set 统计标志=:a18\n            where 年=:a1 and 月=:a2\n        ",e.next=89,Q.query(l,{replacements:{a1:n,a2:u,a18:8},type:Q.QueryTypes.UPDATE});case 89:if(!t.简报){e.next=125;break}return i="\n        delete from  水费统计简报 where 年=:year and 月=:month\n        ",e.next=93,Q.query(i,{replacements:{year:n,month:u},type:Q.QueryTypes.DELETE});case 93:return f="\n        Select top 12 编号,用水量 from 水费基本表 \n            where 年=:year and 月=:month\n            and  编号 not in (Select distinct 编号 from 水费基本表 where  年=:year1 and 月=:month) \n            order by 用水量 desc\n        ",e.next=96,Q.query(f,{replacements:{year:n,month:u,year1:(parseInt(n)-1).toString()},type:Q.QueryTypes.SELECT});case 96:return d=e.sent,y=1,d.forEach(function(e){s[y]=e.编号,o[y+20]=parseFloat(e.用水量),y+=1}),i="\n        delete from 水费统计用水增长_中转 \n        ",e.next=102,Q.query(i,{replacements:{year:n,month:u},type:Q.QueryTypes.DELETE});case 102:return p="\n        insert into 水费统计用水增长_中转 (编号,本月用水) \n            Select 编号,用水量 from 水费基本表 \n            where (年=:year) and (月=:month)  \n            order by 用水量 desc \n        ",e.next=105,Q.query(p,{replacements:{year:n,month:u},type:Q.QueryTypes.INSERT});case 105:return l="\n        update 水费统计用水增长_中转 set 去年用水= \n            (Select top 1 用水量 from 水费基本表\n            where 年=:year and 月=:month    \n            and  编号=水费统计用水增长_中转.编号  order by  用水量 desc)\n        ",e.next=108,Q.query(l,{replacements:{year:(parseInt(n)-1).toString(),month:u},type:Q.QueryTypes.UPDATE});case 108:return f="\n        Select top 12 编号,本月用水,去年用水   from 水费统计用水增长_中转 \n            order by 本月用水-去年用水 desc\n        ",e.next=111,Q.query(f,{replacements:{},type:Q.QueryTypes.SELECT});case 111:d=e.sent,y=1,d.forEach(function(e){s[y+12]=e.编号,o[y+32]=parseFloat(e.本月用水),o[y+44]=parseFloat(e.去年用水),y+=1}),y=1;case 115:if(!(y<=12)){e.next=122;break}return p="\n            insert into  水费统计简报 (年,月,内部序号,新用户编号,新用户用水量,老用户编号,老用户本月水量,老用户去年水量) \n                values (:a1,:a2,:a3,:a4,:a5,:a6,:a7,:a8)\n            ",e.next=119,Q.query(p,{replacements:{a1:n,a2:u,a3:y,a4:s[y],a5:o[y+20],a6:s[y+12],a7:o[y+32],a8:o[y+44]},type:Q.QueryTypes.INSERT});case 119:y++,e.next=115;break;case 122:return l="\n        update 水费统计总表 set 统计标志=:a18\n            where 年=:a1 and 月=:a2\n        ",e.next=125,Q.query(l,{replacements:{a1:n,a2:u,a18:9},type:Q.QueryTypes.UPDATE});case 125:return e.abrupt("return",!0);case 126:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),p=function(){var e=(0,u.default)(a.default.mark(function e(t,r){var n,u;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,l(n.用水日期,n.user);case 4:u=e.sent,r.writeHead(200,[["Content-Type","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"]]),r.end(new Buffer(u,"base64")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),_.InternalServerError(r,e.t0,{});case 12:case"end":return e.stop()}},e,this,[[1,9]])}));return function(t,r){return e.apply(this,arguments)}}(),l=function(){var e=(0,u.default)(a.default.mark(function e(t,r){var n,u,s,o,c,i;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.slice(0,4),u=t.slice(4),s={date:n+"年"+u+"月"},o="\n    Select * from 水费统计总表 where (年=:year) and (月=:month)\n    ",e.next=6,Q.query(o,{replacements:{year:n,month:u},type:Q.QueryTypes.SELECT});case 6:return c=e.sent,i=c[0],s.D4=(parseFloat(i["购水量1"])+parseFloat(i["购水量2"])).toString(),s.D5=(parseFloat(i["购水费1"])+parseFloat(i["购水费2"])).toString(),s.D6=i["供水量"],s.D8=i["计划水费"],s.D9=i["超额水费"],s.D10=i["防火费"],s.D11=i["手续费"],s.D12=i["其它"],s.D13=i["排污费"],s.D15=i["托收水费"],s.D16=i["支票水费"],s.D17=i["内结水费"],s.D19=i["临时水费"],s.D20=i["正式水费"],s.D21=i["用户个数"],s.D22=i["临时个数"],s.D23=i["正式个数"],s.D24=(100*parseFloat(i["水损率"])).toString()+"%",o="\n    Select sum(购水量1+购水量2) as 购水量   ,  sum(购水费1+购水费2) as 购水费 , sum(供水量) as 供水量 , \n        sum(计划水费) as 计划水费 , sum(超额水费) as 超额水费  , sum(防火费) as 防火费   , sum(手续费) as 手续费   , sum(其它) as 其它     , sum(排污费) as 排污费,  \n        sum(托收水费) as 托收水费 , sum(支票水费) as 支票水费  , sum(内结水费) as 内结水费 , sum(临时水费) as 临时水费 , sum(正式水费) as 正式水费     , sum(用户个数) as 用户个数, \n        sum(临时个数) as 临时个数 , sum(正式个数) as 正式个数\n        from 水费统计总表 \n        where (年=:year) and (月=:month)\n    ",e.next=29,Q.query(o,{replacements:{year:n,month:u},type:Q.QueryTypes.SELECT});case 29:return c=e.sent,i=c[0],s.E4=i["购水量"],s.E5=i["购水费"],s.E6=i["供水量"],s.E8=i["计划水费"],s.E9=i["超额水费"],s.E10=i["防火费"],s.E11=i["手续费"],s.E12=i["其它"],s.E13=i["排污费"],s.E15=i["托收水费"],s.E16=i["支票水费"],s.E17=i["内结水费"],s.E19=i["临时水费"],s.E20=i["正式水费"],s.E21=Math.round(parseFloat(i["用户个数"])/parseFloat(u)),s.E22=Math.round(parseFloat(i["临时个数"])/parseFloat(u)),s.E23=Math.round(parseFloat(i["正式个数"])/parseFloat(u)),0===parseFloat(i["购水量"])?s.E24="0%":s.E24=((parseFloat(i["购水量"])-parseFloat(i["供水量"]))/parseFloat(i["购水量"])*100).toString()+"%",s.E25=r,s.E27=R(new Date,"yyyy-mm-dd"),e.abrupt("return",N("JingYing","Sheet1",s));case 52:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}(),f=function(){var e=(0,u.default)(a.default.mark(function e(t,r){var n,u;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,d(n.用水日期,n.user);case 4:u=e.sent,r.writeHead(200,[["Content-Type","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"]]),r.end(new Buffer(u,"base64")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),_.InternalServerError(r,e.t0,{});case 12:case"end":return e.stop()}},e,this,[[1,9]])}));return function(t,r){return e.apply(this,arguments)}}(),d=function(){var e=(0,u.default)(a.default.mark(function e(t,r){var n,u,s,o,c;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.slice(0,4),u=t.slice(4),s={date:n+"年"+u+"月"},o="\n    Select * from 水费统计水费标准 where (年=:year) and (月=:month) order by 区号\n    ",e.next=6,Q.query(o,{replacements:{year:n,month:u},type:Q.QueryTypes.SELECT});case 6:return(c=e.sent).forEach(function(e){e.总水量百分比/=100,e.总水费百分比/=100}),s.items=c,s.D13=r,s.G13=R(new Date,"yyyy-mm-dd"),e.abrupt("return",N("standard","Sheet1",s));case 12:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}(),y=function(){var e=(0,u.default)(a.default.mark(function e(t,r){var n,u;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,h(n.用水日期,n.user);case 4:u=e.sent,r.writeHead(200,[["Content-Type","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"]]),r.end(new Buffer(u,"base64")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),_.InternalServerError(r,e.t0,{});case 12:case"end":return e.stop()}},e,this,[[1,9]])}));return function(t,r){return e.apply(this,arguments)}}(),h=function(){var e=(0,u.default)(a.default.mark(function e(t,r){var n,u,s,o,c,i;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.slice(0,4),u=t.slice(4),s={date:R(new Date,"yyyy-mm-dd"),year:n,month:u},o="\n    Select * from 水费统计明细查询  where (年=:year) and (月=:month) \n    ",e.next=6,Q.query(o,{replacements:{year:n,month:u},type:Q.QueryTypes.SELECT});case 6:return c=e.sent,i=c.length,c.push({"编号":"合计","户名":i+"户","实际用水量":"=SUM(C4:C"+(3+i)+")","实际计划水费":"=SUM(D4:D"+(3+i)+")","超额水费":"=SUM(E4:E"+(3+i)+")","排污费":"=SUM(F4:F"+(3+i)+")","防火费":"=SUM(G4:G"+(3+i)+")","手续费":"=SUM(H4:H"+(3+i)+")","其它":"=SUM(I4:I"+(3+i)+")","减水费":"=SUM(J4:J"+(3+i)+")","实收水费":"=SUM(K4:K"+(3+i)+")"}),s.items=c,s.D13=r,s.G13=R(new Date,"yyyy-mm-dd"),e.abrupt("return",N("Detail","Sheet1",s));case 13:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}(),m=function(){var e=(0,u.default)(a.default.mark(function e(t,r){var n,u;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,v(n.用水日期,n.user);case 4:u=e.sent,r.writeHead(200,[["Content-Type","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"]]),r.end(new Buffer(u,"base64")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),_.InternalServerError(r,e.t0,{});case 12:case"end":return e.stop()}},e,this,[[1,9]])}));return function(t,r){return e.apply(this,arguments)}}(),v=function(){var e=(0,u.default)(a.default.mark(function e(t,r){var n,u,s,o,c,i,p,l;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=void 0,u=void 0,s=t.slice(0,4),o=t.slice(4),c=Array.apply(null,Array(11)).map(function(){return 0}),i={A2:s+"年"+o+"月",G24:R(new Date,"yyyy-mm-dd"),E24:r},p="\n    SELECT 供水量,水损率 from  水费统计总表  where (年=:year) and (月=:month) \n    ",e.next=8,Q.query(p,{replacements:{year:s,month:o},type:Q.QueryTypes.SELECT});case 8:return n=e.sent,u=n[0],c[1]=(parseFloat(u.供水量)/1e4).toFixed(2),c[2]=100*parseFloat(u.水损率),p="\n    SELECT 供水量 from  水费统计总表  where (年=:year) and (月=:month) \n    ",e.next=15,Q.query(p,{replacements:{year:(parseInt(s)-1).toString(),month:o},type:Q.QueryTypes.SELECT});case 15:return(n=e.sent).length>0?(u=n[0],c[3]=(parseFloat(u.供水量)/1e4).toFixed(2)):c[3]=20,p="\n    SELECT  sum(供水量) as 供水量 from  水费统计总表 where (年=:year) \n    ",e.next=20,Q.query(p,{replacements:{year:s},type:Q.QueryTypes.SELECT});case 20:return n=e.sent,u=n[0],c[4]=(parseFloat(u.供水量)/1e4).toFixed(2),c[5]=Math.round((c[1]-c[3])/c[3]*100),i.A3="一、"+o.toString()+"月份供水量"+parseFloat(c[1])+"万吨，本年累计完成"+parseFloat(c[4])+"万吨。",i.A4="    去年同期供水量"+parseFloat(c[3])+"万吨，比去年同期增长"+parseFloat(c[5])+"%  。",i.A20="二、本月水损率"+parseFloat(c[2])+"%，符合行业规定指标损耗范围。",p="\n    Select top 6 * from 水费统计简报查询 where 年=:year and 月=:month and 新用户名称 is not null order by 新用户用水量 desc\n    ",e.next=30,Q.query(p,{replacements:{year:s,month:o},type:Q.QueryTypes.SELECT});case 30:return n=e.sent,l=7,n.forEach(function(e){i["B"+l.toString()]=(l-6).toString()+". "+e["新用户名称"]+":本月"+e["新用户用水量"]+"吨。",l+=1}),p="\n    Select top 6  * from 水费统计简报查询 where 年=:year and 月=:month and 老用户名称 is not null  order by 老用户本月水量 desc\n    ",e.next=36,Q.query(p,{replacements:{year:s,month:o},type:Q.QueryTypes.SELECT});case 36:return n=e.sent,l=14,n.forEach(function(e){i["B"+l.toString()]=(l-13).toString()+". "+e["老用户名称"]+":本月"+e["老用户本月水量"]+"吨，去年同期"+e["老用户去年水量"]+"吨。",l+=1}),e.abrupt("return",N("JianBao","Sheet1",i));case 40:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}(),x=function(){var e=(0,u.default)(a.default.mark(function e(t,r){var n,u;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,w(n.用水日期,n.user);case 4:u=e.sent,r.writeHead(200,[["Content-Type","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"]]),r.end(new Buffer(u,"base64")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),_.InternalServerError(r,e.t0,{});case 12:case"end":return e.stop()}},e,this,[[1,9]])}));return function(t,r){return e.apply(this,arguments)}}(),w=function(){var e=(0,u.default)(a.default.mark(function e(t,r){var n,u,s,o,c,i,p;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=void 0,u=void 0,s=t.slice(0,4),o=t.slice(4),Array.apply(null,Array(11)).map(function(){return 0}),c={A1:s+"年"+o+"月",E30:R(new Date,"yyyy-mm-dd"),E28:r},i="\n    Select * from 水费统计总表   where (年=:year) and (月=:month) \n    ",e.next=8,Q.query(i,{replacements:{year:s,month:o},type:Q.QueryTypes.SELECT});case 8:return n=e.sent,u=n[0],c.D5=u["购水量1"],c.D6=u["购水量2"],c.D8=u["购水费1"],c.D9=u["购水费2"],c.D10=u["供水量"],c.D11=u["超额水量"],c.D13=u["计划水费"],c.D14=u["超额水费"],c.D15=u["防火费"],c.D16=u["手续费"],c.D17=u["其它"],c.D18=u["排污费"],i="\n    Select sum(购水量1) as 购水量1   , sum(购水量2) as 购水量2    , sum(购水费1) as 购水费1 , sum(购水费2) as 购水费2 , sum(供水量) as 供水量 , sum(超额水量) as 超额水量,\n        sum(计划水费) as 计划水费 , sum(超额水费) as 超额水费  , sum(防火费) as 防火费   , sum(手续费) as 手续费   , sum(其它) as 其它     , sum(排污费) as 排污费 \n        from 水费统计总表 where (年=:year) and (月<=:month) \n    ",e.next=25,Q.query(i,{replacements:{year:s,month:o},type:Q.QueryTypes.SELECT});case 25:return n=e.sent,u=n[0],c.E5=u["购水量1"],c.E6=u["购水量2"],c.E8=u["购水费1"],c.E9=u["购水费2"],c.E10=u["供水量"],c.E11=u["超额水量"],c.E13=u["计划水费"],c.E14=u["超额水费"],c.E15=u["防火费"],c.E16=u["手续费"],c.E17=u["其它"],c.E18=u["排污费"],i="\n    Select * from 水费统计市政公司 where (年=:year) and (月<=:month) order by 部门 \n    ",e.next=42,Q.query(i,{replacements:{year:s,month:o},type:Q.QueryTypes.SELECT});case 42:return n=e.sent,p=20,n.forEach(function(e){c["B"+p.toString()]=e["部门"],c["D"+p.toString()]=e["金额"],p+=1}),i="\n    Select 部门,sum(金额) as 金额 from 水费统计市政公司 where (年=:year)  group by 部门 \n    ",e.next=48,Q.query(i,{replacements:{year:s},type:Q.QueryTypes.SELECT});case 48:return n=e.sent,p=20,n.forEach(function(e){c["E"+p.toString()]=e["金额"],p+=1}),e.abrupt("return",N("qingdan","Sheet1",c));case 52:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}(),b=function(){var e=(0,u.default)(a.default.mark(function e(t,r){var n,u;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,E(n.用水日期,n.user);case 4:u=e.sent,r.writeHead(200,[["Content-Type","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"]]),r.end(new Buffer(u,"base64")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),_.InternalServerError(r,e.t0,{});case 12:case"end":return e.stop()}},e,this,[[1,9]])}));return function(t,r){return e.apply(this,arguments)}}(),E=function(){var e=(0,u.default)(a.default.mark(function e(t,r){var n,u,s,o,c,i;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=void 0,void 0,u=t.slice(0,4),s=t.slice(4),o={date:u+"年"+s+"月"},c="\n    Select * from 水费统计查询 where (年=:year) and (月=:month) and (区号='2' or 区号='7') order by 编号\n    ",e.next=7,Q.query(c,{replacements:{year:u,month:s},type:Q.QueryTypes.SELECT});case 7:return n=e.sent,i=1,n.forEach(function(e){e.序号=i,e.年=u,e.月=s,i+=1}),n.push({"序号":"合计","用水量":"=SUM(F3:F"+(n.length+2)+")"}),o.items=n,e.abrupt("return",N("GongYe","Sheet1",o));case 13:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}(),S=function(){var e=(0,u.default)(a.default.mark(function e(t,r){var n,u;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,k(n.用水日期,n.user);case 4:u=e.sent,r.writeHead(200,[["Content-Type","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"]]),r.end(new Buffer(u,"base64")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),_.InternalServerError(r,e.t0,{});case 12:case"end":return e.stop()}},e,this,[[1,9]])}));return function(t,r){return e.apply(this,arguments)}}(),k=function(){var e=(0,u.default)(a.default.mark(function e(t,r){var n,u,s,o,c;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=void 0,void 0,u=t.slice(0,4),t.slice(4),s=Array.apply(null,Array(31)).map(function(){return 0}),o={B2:u+"年"},c="\n    Select * from 水费统计总表 where (年=:year) order by 月\n    ",e.next=8,Q.query(c,{replacements:{year:u},type:Q.QueryTypes.SELECT});case 8:return n=e.sent,1,n.forEach(function(e){var t=parseInt(e.月);s[t]=(parseFloat(e["购水量1"])+parseFloat(e["购水量2"]))/1e4,s[t+12]=parseFloat(e["供水量"])/1e4}),o.B4=parseFloat(s[1]),o.C4=parseFloat(s[2]),o.D4=parseFloat(s[3]),o.E4=parseFloat(s[4]),o.F4=parseFloat(s[5]),o.G4=parseFloat(s[6]),o.H4=parseFloat(s[7]),o.I4=parseFloat(s[8]),o.J4=parseFloat(s[9]),o.K4=parseFloat(s[10]),o.L4=parseFloat(s[11]),o.M4=parseFloat(s[12]),o.B5=parseFloat(s[13]),o.C5=parseFloat(s[14]),o.D5=parseFloat(s[15]),o.E5=parseFloat(s[16]),o.F5=parseFloat(s[17]),o.G5=parseFloat(s[18]),o.H5=parseFloat(s[19]),o.I5=parseFloat(s[20]),o.J5=parseFloat(s[21]),o.K5=parseFloat(s[22]),o.L5=parseFloat(s[23]),o.M5=parseFloat(s[24]),e.abrupt("return",N("ShuiSun","sheet1",o));case 36:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}(),g=function(){var e=(0,u.default)(a.default.mark(function e(t,r){var n,u;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,T(n.用水日期,n.user);case 4:u=e.sent,r.writeHead(200,[["Content-Type","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"]]),r.end(new Buffer(u,"base64")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),_.InternalServerError(r,e.t0,{});case 12:case"end":return e.stop()}},e,this,[[1,9]])}));return function(t,r){return e.apply(this,arguments)}}(),T=function(){var e=(0,u.default)(a.default.mark(function e(t,r){var n,u,s,o,c,i;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=void 0,void 0,u=t.slice(0,4),s=t.slice(4),Array.apply(null,Array(31)).map(function(){return 0}),o={date:u+"年"+s+"月"},c="\n    Select * from 水费统计市政公司  where (年=:year) and (月=:month) \n    ",e.next=8,Q.query(c,{replacements:{year:u,month:s},type:Q.QueryTypes.SELECT});case 8:return n=e.sent,i=n.length,n.push({"部门":"合计","实际用水":"=SUM(B4:B"+(i+3)+")","金额":"=SUM(C4:C"+(i+3)+")"}),o.items=n,e.abrupt("return",N("shizheng","Sheet1",o));case 13:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}(),F=function(){var e=(0,u.default)(a.default.mark(function e(t,r){var n,u;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,C(n);case 4:u=e.sent,r.writeHead(200,[["Content-Type","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"]]),r.end(new Buffer(u,"base64")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),_.InternalServerError(r,e.t0,{});case 12:case"end":return e.stop()}},e,this,[[1,9]])}));return function(t,r){return e.apply(this,arguments)}}(),C=function(){var e=(0,u.default)(a.default.mark(function e(t){var r,n,u,s,o,c;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=void 0,n=t.月份.slice(0,4),u=t.月份.slice(4),s={year:n,month:u,date:R(new Date,"yyyy-mm-dd"),user:t.user},o="\n    Select * from 水费统计欠费  where (年=:year) and (月=:month) \n    ",e.next=7,Q.query(o,{replacements:{year:n,month:u},type:Q.QueryTypes.SELECT});case 7:return r=e.sent,c=r.length,r.push({"编号":"合计","户名":c+"户","往年欠费":"=SUM(C4:C"+(c+3)+")","本月欠费":"=SUM(D4:D"+(c+3)+")","前几月累计":"=SUM(E4:E"+(c+3)+")","小计":"=SUM(F4:F"+(c+3)+")","备注":""}),s.items=r,e.abrupt("return",N("lackunit","Sheet1",s));case 12:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),q=function(){var e=(0,u.default)(a.default.mark(function e(t,r){var n,u;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,I(n);case 4:u=e.sent,_.ConvertNullToZeroString(u),_.ResourceFound(r,u),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),_.InternalServerError(r,e.t0,n);case 12:case"end":return e.stop()}},e,this,[[1,9]])}));return function(t,r){return e.apply(this,arguments)}}(),I=function(){var e=(0,u.default)(a.default.mark(function e(t){var r,n,u,s,o,c,i,p,l,f,d,y,h;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=void 0,void 0,n=t.月份,u=t.统计选项,s=n.slice(0,4),o=n.slice(4),c=void 0,i=void 0,p=void 0,l=void 0,f=void 0,d=void 0,"01"===o?(c=(parseInt(s)-1).toString(),i="12"):(c=s,i=(i=(parseInt(o)-1).toString()).length<2?"0"+i:i),-1===u.indexOf("1")){e.next=39;break}return p="\n        Delete from  水费统计欠费 where 年=:year and 月=:month\n        ",e.next=12,Q.query(p,{replacements:{year:s,month:o},type:Q.QueryTypes.DELETE});case 12:return l="\n        Insert into 水费统计欠费 (年,月,编号,户名,往年欠费,本月欠费,前几月累计,小计,备注)\n        ",l+="01"===o?"\n            SELECT :year,:month,编号,户名,往年欠费+本月欠费+前几月累计,0,0,0,备注 FROM 水费统计欠费 \n            ":"\n            SELECT :year,:month,编号,户名,往年欠费,0,本月欠费+前几月累计,0,备注 FROM 水费统计欠费 \n            ",l+="\n        where  年=:TempYear and 月=:TempMonth\n            ",e.next=17,Q.query(l,{replacements:{year:s,month:o,TempYear:c,TempMonth:i},type:Q.QueryTypes.INSERT});case 17:return l="\n        Insert into 水费统计欠费 (年,月,编号,户名,往年欠费,本月欠费,前几月累计,小计,备注)\n            SELECT :year, :month, 编号,户名,0,实收水费,0,0,'自动计算' FROM 水费基本表\n            Where 编号 not in (Select 编号 from 水费统计欠费 where 年=:year and 月=:month) and 欠费标志='2' and 年=:year and 月=:month\n        ",e.next=20,Q.query(l,{replacements:{year:s,month:o},type:Q.QueryTypes.INSERT});case 20:return f="\n        update 水费统计欠费 set 往年欠费=(Select Sum (实收水费) FROM 水费基本表 where 欠费标志='2' and 年<:year and 编号=水费统计欠费.编号)\n            where 年=:year and 月=:month and 备注='自动计算'\n        ",e.next=23,Q.query(f,{replacements:{year:s,month:o},type:Q.QueryTypes.UPDATE});case 23:return f="\n        update 水费统计欠费 set 本月欠费=(Select Sum (实收水费) FROM 水费基本表 where 欠费标志='2' and 年=:year and 编号=水费统计欠费.编号 and 月=:month) \n            where 年=:year and 月=:month \n        ",e.next=26,Q.query(f,{replacements:{year:s,month:o},type:Q.QueryTypes.UPDATE});case 26:return f="01"===o?"\n            update 水费统计欠费 set 前几月欠费=0 \n            ":"\n            update 水费统计欠费 set 前几月累计=(Select Sum (实收水费) FROM 水费基本表 where 欠费标志='2' and 年=:year and 编号=水费统计欠费.编号 and 月<:month)\n            ",f+="\n        where 年=:year and 月=:month and 备注='自动计算'\n            ",e.next=30,Q.query(f,{replacements:{year:s,month:o},type:Q.QueryTypes.UPDATE});case 30:y=["往年欠费","本月欠费","前几月累计","小计"],h=0;case 32:if(!(h<y.length)){e.next=39;break}return f="\n                update 水费统计欠费 set "+y[h]+"=0 where "+y[h]+" is null \n                ",e.next=36,Q.query(f,{replacements:{},type:Q.QueryTypes.UPDATE});case 36:h++,e.next=32;break;case 39:if(-1===u.indexOf("2")){e.next=43;break}return f="\n        Update 水费统计欠费\n            Set 小计=往年欠费+本月欠费+前几月累计\n            where 年=:year and 月=:month\n            ",e.next=43,Q.query(f,{replacements:{year:s,month:o},type:Q.QueryTypes.UPDATE});case 43:return d="\n    Select * from  水费统计欠费\n        where  年=:year and 月=:month\n            ",e.next=46,Q.query(d,{replacements:{year:s,month:o},type:Q.QueryTypes.SELECT});case 46:return r=e.sent,e.abrupt("return",r);case 48:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),A=function(){var e=(0,u.default)(a.default.mark(function e(t,r){var n,u,s,o;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params,u=n.date,s=n.num,e.prev=1,e.next=4,L(u,s);case 4:o=e.sent,_.ResourceFound(r,o),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),_.InternalServerError(r,e.t0,{date:u,num:s});case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),L=function(){var e=(0,u.default)(a.default.mark(function e(t,r){var n,u,s,o;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.slice(0,4),u=t.slice(4),void 0,void 0,s=void 0,s="\n    Delete from 水费统计欠费 where 年=:year and 月=:month and 编号=:num\n    ",e.next=7,Q.query(s,{replacements:{year:n,month:u,num:r},type:Q.QueryTypes.DELETE});case 7:return o=e.sent,e.abrupt("return",o);case 9:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}(),R=r(12),_=r(1),Q=r(8),N=r(27).toExcel;e.exports.queryStatTollStatus=s,e.exports.handleStatToll=c,e.exports.JingYingToExcel=p,e.exports.StandardToExcel=f,e.exports.DetailToExcel=y,e.exports.JianBaoToExcel=m,e.exports.QingDanToExcel=x,e.exports.GongYeToExcel=b,e.exports.ShuiSunToExcel=S,e.exports.ShiZhengToExcel=g,e.exports.LackUnitToExcel=F,e.exports.handleLackUnit=q,e.exports.deleteLackUnit=A},function(e,t,r){"use strict";var n=r(0).Router(),a=r(207),u=a.queryCommission,s=a.queryDetail,o=a.ChargeMonthToExcel,c=a.ChargeYearByMeterToExcel,i=a.ChargeYearByCorpToExcel,p=a.queryAllowance,l=a.AllowanceToExcel;n.get("/commission/:date",u),n.get("/detail/:date/:kind",s),n.post("/chargemonth/excel",o),n.post("/chargeyear/excel/meter",c),n.post("/chargeyear/excel/corp",i),n.get("/allowance",p),n.get("/allowance/excel/:lister",l),e.exports=n},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var a=n(r(48)),u=n(r(49)),s=n(r(3)),o=n(r(4)),c=function(){var e=(0,o.default)(s.default.mark(function e(t,r){var n,a;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.date,e.prev=1,e.next=4,i(n);case 4:a=e.sent,k.ResourceFound(r,a),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),k.InternalServerError(r,e.t0,n);case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),i=function(){var e=(0,o.default)(s.default.mark(function e(t){var r,n,a,u;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.slice(0,4),n=t.slice(4),a="\n    Select * from 水费报表查询 \n        where 年=:year and 月=:month\n        and 收费形式编号='1' order by 编号\n    ",e.next=5,g.query(a,{replacements:{year:r,month:n},type:g.QueryTypes.SELECT});case 5:return u=e.sent,e.abrupt("return",u);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),p=function(){var e=(0,o.default)(s.default.mark(function e(t,r){var n,a,u,o;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params,a=n.date,u=n.kind,e.prev=1,e.next=4,l(a,u);case 4:o=e.sent,k.ResourceFound(r,o),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),k.InternalServerError(r,e.t0,a);case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),l=function(){var e=(0,o.default)(s.default.mark(function e(t,r){var n,a,u,o;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.slice(0,4),a=t.slice(4),u=void 0,u=r&&"5"!==r?"\n        Select * from 水费报表查询 \n            where 年=:year and 月=:month\n            and 收费形式编号=:kind order by 编号\n        ":"\n        Select * from 水费报表查询 \n            where 年=:year and 月=:month\n            order by 编号\n        ",e.next=6,g.query(u,{replacements:{year:n,month:a,kind:r},type:g.QueryTypes.SELECT});case 6:return o=e.sent,e.abrupt("return",o);case 8:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}(),f=function(){var e=(0,o.default)(s.default.mark(function e(t,r){var n,a;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,d(n);case 4:a=e.sent,r.writeHead(200,[["Content-Type","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"]]),r.end(new Buffer(a,"base64")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),k.InternalServerError(r,e.t0,{});case 12:case"end":return e.stop()}},e,this,[[1,9]])}));return function(t,r){return e.apply(this,arguments)}}(),d=function(){var e=(0,o.default)(s.default.mark(function e(t){var r,n,a,u,o,c,i;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=void 0,void 0,n=t.月份,a=n.slice(0,4),u=n.slice(4),o={date:S(new Date,"yyyy-mm-dd"),year:a,month:u},c="\n    SELECT * FROM 水费报表查询  where (年=:year) and (月=:month) \n        and (编号>=:num1)  and  (编号<=:num2) \n        "+("1"===t.kind?"and (区号<>'8')":"and (区号='8')")+"\n        Order by 编号\n    ",e.next=8,g.query(c,{replacements:{year:a,month:u,num1:t.num1,num2:t.num2},type:g.QueryTypes.SELECT});case 8:return r=e.sent,(i=r.length)>0&&(r.forEach(function(e,t){e.水费合计="=S"+(t+4)+"-M"+(t+4)}),r.push({"编号":"合计","户名":i+"户","装表地点":"","排污费单价":"","上月表底":"=SUM(D4:D"+(i+3)+")","本月表底":"=SUM(E4:E"+(i+3)+")","实际用水量":"=SUM(F4:F"+(i+3)+")","实际计划水费":"=SUM(H4:H"+(i+3)+")","超额水量":"=SUM(I4:I"+(i+3)+")","超额水费":"=SUM(K4:K"+(i+3)+")","排污费":"=SUM(M4:M"+(i+3)+")","防火费":"=SUM(N4:N"+(i+3)+")","手续费":"=SUM(O4:O"+(i+3)+")","其它":"=SUM(P4:P"+(i+3)+")","减水费":"=SUM(Q4:Q"+(i+3)+")","水费合计":"=SUM(R4:R"+(i+3)+")","实收水费":"=SUM(S4:S"+(i+3)+")"})),o.items=r,e.abrupt("return",T("charge","Sheet1",o));case 13:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),y=function(){var e=(0,o.default)(s.default.mark(function e(t,r){var n,a;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,h(n);case 4:a=e.sent,r.writeHead(200,[["Content-Type","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"]]),r.end(new Buffer(a,"base64")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),k.InternalServerError(r,e.t0,{});case 12:case"end":return e.stop()}},e,this,[[1,9]])}));return function(t,r){return e.apply(this,arguments)}}(),h=function(){var e=(0,o.default)(s.default.mark(function e(t){var r,n,o,c,i,p,l,f,d,y,h,m;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=void 0,void 0,n={date:S(new Date,"yyyy-mm-dd")},o="\n    Select 年,户名,sum(实际用水量) as 实际用水量,sum(实际计划水费) as 实际计划水费,sum(超额水量) as 超额水量,sum(超额水费) as 超额水费,sum(防火费) as 防火费,sum(手续费) as 手续费,\n        sum(减水费) as 减水费,sum(实收水费) as 实收水费,sum(排污费) as 排污费,sum(其它) as 其它 from 水费报表查询\n        where (年+月>=:date1) and (年+月<=:date2)\n        and (编号>=:num1)  and  (编号<=:num2)\n        group by 年,户名 \n    ",e.next=5,g.query(o,{replacements:{date1:t.date1,date2:t.date2,num1:t.num1,num2:t.num2},type:g.QueryTypes.SELECT});case 5:for(r=e.sent,c=new u.default,r.forEach(function(e){var t=function(e){var t=(e=e.trim()).charAt(e.length-1);if(")"===t){var r=e.lastIndexOf("(");return e.substring(0,r)}if("）"===t){var n=e.lastIndexOf("（");return e.substring(0,n)}return e}(e.户名);if(e.户名=t,c.has(t)){var r=c.get(t);r.实际用水量+=e.实际用水量,r.实际计划水费+=e.实际计划水费,r.超额水量+=e.超额水量,r.超额水费+=e.超额水费,r.防火费+=e.防火费,r.手续费+=e.手续费,r.减水费+=e.减水费,r.实收水费+=e.实收水费,r.排污费+=e.排污费,r.其它+=e.其它}else c.set(t,e)}),i=[],p=!0,l=!1,f=void 0,e.prev=12,d=(0,a.default)(c);!(p=(y=d.next()).done);p=!0)h=y.value,i.push(h[1]);e.next=20;break;case 16:e.prev=16,e.t0=e.catch(12),l=!0,f=e.t0;case 20:e.prev=20,e.prev=21,!p&&d.return&&d.return();case 23:if(e.prev=23,!l){e.next=26;break}throw f;case 26:return e.finish(23);case 27:return e.finish(20);case 28:return(m=i.length)>0&&i.push({"年":"合计","月":m+"户","实际用水量":"=SUM(D4:D"+(m+3)+")","实际计划水费":"=SUM(F4:F"+(m+3)+")","超额水量":"=SUM(G4:G"+(m+3)+")","超额水费":"=SUM(I4:I"+(m+3)+")","排污费":"=SUM(J4:J"+(m+3)+")","防火费":"=SUM(K4:K"+(m+3)+")","手续费":"=SUM(L4:L"+(m+3)+")","其它":"=SUM(M4:M"+(m+3)+")","减水费":"=SUM(N4:N"+(m+3)+")","实收水费":"=SUM(O4:O"+(m+3)+")"}),n.items=i,e.abrupt("return",T("chargeyearcorp","Sheet2",n));case 32:case"end":return e.stop()}},e,this,[[12,16,20,28],[21,,23,27]])}));return function(t){return e.apply(this,arguments)}}(),m=function(){var e=(0,o.default)(s.default.mark(function e(t,r){var n,a;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,v(n);case 4:a=e.sent,r.writeHead(200,[["Content-Type","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"]]),r.end(new Buffer(a,"base64")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),k.InternalServerError(r,e.t0,{});case 12:case"end":return e.stop()}},e,this,[[1,9]])}));return function(t,r){return e.apply(this,arguments)}}(),v=function(){var e=(0,o.default)(s.default.mark(function e(t){var r,n,a,u;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=void 0,void 0,n={date:S(new Date,"yyyy-mm-dd")},a="\n    Select 年,编号,户名,装表地点,sum(实际用水量) as 实际用水量,sum(实际计划水费) as 实际计划水费,sum(超额水量) as 超额水量,sum(超额水费) as 超额水费,sum(防火费) as 防火费,sum(手续费) as 手续费,\n        sum(减水费) as 减水费,sum(实收水费) as 实收水费,sum(排污费) as 排污费,sum(其它) as 其它 from 水费报表查询\n        where (年+月>=:date1) and (年+月<=:date2)\n        and (编号>=:num1)  and  (编号<=:num2)\n        group by 年,编号,户名,装表地点 order by 编号\n    ",e.next=5,g.query(a,{replacements:{date1:t.date1,date2:t.date2,num1:t.num1,num2:t.num2},type:g.QueryTypes.SELECT});case 5:return r=e.sent,(u=r.length)>0&&r.push({"年":"合计","月":u+"户","实际用水量":"=SUM(F4:F"+(u+3)+")","实际计划水费":"=SUM(H4:H"+(u+3)+")","超额水量":"=SUM(I4:I"+(u+3)+")","超额水费":"=SUM(K4:K"+(u+3)+")","排污费":"=SUM(L4:L"+(u+3)+")","防火费":"=SUM(M4:M"+(u+3)+")","手续费":"=SUM(N4:N"+(u+3)+")","其它":"=SUM(O4:O"+(u+3)+")","减水费":"=SUM(P4:P"+(u+3)+")","实收水费":"=SUM(Q4:Q"+(u+3)+")"}),n.items=r,e.abrupt("return",T("chargeyear","Sheet2",n));case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),x=function(){var e=(0,o.default)(s.default.mark(function e(t,r){var n;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,w();case 3:n=e.sent,k.ResourceFound(r,n),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),k.InternalServerError(r,e.t0,{});case 10:case"end":return e.stop()}},e,this,[[0,7]])}));return function(t,r){return e.apply(this,arguments)}}(),w=function(){var e=(0,o.default)(s.default.mark(function e(){var t,r;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=void 0,t="\n    SELECT * FROM  水费贴费查询\n        ",e.next=4,g.query(t,{replacements:{},type:g.QueryTypes.SELECT});case 4:return r=e.sent,e.abrupt("return",r);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),b=function(){var e=(0,o.default)(s.default.mark(function e(t,r){var n,a;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.lister,e.prev=1,e.next=4,E(n);case 4:a=e.sent,r.writeHead(200,[["Content-Type","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"]]),r.end(new Buffer(a,"base64")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),k.InternalServerError(r,e.t0,{});case 12:case"end":return e.stop()}},e,this,[[1,9]])}));return function(t,r){return e.apply(this,arguments)}}(),E=function(){var e=(0,o.default)(s.default.mark(function e(t){var r,n,a;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=void 0,void 0,n={date:S(new Date,"yyyy-mm-dd"),lister:t},a="\n    Select * from 水费贴费查询\n    ",e.next=5,g.query(a,{replacements:{},type:g.QueryTypes.SELECT});case 5:return r=e.sent,n.items=r,e.abrupt("return",T("allowance1","Sheet1",n));case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),S=r(12),k=r(1),g=r(8),T=r(27).toExcel;e.exports.queryCommission=c,e.exports.queryDetail=p,e.exports.ChargeMonthToExcel=f,e.exports.ChargeYearByCorpToExcel=y,e.exports.ChargeYearByMeterToExcel=m,e.exports.queryAllowance=x,e.exports.AllowanceToExcel=b},function(e,t,r){"use strict";var n=r(0).Router(),a=r(209),u=a.AllowanceToExcel,s=a.queryAllowance,o=a.queryFixWatch,c=a.queryRation,i=a.queryContract,p=a.queryCountShiZheng,l=a.CountShiZhengToExcel,f=a.queryCountAll,d=a.CountAllToExcel;n.post("/allowance/excel",u),n.post("/allowance",s),n.post("/fixwatch",o),n.post("/ration",c),n.post("/contract",i),n.post("/countshizheng",p),n.post("/countshizheng/excel",l),n.post("/countall",f),n.post("/countall/excel",d),e.exports=n},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var a=n(r(3)),u=n(r(4)),s=function(){var e=(0,u.default)(a.default.mark(function e(t,r){var n,u;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,o(n);case 4:u=e.sent,r.writeHead(200,[["Content-Type","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"]]),r.end(new Buffer(u,"base64")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),T.InternalServerError(r,e.t0,{});case 12:case"end":return e.stop()}},e,this,[[1,9]])}));return function(t,r){return e.apply(this,arguments)}}(),o=function(){var e=(0,u.default)(a.default.mark(function e(t){var r,n,u;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=void 0,void 0,n={date:g(new Date,"yyyy-mm-dd"),user:t.user,kind:q[t.kind]},e.next=4,i(t);case 4:return r=e.sent,(u=r.length)>0&&r.push({"户名":"合计","装表地点":"","水贴费":"=SUM(E4:E"+(u+3)+")","增容费1":"=SUM(H4:H"+(u+3)+")","增容费2":"=SUM(J4:J"+(u+3)+")","增容费3":"=SUM(L4:L"+(u+3)+")","增容费4":"=SUM(N4:N"+(u+3)+")","增容费5":"=SUM(P4:P"+(u+3)+")","合计":"=SUM(Q4:Q"+(u+3)+")"}),n.items=r,e.abrupt("return",C("allowance","Sheet1",n));case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),c=function(){var e=(0,u.default)(a.default.mark(function e(t,r){var n,u;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,i(n);case 4:u=e.sent,T.ResourceFound(r,u),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),T.InternalServerError(r,e.t0,n);case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),i=function(){var e=(0,u.default)(a.default.mark(function e(t){var r,n;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r="\n    SELECT A.编号,B.户名,B.装表地点,A.交费日期,A.水贴费,A.贴费状态,A.增容日期1,A.增容费1,A.增容日期2,A.增容费2,A.增容日期3,A.增容费3,A.增容日期4,A.增容费4,A.增容日期5,A.增容费5, \n        A.合计 FROM 水费贴费表 A INNER JOIN 水费单位信息 B ON A.编号=B.编号\n        where (substring(交费日期,1,6)>=:date1)\n        and   (substring(交费日期,1,6)<=:date2)\n        and (A.编号>=:num1)  and  (A.编号<=:num2)\n    ",t.kind&&"无"!==t.kind&&(r+=" and (贴费状态=:kind) "),r+=" Order by A.编号 ",e.next=5,F.query(r,{replacements:{date1:t.date1,date2:t.date2,num1:t.num1,num2:t.num2,kind:t.kind},type:F.QueryTypes.SELECT});case 5:return n=e.sent,e.abrupt("return",n);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),p=function(){var e=(0,u.default)(a.default.mark(function e(t,r){var n,u;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,l(n);case 4:u=e.sent,T.ResourceFound(r,u),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),T.InternalServerError(r,e.t0,n);case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),l=function(){var e=(0,u.default)(a.default.mark(function e(t){var r,n;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r="\n    Select 编号,户名,装表地点,装表费,用水日期,装表日期 from 水费单位信息        \n        where (substring(用水日期,1,6)>=:date1)\n        and   (substring(用水日期,1,6)<=:date2)\n        and (编号>=:num1)  and  (编号<=:num2)\n        Order by 编号\n    ",e.next=3,F.query(r,{replacements:{date1:t.date1,date2:t.date2,num1:t.num1,num2:t.num2},type:F.QueryTypes.SELECT});case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),f=function(){var e=(0,u.default)(a.default.mark(function e(t,r){var n,u;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,d(n);case 4:u=e.sent,T.ResourceFound(r,u),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),T.InternalServerError(r,e.t0,n);case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),d=function(){var e=(0,u.default)(a.default.mark(function e(t){var r,n;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r="\n    Select 编号,户名,装表地点,申请水量,定额,substring(用水日期,1,4)+'.'+substring(用水日期,5,2)+' - '+substring(使用期限,1,4)+'.'+substring(使用期限,5,2) as 起止日期 from 水费单位信息        \n        where (扣水单位编号=编号) and 节门状态='开'\n        and (编号>=:num1)  and  (编号<=:num2)\n        "+("1"===t.kind?" and (申请水量>0)":" and (定额>0)")+"\n        Order by 编号\n    ",e.next=3,F.query(r,{replacements:{date1:t.date1,date2:t.date2,num1:t.num1,num2:t.num2},type:F.QueryTypes.SELECT});case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),y=function(){var e=(0,u.default)(a.default.mark(function e(t,r){var n,u;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,h(n);case 4:u=e.sent,T.ResourceFound(r,u),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),T.InternalServerError(r,e.t0,n);case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),h=function(){var e=(0,u.default)(a.default.mark(function e(t){var r,n;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r="\n    Select 编号,户名,联系人,电话 from 水费单位信息\n        where (扣水单位编号=编号) and 节门状态='开'\n        and (编号>=:num1)  and  (编号<=:num2)\n        Order by 编号\n    ",e.next=3,F.query(r,{replacements:{num1:t.num1,num2:t.num2},type:F.QueryTypes.SELECT});case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),m=function(){var e=(0,u.default)(a.default.mark(function e(t,r){var n,u;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,v(n);case 4:u=e.sent,T.ResourceFound(r,u),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),T.InternalServerError(r,e.t0,n);case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),v=function(){var e=(0,u.default)(a.default.mark(function e(t){var r,n,u,s,o,c;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=void 0,n=void 0,void 0,u=void 0,s=t.date.slice(0,4),o=t.date.slice(4),!t.recount){e.next=10;break}return u="\n            Delete from 水费统计市政公司 where (年=:year) and (月=:month)\n        ",e.next=7,F.query(u,{replacements:{year:s,month:o},type:F.QueryTypes.DELETE});case 7:return n="\n            Insert into 水费统计市政公司\n            SELECT :year, :month,装表地点,用水量,应收水费,0,0,0,'' FROM 水费修改计算 \n            where (年=:year) and (月=:month) and 户名 like '%市政%'\n        ",e.next=10,F.query(n,{replacements:{year:s,month:o},type:F.QueryTypes.INSERT});case 10:return r="\n    SELECT * FROM  水费统计市政公司 \n        where (年=:year) and (月=:month) \n    ",e.next=13,F.query(r,{replacements:{year:s,month:o},type:F.QueryTypes.SELECT});case 13:return c=e.sent,e.abrupt("return",c);case 15:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),x=function(){var e=(0,u.default)(a.default.mark(function e(t,r){var n,u;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,w(n);case 4:u=e.sent,r.writeHead(200,[["Content-Type","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"]]),r.end(new Buffer(u,"base64")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),T.InternalServerError(r,e.t0,{});case 12:case"end":return e.stop()}},e,this,[[1,9]])}));return function(t,r){return e.apply(this,arguments)}}(),w=function(){var e=(0,u.default)(a.default.mark(function e(t){var r,n,u,s;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=void 0,n=t.date.slice(0,4),u=t.date.slice(4),t.recount=!1,s={year:n,month:u,date:g(new Date,"yyyy-mm-dd"),user:t.user},e.next=7,v(t);case 7:return r=e.sent,s.items=r,e.abrupt("return",C("shizheng1","Sheet1",s));case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),b=function(){var e=(0,u.default)(a.default.mark(function e(t,r){var n,u;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,E(n);case 4:u=e.sent,T.ResourceFound(r,u),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),T.InternalServerError(r,e.t0,n);case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),E=function(){var e=(0,u.default)(a.default.mark(function e(t){var r,n,u,s,o,c,i;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=void 0,n=void 0,u=void 0,s=void 0,o=t.date.slice(0,4),c=t.date.slice(4),!t.recount){e.next=19;break}return s="\n            Delete from 水费统计清单  where (年=:year) and (月=:month)\n        ",e.next=7,F.query(s,{replacements:{year:o,month:c},type:F.QueryTypes.DELETE});case 7:return n="\n        Insert into 水费统计清单 (年,月,收入水量,排污费,水费收入,超额水量,超额水费)\n            SELECT :year, :month,sum(用水量),sum(排污费),sum(应收水费),sum(超额水量),sum(超额水费) FROM 水费修改计算 \n            where (年=:year) and (月=:month)\n        ",e.next=10,F.query(n,{replacements:{year:o,month:c},type:F.QueryTypes.INSERT});case 10:return u="\n        Update 水费统计清单 Set 年累计收入量= \n        (SELECT sum(收入水量)  FROM 水费统计清单 where (年=:year) and (月<=:month))\n            where (年=:year) and (月=:month)       \n        ",e.next=13,F.query(u,{replacements:{year:o,month:c},type:F.QueryTypes.UPDATE});case 13:return u="\n        Update 水费统计清单 Set 年水费累计收入= \n        (SELECT sum(水费收入)  FROM 水费统计清单 where (年=:year) and (月<=:month))\n            where (年=:year) and (月=:month)       \n        ",e.next=16,F.query(u,{replacements:{year:o,month:c},type:F.QueryTypes.UPDATE});case 16:return u="\n        Update 水费统计清单 Set 市政公司水费= \n        (SELECT sum(金额)  FROM 水费统计市政公司 where (年=:year) and (月=:month))\n            where (年=:year) and (月=:month)       \n        ",e.next=19,F.query(u,{replacements:{year:o,month:c},type:F.QueryTypes.UPDATE});case 19:return r="\n    SELECT * FROM  水费统计清单\n        where (年=:year) and (月=:month) \n    ",e.next=22,F.query(r,{replacements:{year:o,month:c},type:F.QueryTypes.SELECT});case 22:return i=e.sent,e.abrupt("return",i);case 24:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),S=function(){var e=(0,u.default)(a.default.mark(function e(t,r){var n,u;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,k(n);case 4:u=e.sent,r.writeHead(200,[["Content-Type","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"]]),r.end(new Buffer(u,"base64")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),T.InternalServerError(r,e.t0,{});case 12:case"end":return e.stop()}},e,this,[[1,9]])}));return function(t,r){return e.apply(this,arguments)}}(),k=function(){var e=(0,u.default)(a.default.mark(function e(t){var r,n,u,s,o;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=void 0,n=void 0,u=t.date.slice(0,4),s=t.date.slice(4),t.recount=!1,o={year:u,month:s,date:g(new Date,"yyyy-mm-dd"),user:t.user},e.next=7,E(t);case 7:return(r=e.sent).length>0&&(n=r[0],o.C3=n["收入水量"],o.C4=n["年累计收入量"],o.C5=n["排污费"],o.C6=n["水费收入"],o.C7=n["年水费累计收入"],o.C8=n["超额水量"],o.C9=n["超额水费"],o.C10=n["市政公司水费"]),o.D4="1-"+s+"月份",o.D7="1-"+s+"月份",o.D16=t.user,o.D21=o.date,o.items=r,e.abrupt("return",C("qingdan1","Sheet1",o));case 15:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),g=r(12),T=r(1),F=r(8),C=r(27).toExcel;e.exports.AllowanceToExcel=s;var q={"无":"全部单位","收":"已收水贴费单位","免":"免水贴费单位","欠":"欠水贴费单位","管":"交管委会单位"};e.exports.queryAllowance=c,e.exports.queryFixWatch=p,e.exports.queryRation=f,e.exports.queryContract=y,e.exports.queryCountShiZheng=m,e.exports.CountShiZhengToExcel=x,e.exports.queryCountAll=b,e.exports.CountAllToExcel=S},function(e,t,r){"use strict";var n=r(0).Router(),a=r(211),u=a.queryAllBank,s=a.queryCollection,o=a.queryCollectionTable,c=a.createCollection,i=a.CollectionToExcel,p=a.SaveToBankOfferTxt,l=a.queryUser,f=a.SaveToUserOfferTxt,d=a.queryBatch,y=a.XinFengHuiZongToExcel,h=a.XinFengToExcel,m=a.inputDisk,v=a.OutputDetailToExcel,x=a.queryCollectionCount,w=a.createCollectionCount,b=a.OutputCountToExcel,E=a.queryBank,S=a.createBank,k=a.deleteBank,g=a.updateBank,T=a.SaveToBankOfferExcel,F=a.SaveToUserOfferExcel;n.get("/bank",u),n.post("/collection",s),n.post("/collectiontable",o),n.put("/collection",c),n.post("/collection/excel",i),n.post("/collection/txt",p),n.post("/collection/bank/excel",T),n.post("/user",l),n.post("/user/txt",f),n.post("/user/excel",F),n.get("/batch/:date",d),n.post("/xinfenghuizong/excel",y),n.post("/xinfeng/excel",h),n.post("/detail/excel",v),n.get("/count/:date",x),n.put("/count",w),n.post("/count/excel",b),n.put("/disk",m),n.get("/banks",E),n.put("/banks",S),n.delete("/banks/:num",k),n.post("/banks",g),e.exports=n},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var a=n(r(212)),u=n(r(47)),s=n(r(3)),o=n(r(4)),c=function(){var e=(0,o.default)(s.default.mark(function e(t,r){var n;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,i();case 3:n=e.sent,ne.ResourceFound(r,n),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),ne.InternalServerError(r,e.t0,{});case 10:case"end":return e.stop()}},e,this,[[0,7]])}));return function(t,r){return e.apply(this,arguments)}}(),i=function(){var e=(0,o.default)(s.default.mark(function e(){var t,r;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t="\n    SELECT  distinct 银行代码,银行名称 from 水费字典银行查询 order by 银行代码\n    ",e.next=3,ae.query(t,{replacements:{},type:ae.QueryTypes.SELECT});case 3:return r=e.sent,e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),p=function(){var e=(0,o.default)(s.default.mark(function e(t,r){var n,a;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,l(n);case 4:a=e.sent,ne.ResourceFound(r,a),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),ne.InternalServerError(r,e.t0,{});case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),l=function(){var e=(0,o.default)(s.default.mark(function e(t){var r,n,a,u;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.date.slice(0,4),n=t.date.slice(4),a="\n    SELECT  * from 水费托收查询 where 年=:year and 月=:month "+(t.recount?"and 托收批次<1":"")+"\n    ",e.next=5,ae.query(a,{replacements:{year:r,month:n},type:ae.QueryTypes.SELECT});case 5:return u=e.sent,e.abrupt("return",u);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),f=function(){var e=(0,o.default)(s.default.mark(function e(t,r){var n,a;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,d(n);case 4:a=e.sent,ne.ResourceFound(r,a),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),ne.InternalServerError(r,e.t0,{});case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),d=function(){var e=(0,o.default)(s.default.mark(function e(t){var r,n,a,u;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.date.slice(0,4),n=t.date.slice(4),a="\n    SELECT  * from 水费托收表 where 年=:year and 月=:month "+(t.recount?"and 托收批次<1":"")+"\n    ",e.next=5,ae.query(a,{replacements:{year:r,month:n},type:ae.QueryTypes.SELECT});case 5:return u=e.sent,e.abrupt("return",u);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),y=function(){var e=(0,o.default)(s.default.mark(function e(t,r){var n,a;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,h(n);case 4:a=e.sent,ne.ResourceFound(r,a),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),ne.InternalServerError(r,e.t0,{});case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),h=function(){var e=(0,o.default)(s.default.mark(function e(t){var r,n,a,u,o,c,i,p,f,d;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.date.slice(0,4),n=t.date.slice(4),a=void 0,u=void 0,o=void 0,c=void 0,i=void 0,void 0,void 0,p=void 0,u="\n    delete from 水费托收表 where 年=:year and 月=:month\n    ",e.next=7,ae.query(u,{replacements:{year:r,month:n},type:ae.QueryTypes.DELETE});case 7:return c="\n    Insert into 水费托收表 (年,月,编号,应收水费)\n        SELECT A.年,A.月,B.扣水单位编号,sum(A.实收水费) FROM  水费单位信息 B INNER JOIN  水费基本表 A ON B.编号 = A.编号 where A.年=:year and A.月=:month AND B.收费形式编号='1'\n        group by  A.年,A.月,B.扣水单位编号     \n    ",e.next=10,ae.query(c,{replacements:{year:r,month:n},type:ae.QueryTypes.INSERT});case 10:return a="\n    SELECT  编号 from 水费托收表 where 年=:year and 月=:month order by 编号\n    ",e.next=13,ae.query(a,{replacements:{year:r,month:n},type:ae.QueryTypes.SELECT});case 13:i=e.sent,f=0;case 15:if(!(f<i.length)){e.next=30;break}return d=i[f],p=t.date+" 编号 ",a="\n        select 编号,本月表底,用水量,实收水费 From 水费报表查询 where 收费形式编号='1' and 扣水单位编号=:num and 年=:year and 月=:month\n        ",e.next=21,ae.query(a,{replacements:{num:d.编号,year:r,month:n},type:ae.QueryTypes.SELECT});case 21:return e.sent.forEach(function(e){p=p+e.编号+" "}),p.length>60&&(p=p.slice(0,55)+" 水费"),o="\n        update 水费托收表 set 备注=:temp where 编号=:num and 年=:year and 月=:month \n        ",e.next=27,ae.query(o,{replacements:{num:d.编号,temp:p,year:r,month:n},type:ae.QueryTypes.UPDATE});case 27:f++,e.next=15;break;case 30:return e.next=32,l(t);case 32:return e.abrupt("return",e.sent);case 33:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),m=function(){var e=(0,o.default)(s.default.mark(function e(t,r){var n,a;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,v(n);case 4:a=e.sent,r.writeHead(200,[["Content-Type","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"]]),r.end(new Buffer(a,"base64")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),ne.InternalServerError(r,e.t0,{});case 12:case"end":return e.stop()}},e,this,[[1,9]])}));return function(t,r){return e.apply(this,arguments)}}(),v=function(){var e=(0,o.default)(s.default.mark(function e(t){var r,n,a,u,o;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=void 0,void 0,n=t.date.slice(0,4),a=t.date.slice(4),t.recount=!1,u={year:n,month:a,date:re(new Date,"yyyy-mm-dd"),user:t.user},e.next=7,l(t);case 7:return r=e.sent,(o=r.length)>0&&r.push({"编号":"合计","户名":o+"户","应收水费":"=SUM(D4:D"+(o+3)+")"}),u.items=r,e.abrupt("return",se("TuoShou","Sheet1",u));case 12:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),x=function(){var e=(0,o.default)(s.default.mark(function e(t,r){var n,a;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,w(n);case 4:a=e.sent,r.writeHead(200,[["Content-Type","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"]]),r.end(new Buffer(a,"base64")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),ne.InternalServerError(r,e.t0.message,{});case 12:case"end":return e.stop()}},e,this,[[1,9]])}));return function(t,r){return e.apply(this,arguments)}}(),w=function(){var e=(0,o.default)(s.default.mark(function e(t){var r,n,a,u,o,c,i,p;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return void 0,void 0,r=void 0,void 0,void 0,void 0,n=void 0,a=void 0,u=t.date.slice(0,4),o=t.date.slice(4),c=void 0,void 0,void 0,void 0,a=t.banks.map(function(e){return"'"+e+"'"}).join(","),c="\n    SELECT  编号  from 水费托收查询 where 年=:year and 月=:month\n        and   托收批次<1  and 银行代码 IN ("+a+")\n    ",e.next=9,ae.query(c,{replacements:{year:u,month:o,bank:a},type:ae.QueryTypes.SELECT});case 9:return r=e.sent,n="",r.forEach(function(e){n=n+"'"+e.编号+"',"}),n=ie(n,2,pe(n)-3),c="\n    SELECT max(托收批次) as a from 水费托收查询 where 年=:year and 月=:month\n    ",e.next=16,ae.query(c,{replacements:{year:u,month:o},type:ae.QueryTypes.SELECT});case 16:return r=e.sent,parseInt(r[0].a)+1,c="\n    SELECT  编号,业务种类,银行代码,开户行行号,开户行行名,帐号,户名,帐户地址,应收水费,组织代码,协议书号,备注  from 水费托收查询 where 年=:year and 月=:month\n        and   托收批次<1  and 银行代码 IN ("+a+")\n        order by 编号        \n    ",e.next=21,ae.query(c,{replacements:{year:u,month:o,bank:a},type:ae.QueryTypes.SELECT});case 21:if(0!==(r=e.sent).length){e.next=24;break}throw new Error("当月水费已经全部托收，请重新检查");case 24:for(i={},r.forEach(function(e){return e.行别="1"}),p=0;p<150;p++)p<r.length?(i["户名"+(p+1)]=r[p].户名,i["帐号"+(p+1)]=r[p].帐号,i["行别"+(p+1)]=r[p].行别,i["开户行行号"+(p+1)]=r[p].开户行行号,i["业务种类"+(p+1)]=r[p].业务种类?r[p].业务种类:"00201",i["协议书号"+(p+1)]=r[p].协议书号,i["帐户地址"+(p+1)]=r[p].帐户地址,i["应收水费"+(p+1)]=r[p].应收水费,i["备注"+(p+1)]=r[p].备注):(i["户名"+(p+1)]="",i["帐号"+(p+1)]="",i["行别"+(p+1)]="",i["开户行行号"+(p+1)]="",i["业务种类"+(p+1)]="",i["协议书号"+(p+1)]="",i["帐户地址"+(p+1)]="",i["应收水费"+(p+1)]="",i["备注"+(p+1)]="");return e.abrupt("return",se("bankoffer","工行跨行",i));case 28:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),b=function(){var e=(0,o.default)(s.default.mark(function e(t,r){var n,a;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,E(n);case 4:a=e.sent,r.setHeader("Content-type","application/octet-stream"),r.setHeader("Content-disposition","attachment; filename="+a.name),r.charset="UTF-8",r.send(a.data),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),ne.InternalServerError(r,e.t0.message,{});case 14:case"end":return e.stop()}},e,this,[[1,11]])}));return function(t,r){return e.apply(this,arguments)}}(),E=function(){var e=(0,o.default)(s.default.mark(function e(t){var r,n,a,u,o,c,i,p,l,f,d,y,h,m,v;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=void 0,n=void 0,a=void 0,u=void 0,o=void 0,c=void 0,i=void 0,p=void 0,l=t.date.slice(0,4),f=t.date.slice(4),d=void 0,void 0,y=void 0,void 0,p=t.banks.map(function(e){return"'"+e+"'"}).join(","),d="\n    SELECT  编号  from 水费托收查询 where 年=:year and 月=:month\n        and   托收批次<1  and 银行代码 IN ("+p+")\n    ",e.next=9,ae.query(d,{replacements:{year:l,month:f,bank:p},type:ae.QueryTypes.SELECT});case 9:return a=e.sent,i="",a.forEach(function(e){i=i+"'"+e.编号+"',"}),i=ie(i,2,pe(i)-3),d="\n    SELECT max(托收批次) as a from 水费托收查询 where 年=:year and 月=:month\n    ",e.next=16,ae.query(d,{replacements:{year:l,month:f},type:ae.QueryTypes.SELECT});case 16:return a=e.sent,n=parseInt(a[0].a)+1,d="\n    SELECT  编号,业务种类,银行代码,开户行行号,开户行行名,帐号,户名,帐户地址,应收水费,组织代码,协议书号,备注  from 水费托收查询 where 年=:year and 月=:month\n        and   托收批次<1  and 银行代码 IN ("+p+")\n        order by 编号        \n    ",e.next=21,ae.query(d,{replacements:{year:l,month:f,bank:p},type:ae.QueryTypes.SELECT});case 21:if(0!==(a=e.sent).length){e.next=24;break}throw new Error("当月水费已经全部托收，请重新检查");case 24:return r=1,o="",a.forEach(function(e){o=(o=(o=(o=(o=(o=(o=o+"2"+ie("0000000",1,8-pe(le(r)))+le(r)+"00114")+e["业务种类"].toString()+ie("            ",1,12-pe(e["业务种类"].toString())))+e["银行代码"].toString()+e["开户行行号"].toString()+e["开户行行号"].toString())+e["开户行行名"].toString()+ie("                                                            ",1,60-pe(e["开户行行名"].toString())))+e["帐号"].toString()+ie("                                ",1,32-pe(e["帐号"].toString())))+e["户名"].toString()+ie("                                                            ",1,60-pe(e["户名"].toString())))+e["帐户地址"].toString()+ie("                                                            ",1,60-pe(e["帐户地址"].toString())),o+="00000001",c=parseFloat(e["应收水费"]).toFixed(2),o=(o=(o=o+ie("000000000000000",1,15-pe(c))+c)+e["组织代码"].toString()+ie("          ",1,10-pe(e["组织代码"].toString())))+e["编号"].toString()+ie("        ",1,8-pe(e["编号"].toString())),""===e["协议书号"].toString()?o+="000000":o=o+e["协议书号"].toString()+ie("                                                            ",1,60-pe(e["协议书号"].toString())),o=o+e["备注"].toString()+ie("                                                            ",1,60-pe(e["备注"].toString())),o+="        00000000000000000000000000",o+="\r\n",r+=1}),h=o,d="\n    SELECT  Count(应收水费) as a ,sum(应收水费) as b   from 水费托收查询 where 年=:year and 月=:month\n        and   托收批次<1  and 银行代码 IN ("+p+")\n    ",e.next=31,ae.query(d,{replacements:{year:l,month:f,bank:p},type:ae.QueryTypes.SELECT});case 31:return a=e.sent,c=a[0].a.toString(),o=ie("00000000",1,8-pe(c))+c,c=parseFloat(a[0].b).toFixed(2),o=o+ie("000000000000000",1,15-pe(c))+c,c=o,d="\n    SELECT  银行代码,业务种类,开户行行号,开户行行名,帐号,户名,帐户地址,组织代码,协议书号  from 水费单位信息 where 编号='0000'\n    ",e.next=40,ae.query(d,{replacements:{year:l,month:f,bank:p},type:ae.QueryTypes.SELECT});case 40:return a=e.sent,u=a[0],o="10000000000114",o=o+(u["业务种类"]?u["业务种类"]:"")+ie("            ",1,12-pe(u["业务种类"])),o=o+u["银行代码"].toString()+u["开户行行号"].toString()+u["开户行行号"].toString(),o=o+u["开户行行名"].toString()+ie("                                                            ",1,60-pe(u["开户行行名"].toString())),o=o+u["帐号"].toString()+ie("                                ",1,32-pe(u["帐号"].toString())),o=o+u["户名"].toString()+ie("                                                            ",1,60-pe(u["户名"].toString())),o=o+u["帐户地址"].toString()+ie("                                                            ",1,60-pe(u["帐户地址"].toString())),o+=c,o=o+u["组织代码"].toString()+ie("          ",1,10-pe(u["组织代码"].toString())),o+=ie("        ",1,8),o+="                                                            ",o+="                                                            ",o+="        00000000000000000000000000",y="\n    update  水费托收表 Set 托收批次="+le(n)+",托收日期=:date\n        where 年=:year and 月=:month\n        and   托收批次<1  and 编号 IN ('"+i+"') \n    ",e.next=58,ae.query(y,{replacements:{year:l,month:f,date:re(new Date,"yyyy-mm-dd")},type:ae.QueryTypes.UPDATE});case 58:return m=re(new Date,"yyyy-mm-dd"),v=ie(m,1,4)+ie(m,6,2)+ie(m,9,2),v="SBJJDR92"+v+ie("000",1,3-pe(le(n)))+le(n)+".txt",e.abrupt("return",{data:h+o,name:v});case 62:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),S=function(){var e=(0,o.default)(s.default.mark(function e(t,r){var n,a;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,k(n);case 4:a=e.sent,ne.ResourceFound(r,a),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),ne.InternalServerError(r,e.t0,{});case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),k=function(){var e=(0,o.default)(s.default.mark(function e(t){var r,n,a,u;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.date.slice(0,4),n=t.date.slice(4),a="\n    SELECT  编号,户名 from 水费托收查询 where 年=:year and 月=:month "+(t.recount?"and 托收批次<1":"")+"\n    ",e.next=5,ae.query(a,{replacements:{year:r,month:n},type:ae.QueryTypes.SELECT});case 5:return u=e.sent,e.abrupt("return",u);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),g=function(){var e=(0,o.default)(s.default.mark(function e(t,r){var n,a;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,T(n);case 4:a=e.sent,r.writeHead(200,[["Content-Type","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"]]),r.end(new Buffer(a,"base64")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),ne.InternalServerError(r,e.t0.message,{});case 12:case"end":return e.stop()}},e,this,[[1,9]])}));return function(t,r){return e.apply(this,arguments)}}(),T=function(){var e=(0,o.default)(s.default.mark(function e(t){var r,n,a,u,o,c;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return void 0,void 0,r=void 0,void 0,void 0,void 0,n=void 0,void 0,a=t.date.slice(0,4),u=t.date.slice(4),o=void 0,void 0,void 0,void 0,n=t.users.map(function(e){return"'"+e+"'"}).join(","),o="\n    SELECT max(托收批次) as a from 水费托收查询 where 年=:year and 月=:month\n    ",e.next=9,ae.query(o,{replacements:{year:a,month:u},type:ae.QueryTypes.SELECT});case 9:return r=e.sent,parseInt(r[0].a)+1,o="\n    SELECT  编号,业务种类,银行代码,开户行行号,开户行行名,帐号,户名,帐户地址,应收水费,组织代码,协议书号,备注  from 水费托收查询 where 年=:year and 月=:month\n        and   托收批次<1  and 编号 IN ("+n+")\n        order by 编号        \n    ",e.next=14,ae.query(o,{replacements:{year:a,month:u},type:ae.QueryTypes.SELECT});case 14:if(0!==(r=e.sent).length){e.next=17;break}throw new Error("当月水费已经全部托收，请重新检查");case 17:return c={},r.forEach(function(e){return e.行别="1"}),c.items=r,e.abrupt("return",se("bankoffer","工行跨行",c));case 21:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),F=function(){var e=(0,o.default)(s.default.mark(function e(t,r){var n,a;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,C(n);case 4:a=e.sent,r.setHeader("Content-type","application/octet-stream"),r.setHeader("Content-disposition","attachment; filename="+a.name),r.charset="UTF-8",r.send(a.data),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),ne.InternalServerError(r,e.t0.message,{});case 14:case"end":return e.stop()}},e,this,[[1,11]])}));return function(t,r){return e.apply(this,arguments)}}(),C=function(){var e=(0,o.default)(s.default.mark(function e(t){var r,n,a,u,o,c,i,p,l,f,d,y,h,m,v;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=void 0,n=void 0,a=void 0,u=void 0,o=void 0,c=void 0,i=void 0,p=void 0,l=t.date.slice(0,4),f=t.date.slice(4),d=void 0,void 0,y=void 0,void 0,i=t.users.map(function(e){return"'"+e+"'"}).join(","),d="\n    SELECT max(托收批次) as a from 水费托收查询 where 年=:year and 月=:month\n    ",e.next=9,ae.query(d,{replacements:{year:l,month:f},type:ae.QueryTypes.SELECT});case 9:return a=e.sent,n=parseInt(a[0].a)+1,d="\n    SELECT  编号,业务种类,银行代码,开户行行号,开户行行名,帐号,户名,帐户地址,应收水费,组织代码,协议书号,备注  from 水费托收查询 where 年=:year and 月=:month\n        and   托收批次<1  and 编号 IN ("+i+")\n        order by 编号        \n    ",e.next=14,ae.query(d,{replacements:{year:l,month:f},type:ae.QueryTypes.SELECT});case 14:if(0!==(a=e.sent).length){e.next=17;break}throw new Error("当月水费已经全部托收，请重新检查");case 17:return p="",r=1,o="",a.forEach(function(e){o=o+"2"+ie("0000000",1,8-pe(le(r)))+le(r)+"00114",""===e["协议书号"].toString()?o+="00600       ":o=o+e["业务种类"].toString()+ie("            ",1,12-pe(e["业务种类"].toString())),o=(o=(o=(o=(o=o+e["银行代码"].toString()+e["开户行行号"].toString()+e["开户行行号"].toString())+e["开户行行名"].toString()+ie("                                                            ",1,60-pe(e["开户行行名"].toString())))+e["帐号"].toString()+ie("                                ",1,32-pe(e["帐号"].toString())))+e["户名"].toString()+ie("                                                            ",1,60-pe(e["户名"].toString())))+e["帐户地址"].toString()+ie("                                                            ",1,60-pe(e["帐户地址"].toString())),o+="00000001",c=parseFloat(e["应收水费"]).toFixed(2),o=(o=(o=o+ie("000000000000000",1,15-pe(c))+c)+e["组织代码"].toString()+ie("          ",1,10-pe(e["组织代码"].toString())))+e["编号"].toString()+ie("        ",1,8-pe(e["编号"].toString())),""===e["协议书号"].toString()?o+="000000":o=o+e["协议书号"].toString()+ie("                                                            ",1,60-pe(e["协议书号"].toString())),o=o+e["备注"].toString()+ie("                                                            ",1,60-pe(e["备注"].toString())),o+="        00000000000000000000000000",o+="\r\n",r+=1,p=p+"'"+e["编号"]+"',"}),p=ie(p,2,pe(p)-3),h=o,d="\n    SELECT  Count(应收水费) as a ,sum(应收水费) as b   from 水费托收查询 where 年=:year and 月=:month\n        and   托收批次<1  and 编号 IN ("+i+")\n    ",e.next=26,ae.query(d,{replacements:{year:l,month:f},type:ae.QueryTypes.SELECT});case 26:return a=e.sent,c=a[0].a.toString(),o=ie("00000000",1,8-pe(c))+c,c=parseFloat(a[0].b).toFixed(2),o=o+ie("000000000000000",1,15-pe(c))+c,c=o,d="\n    SELECT  银行代码,业务种类,开户行行号,开户行行名,帐号,户名,帐户地址,组织代码,协议书号  from 水费单位信息 where 编号='0000'\n    ",e.next=35,ae.query(d,{replacements:{year:l,month:f},type:ae.QueryTypes.SELECT});case 35:return a=e.sent,u=a[0],o="10000000000114",o=o+(u["业务种类"]?u["业务种类"]:"")+ie("            ",1,12-pe(u["业务种类"])),o=o+u["银行代码"].toString()+u["开户行行号"].toString()+u["开户行行号"].toString(),o=o+u["开户行行名"].toString()+ie("                                                            ",1,60-pe(u["开户行行名"].toString())),o=o+u["帐号"].toString()+ie("                                ",1,32-pe(u["帐号"].toString())),o=o+u["户名"].toString()+ie("                                                            ",1,60-pe(u["户名"].toString())),o=o+u["帐户地址"].toString()+ie("                                                            ",1,60-pe(u["帐户地址"].toString())),o+=c,o=o+u["组织代码"].toString()+ie("          ",1,10-pe(u["组织代码"].toString())),o+=ie("        ",1,8),o+="                                                            ",o+="                                                            ",o+="        00000000000000000000000000",y="\n    update  水费托收表 Set 托收批次="+le(n)+",托收日期=:date\n        where 年=:year and 月=:month\n        and   托收批次<1  and 编号 IN ('"+p+"') \n    ",e.next=53,ae.query(y,{replacements:{year:l,month:f,date:re(new Date,"yyyy-mm-dd")},type:ae.QueryTypes.UPDATE});case 53:return m=re(new Date,"yyyy-mm-dd"),v=ie(m,1,4)+ie(m,6,2)+ie(m,9,2),v="SBJJDR92"+v+ie("000",1,3-pe(le(n)))+le(n)+".txt",e.abrupt("return",{data:h+o,name:v});case 57:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),q=function(){var e=(0,o.default)(s.default.mark(function e(t,r){var n,a;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.date,e.prev=1,e.next=4,I(n);case 4:a=e.sent,ne.ResourceFound(r,a),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),ne.InternalServerError(r,e.t0,{});case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),I=function(){var e=(0,o.default)(s.default.mark(function e(t){var r,n,a,u;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.slice(0,4),n=t.slice(4),a="\n    SELECT  distinct 托收批次 from 水费托收查询 where 年=:year and 月=:month and 托收批次>=0\n    ",e.next=5,ae.query(a,{replacements:{year:r,month:n},type:ae.QueryTypes.SELECT});case 5:return u=e.sent,e.abrupt("return",u);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),A=function(){var e=(0,o.default)(s.default.mark(function e(t,r){var n,a;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,L(n);case 4:a=e.sent,r.writeHead(200,[["Content-Type","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"]]),r.end(new Buffer(a,"base64")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),ne.InternalServerError(r,e.t0.message,{});case 12:case"end":return e.stop()}},e,this,[[1,9]])}));return function(t,r){return e.apply(this,arguments)}}(),L=function(){var e=(0,o.default)(s.default.mark(function e(t){var r,n,a,u,o,c,i;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=void 0,void 0,n=void 0,a=void 0,u=t.date.slice(0,4),o=t.date.slice(4),t.recount=!1,c={},i="\n    SELECT  count(应收水费) as 信件数量 from 水费托收查询  where 年=:year and 月=:month "+(t.batch.length>0?"and 托收批次="+t.batch:"")+"\n    ",e.next=8,ae.query(i,{replacements:{year:u,month:o},type:ae.QueryTypes.SELECT});case 8:return r=e.sent,a=parseInt(r[0].信件数量),i="\n    SELECT  开户行行名,count(应收水费) as 信件数量 from 水费托收查询\n        where 年=:year and 月=:month "+(t.batch.length>0?"and 托收批次="+t.batch:"")+"\n        group by  开户行行名\n    ",e.next=13,ae.query(i,{replacements:{year:u,month:o},type:ae.QueryTypes.SELECT});case 13:if(0!==(r=e.sent).length){e.next=16;break}throw new Error("该月托收水费不存在,请重新选择!");case 16:return c.A2="    提出行：中国工商银行天保支行        "+re(new Date,"yyyy-mm-dd")+"          提出场次：  "+t.batch,c.D22=a.toString(),n=4,r.forEach(function(e){n<23?(c["A"+le(n)]=e["开户行行名"],c["B"+le(n)]=e["信件数量"],n+=1):(c["C"+le(n-19)]=e["开户行行名"],c["D"+le(n-19)]=e["信件数量"],n+=1)}),e.abrupt("return",se("XinFengHuiZong","Sheet1",c));case 21:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),R=function(){var e=(0,o.default)(s.default.mark(function e(t,r){var n,a;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,_(n);case 4:a=e.sent,r.writeHead(200,[["Content-Type","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"]]),r.end(new Buffer(a,"base64")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),ne.InternalServerError(r,e.t0.message,{});case 12:case"end":return e.stop()}},e,this,[[1,9]])}));return function(t,r){return e.apply(this,arguments)}}(),_=function(){var e=(0,o.default)(s.default.mark(function e(t){var r,n,o,c,i,p,l,f;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=function(){for(var e={},t=0;t<20;t++)e["Sheet"+(t+1)]={B2:"",E5:"",B16:"",E19:""};return e}(),n=void 0,void 0,o=void 0,void 0,c=t.date.slice(0,4),i=t.date.slice(4),t.recount=!1,{},p="\n    SELECT  count(distinct 开户行行名) as 银行个数 from  水费托收查询  where 年=:year and 月=:month "+(t.batch.length>0?"and 托收批次="+t.batch:"")+"\n    ",e.next=9,ae.query(p,{replacements:{year:c,month:i},type:ae.QueryTypes.SELECT});case 9:return n=e.sent,parseInt(n[0].银行个数),p="\n    SELECT  开户行行名,count(应收水费) as 信件数量 from 水费托收查询\n        where 年=:year and 月=:month "+(t.batch.length>0?"and 托收批次="+t.batch:"")+"\n        group by  开户行行名\n    ",e.next=14,ae.query(p,{replacements:{year:c,month:i},type:ae.QueryTypes.SELECT});case 14:if(0!==(n=e.sent).length){e.next=17;break}throw new Error("该月托收水费不存在,请重新选择!");case 17:for(o=2,l=0;l<n.length;)f="Sheet"+Math.floor(o/2),r[f].B2=n[l].开户行行名,r[f].E5=n[l].信件数量,o+=1,(l+=1)<n.length&&(r[f].B16=n[l].开户行行名,r[f].E19=n[l].信件数量,o+=1,l+=1);return e.abrupt("return",oe("XinFeng",(0,u.default)(r),(0,a.default)(r)));case 21:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),Q=function(){var e=(0,o.default)(s.default.mark(function e(t,r){var n,a;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,N(n);case 4:a=e.sent,ne.ResourceFound(r,a),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),ne.InternalServerError(r,e.t0.message,{});case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),N=function(){var e=(0,o.default)(s.default.mark(function e(t){var r,n,a,u,o,c,i,p,l,f,d,y;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.date.slice(0,4),n=t.date.slice(4),void 0,void 0,a=void 0,void 0,e.next=5,he(ee.join("./","uploadfiles",t.name));case 5:u=e.sent,o=te.decode(u,"gbk"),o.toString().split("\n"),c=void 0,i=void 0,p=void 0,l=void 0,f=void 0,d=[],y=0;case 11:if(!(y<u.length-1)){e.next=35;break}if(10===u[y]){e.next=16;break}d.push(u[y]),e.next=32;break;case 16:if(c=ie(d,427,8),c=te.decode(c,"gbk"),c=""!==fe(c)?ie(c,1,4)+"-"+ie(c,5,2)+"-"+ie(c,7,2):"",i=ie(d,435,8),i=fe(te.decode(i,"gbk")),p=ie(d,443,15),p=fe(te.decode(p,"gbk")),l=ie(d,458,3),l=fe(te.decode(l,"gbk")),f=ie(d,299,4),!((f=fe(te.decode(f,"gbk"))).length>0)){e.next=31;break}return a="\n                update 水费托收表 set 托收批次=:a1,回盘日期=:a2,回盘金额=:a3,处理标识代码=:a4 where 编号=:a5 and (年=:year) and (月=:month)\n                ",e.next=31,ae.query(a,{replacements:{a1:"001"!==l?0-de(t.batch):de(t.batch),a2:""!==fe(c)?c:"",a3:ye(p),a4:l,a5:f,year:r,month:n},type:ae.QueryTypes.UPDATE});case 31:d=[];case 32:y++,e.next=11;break;case 35:return e.abrupt("return",{});case 36:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),D=function(){var e=(0,o.default)(s.default.mark(function e(t,r){var n,a;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,M(n);case 4:a=e.sent,r.writeHead(200,[["Content-Type","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"]]),r.end(new Buffer(a,"base64")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),ne.InternalServerError(r,e.t0.message,{});case 12:case"end":return e.stop()}},e,this,[[1,9]])}));return function(t,r){return e.apply(this,arguments)}}(),M=function(){var e=(0,o.default)(s.default.mark(function e(t){var r,n,a,u,o,c,i;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=void 0,n=void 0,a=t.date.slice(0,4),u=t.date.slice(4),o={year:a,month:u},c="\n    SELECT  * from 水费托收查询 where 年=:year and 月=:month \n        "+(t.bank.length>0?" and 银行代码="+ie(t.bank,1,3)+" ":"")+"\n        "+(t.batch.length>0?" and ABS(托收批次)="+t.batch+" ":"")+"\n        "+("2"===t.kind?" and 托收批次 >0 ":"")+"\n        "+("3"===t.kind?" and  托收批次 <0 ":"")+"\n        order by  托收批次,开户行行号,帐号\n    ",e.next=7,ae.query(c,{replacements:{year:a,month:u},type:ae.QueryTypes.SELECT});case 7:return r=e.sent,n="",t.bank.length>0&&(n=t.bank+" - "),t.batch.length>0&&(n=n+"第"+t.batch+"批次 - "),"1"===t.kind&&(n+="全部"),"2"===t.kind&&(n+="托收成功"),"3"===t.kind&&(n+="托收失败"),o.B2=n,(i=r.length)>0&&r.push({"托收批次":"合计","户名":i+"个用户","应收水费":"=SUM(G4:G"+(i+3)+")"}),o.items=r,e.abrupt("return",se("TuoShouMingXi","Sheet1",o));case 19:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),U=function(){var e=(0,o.default)(s.default.mark(function e(t,r){var n,a;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.date,e.prev=1,e.next=4,O(n);case 4:a=e.sent,ne.ResourceFound(r,a),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),ne.InternalServerError(r,e.t0,{});case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),O=function(){var e=(0,o.default)(s.default.mark(function e(t){var r,n,a,u;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.slice(0,4),n=t.slice(4),a="\n    SELECT  * from 水费托收统计 where 年=:year and 月=:month\n    ",e.next=5,ae.query(a,{replacements:{year:r,month:n},type:ae.QueryTypes.SELECT});case 5:return u=e.sent,e.abrupt("return",u);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),j=function(){var e=(0,o.default)(s.default.mark(function e(t,r){var n,a;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,B(n);case 4:a=e.sent,ne.ResourceFound(r,a),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),ne.InternalServerError(r,e.t0,{});case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),B=function(){var e=(0,o.default)(s.default.mark(function e(t){var r,n,a,u,o,c,i,p,l,f,d,y;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.date.slice(0,4),n=t.date.slice(4),a=void 0,u=void 0,o=void 0,c=void 0,i=void 0,p=void 0,void 0,void 0,l=void 0,f=void 0,u="\n    delete from 水费托收统计 where 年=:year and 月=:month\n    ",e.next=7,ae.query(u,{replacements:{year:r,month:n},type:ae.QueryTypes.DELETE});case 7:return c="\n    Insert into 水费托收统计 (年,月,托收批次,托收笔数,托收金额)\n        SELECT 年,月,ABS(托收批次),COUNT(应收水费), SUM(应收水费) FROM 水费托收表 \n        WHERE (年 =:year) AND (月 = :month)  \n        GROUP BY 年,月,ABS(托收批次)     \n    ",e.next=10,ae.query(c,{replacements:{year:r,month:n},type:ae.QueryTypes.INSERT});case 10:return a="\n    SELECT  托收批次 from 水费托收统计 where 年=:year and 月=:month and 托收批次>0  order by 托收批次\n    ",e.next=13,ae.query(a,{replacements:{year:r,month:n},type:ae.QueryTypes.SELECT});case 13:i=e.sent,d=0;case 15:if(!(d<i.length)){e.next=31;break}return y=i[d],a="\n        select COUNT(应收水费) as a1, SUM(应收水费) as a2 FROM 水费托收表 WHERE (年 =:year) AND (月 = :month) \n            And 托收批次=:batch  \n        ",e.next=20,ae.query(a,{replacements:{year:r,month:n,batch:y.托收批次},type:ae.QueryTypes.SELECT});case 20:return(p=e.sent).length>0?(l=p[0].a1,f=p[0].a2):(l="0",f="0"),o="\n        update 水费托收统计 set 成功笔数="+l+",成功金额="+f+"\n            where  年=:year and 月=:month\n            and 托收批次='"+y.托收批次+"'\n        ",e.next=25,ae.query(o,{replacements:{year:r,month:n},type:ae.QueryTypes.UPDATE});case 25:return o="\n        update 水费托收统计 set 失败笔数=托收笔数-成功笔数,失败金额=托收金额-成功金额\n            where  年=:year and 月=:month\n            and 托收批次='"+y.托收批次+"'\n        ",e.next=28,ae.query(o,{replacements:{year:r,month:n},type:ae.QueryTypes.UPDATE});case 28:d++,e.next=15;break;case 31:return e.next=33,O(t.date);case 33:return e.abrupt("return",e.sent);case 34:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),P=function(){var e=(0,o.default)(s.default.mark(function e(t,r){var n,a;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,H(n);case 4:a=e.sent,r.writeHead(200,[["Content-Type","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"]]),r.end(new Buffer(a,"base64")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),ne.InternalServerError(r,e.t0.message,{});case 12:case"end":return e.stop()}},e,this,[[1,9]])}));return function(t,r){return e.apply(this,arguments)}}(),H=function(){var e=(0,o.default)(s.default.mark(function e(t){var r,n,a,u,o;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=void 0,n=t.date.slice(0,4),a=t.date.slice(4),u={year:n,month:a,date:re(new Date,"yyyy-mm-dd")},e.next=6,O(t.date);case 6:return r=e.sent,(o=r.length)>0&&r.push({"托收批次":"合计","托收笔数":"=SUM(B4:B"+(o+3)+")","托收金额":"=SUM(C4:C"+(o+3)+")","成功笔数":"=SUM(D4:D"+(o+3)+")","成功金额":"=SUM(E4:E"+(o+3)+")","失败笔数":"=SUM(F4:F"+(o+3)+")","失败金额":"=SUM(G4:G"+(o+3)+")"}),u.items=r,e.abrupt("return",se("TuoShouTongJi","Sheet1",u));case 11:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),W=function(){var e=(0,o.default)(s.default.mark(function e(t,r){var n;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,z();case 3:n=e.sent,ne.ResourceFound(r,n),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),ne.InternalServerError(r,e.t0,{});case 10:case"end":return e.stop()}},e,this,[[0,7]])}));return function(t,r){return e.apply(this,arguments)}}(),z=function(){var e=(0,o.default)(s.default.mark(function e(){var t,r;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t="\n    Select *  from 水费字典银行查询 order by 开户行行号\n    ",e.next=3,ae.query(t,{replacements:{},type:ae.QueryTypes.SELECT});case 3:return r=e.sent,e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),G=function(){var e=(0,o.default)(s.default.mark(function e(t,r){var n,a;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,J(n);case 4:a=e.sent,ne.ResourceFound(r,a),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),ne.InternalServerError(r,e.t0,{});case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),J=function(){var e=(0,o.default)(s.default.mark(function e(t){var r,n,a;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r="\n    insert into 水费字典银行代码 (开户行行号,开户行行名,银行代码,使用次数,是否验证,帐号位数,帐号相同位数,帐号相同代码,帐号相同代码1,业务种类 ) \n        values( :a1,:a2,:a3,:a4,:a5,:a6,:a7,:a8,:a9,:a10)\n    ",n={a1:t.开户行行号,a2:t.开户行行名,a3:ie(t.开户行行号,1,3),a4:0},t.验证?(n.a5="Y",n.a6=t.帐号位数,n.a7=t.帐号相同位数):(n.a5="N",n.a6=0,n.a7=0),n.a8=t.账号相同代码,n.a9=t.账号相同代码1,n.a10=t.业务种类,e.next=8,ae.query(r,{replacements:n,type:ae.QueryTypes.INSERT});case 8:return a=e.sent,e.abrupt("return",a);case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),K=function(){var e=(0,o.default)(s.default.mark(function e(t,r){var n,a;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.num,e.prev=1,e.next=4,V(n);case 4:a=e.sent,ne.ResourceFound(r,a),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),ne.InternalServerError(r,e.t0,{});case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),V=function(){var e=(0,o.default)(s.default.mark(function e(t){var r,n;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r="\n    delete from 水费字典银行代码 where 开户行行号=:num\n    ",e.next=3,ae.query(r,{replacements:{num:t},type:ae.QueryTypes.DELETE});case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),Y=function(){var e=(0,o.default)(s.default.mark(function e(t,r){var n,a;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,Z(n);case 4:a=e.sent,ne.ResourceFound(r,a),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),ne.InternalServerError(r,e.t0,{});case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),Z=function(){var e=(0,o.default)(s.default.mark(function e(t){var r,n,a;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r="\n    Update 水费字典银行代码 set 开户行行名=:a2,银行代码=:a3,是否验证=:a5,帐号位数=:a6,帐号相同位数=:a7,帐号相同代码=:a8,帐号相同代码1=:a9,业务种类=:a10 where 开户行行号=:a1\n    ",n={a1:t.开户行行号,a2:t.开户行行名,a3:ie(t.开户行行号,1,3)},t.验证?(n.a5="Y",n.a6=t.帐号位数,n.a7=t.帐号相同位数):(n.a5="N",n.a6=0,n.a7=0),n.a8=t.帐号相同代码,n.a9=t.帐号相同代码1,n.a10=t.业务种类,e.next=8,ae.query(r,{replacements:n,type:ae.QueryTypes.UPDATE});case 8:return a=e.sent,e.abrupt("return",a);case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),$=(r(216),r(26)),X=r(217);r(218).shim();var ee=r(9),te=r(219),re=r(12),ne=r(1),ae=r(8),ue=r(27),se=ue.toExcel,oe=ue.toExcelMultiSheets,ce=r(220),ie=ce.copy,pe=ce.length,le=ce.inttostr,fe=ce.trim,de=ce.strtoint,ye=ce.strtoFloat,he=X.promisify($.readFile);e.exports.queryAllBank=c,e.exports.queryCollection=p,e.exports.queryCollectionTable=f,e.exports.createCollection=y,e.exports.CollectionToExcel=m,e.exports.SaveToBankOfferExcel=x,e.exports.SaveToBankOfferTxt=b,e.exports.queryUser=S,e.exports.SaveToUserOfferExcel=g,e.exports.SaveToUserOfferTxt=F,e.exports.queryBatch=q,e.exports.XinFengHuiZongToExcel=A,e.exports.XinFengToExcel=R,e.exports.inputDisk=Q,e.exports.OutputDetailToExcel=D,e.exports.queryCollectionCount=U,e.exports.createCollectionCount=j,e.exports.OutputCountToExcel=P,e.exports.queryBank=W,e.exports.createBank=G,e.exports.deleteBank=K,e.exports.updateBank=Y},function(e,t,r){e.exports={default:r(213),__esModule:!0}},function(e,t,r){r(214),e.exports=r(2).Object.values},function(e,t,r){var n=r(5),a=r(215)(!1);n(n.S,"Object",{values:function(e){return a(e)}})},function(e,t,r){var n=r(28),a=r(29),u=r(87).f;e.exports=function(e){return function(t){for(var r,s=a(t),o=n(s),c=o.length,i=0,p=[];c>i;)u.call(s,r=o[i++])&&p.push(e?[r,s[r]]:s[r]);return p}}},function(e,t){e.exports=require("os")},function(e,t){e.exports=require("util")},function(e,t){e.exports=require("util.promisify")},function(e,t){e.exports=require("iconv-lite")},function(e,t,r){"use strict";e.exports.copy=function(e,t,r){return e.slice(t-1,t+r-1)};e.exports.length=function(e){return e?function(e){for(var t=0,r=e.length,n=-1,a=0;a<r;a++)t+=(n=e.charCodeAt(a))>=0&&n<=128?1:2;return t}(e):0},e.exports.inttostr=function(e){return e.toString()},e.exports.strtoint=function(e){return parseInt(e)},e.exports.strtoFloat=function(e){return isNaN(e)?"0":parseFloat(e)},e.exports.trim=function(e){return e.trim()}},function(e,t,r){"use strict";var n=r(0).Router(),a=r(9),u=r(222),s=r(1);n.post("/",function(e,t,r){var n=new u.IncomingForm;n.uploadDir=a.join("./","uploadfiles"),n.keepExtensions=!0,n.parse(e,function(e,n,a){e&&r(e);var u=a.file.path.split("\\")[1];s.ResourceFound(t,{name:u})})}),e.exports=n},function(e,t){e.exports=require("formidable")},function(e,t,r){"use strict";var n=r(0).Router(),a=r(224),u=a.queryUseKind,s=a.createUpdateUseKind,o=a.deleteUseKind,c=a.queryChargeKind,i=a.createUpdateChargeKind,p=a.deleteChargeKind,l=a.queryInputKind,f=a.createUpdateInputKind,d=a.deleteInputKind,y=a.queryChargeStandard,h=a.createUpdateChargeStandard,m=a.deleteChargeStandard,v=a.queryFireStandard,x=a.createUpdateFireStandard,w=a.deleteFireStandard;n.get("/usekind",u),n.put("/usekind",s),n.delete("/usekind/:num",o),n.post("/usekind",s),n.get("/chargekind",c),n.put("/chargekind",i),n.delete("/chargekind/:num",p),n.post("/chargekind",i),n.get("/inputkind",l),n.put("/inputkind",f),n.delete("/inputkind/:num",d),n.post("/inputkind",f),n.get("/chargestandard",y),n.put("/chargestandard",h),n.delete("/chargestandard/:num",m),n.post("/chargestandard",h),n.get("/firestandard",v),n.put("/firestandard",x),n.delete("/firestandard/:num",w),n.post("/firestandard",x),e.exports=n},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var a=n(r(3)),u=n(r(4)),s=function(){var e=(0,u.default)(a.default.mark(function e(t,r){var n;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,o();case 3:n=e.sent,D.ResourceFound(r,n),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),D.InternalServerError(r,e.t0,{});case 10:case"end":return e.stop()}},e,this,[[0,7]])}));return function(t,r){return e.apply(this,arguments)}}(),o=function(){var e=(0,u.default)(a.default.mark(function e(){var t,r;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t="\n    Select * from 水费字典用水形式 order by 用水形式编号\n    ",e.next=3,M.query(t,{replacements:{},type:M.QueryTypes.SELECT});case 3:return r=e.sent,e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),c=function(){var e=(0,u.default)(a.default.mark(function e(t,r){var n,u;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,i(n);case 4:u=e.sent,D.ResourceFound(r,u),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),D.InternalServerError(r,e.t0,{});case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),i=function(){var e=(0,u.default)(a.default.mark(function e(t){var r,n,u,s,o,c;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=void 0,n=void 0,u="\n    Select *  from 水费字典用水形式   where 用水形式编号 =:num\n    ",e.next=4,M.query(u,{replacements:{num:t.用水形式编号},type:M.QueryTypes.SELECT});case 4:if(r=e.sent,s={a1:t.用水形式编号,a2:t.用水形式},0!==r.length){e.next=13;break}return o="\n        insert into 水费字典用水形式 (用水形式编号,用水形式) values(:a1,:a2)\n        ",e.next=10,M.query(o,{replacements:s,type:M.QueryTypes.INSERT});case 10:n=e.sent,e.next=17;break;case 13:return c="\n        Update 水费字典用水形式 set 用水形式=:a2 where 用水形式编号=:a1 \n        ",e.next=16,M.query(c,{replacements:s,type:M.QueryTypes.UPDATE});case 16:n=e.sent;case 17:return e.abrupt("return",n);case 18:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),p=function(){var e=(0,u.default)(a.default.mark(function e(t,r){var n,u;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.num,e.prev=1,e.next=4,l(n);case 4:u=e.sent,D.ResourceFound(r,u),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),D.InternalServerError(r,e.t0,{});case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),l=function(){var e=(0,u.default)(a.default.mark(function e(t){var r,n;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r="\n    delete from 水费字典用水形式 where 用水形式编号=:num\n    ",e.next=3,M.query(r,{replacements:{num:t},type:M.QueryTypes.DELETE});case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),f=function(){var e=(0,u.default)(a.default.mark(function e(t,r){var n;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,d();case 3:n=e.sent,D.ResourceFound(r,n),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),D.InternalServerError(r,e.t0,{});case 10:case"end":return e.stop()}},e,this,[[0,7]])}));return function(t,r){return e.apply(this,arguments)}}(),d=function(){var e=(0,u.default)(a.default.mark(function e(){var t,r;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t="\n    Select * from 水费字典收费形式 order by 收费形式编号\n    ",e.next=3,M.query(t,{replacements:{},type:M.QueryTypes.SELECT});case 3:return r=e.sent,e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),y=function(){var e=(0,u.default)(a.default.mark(function e(t,r){var n,u;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,h(n);case 4:u=e.sent,D.ResourceFound(r,u),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),D.InternalServerError(r,e.t0,{});case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),h=function(){var e=(0,u.default)(a.default.mark(function e(t){var r,n,u,s,o,c;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=void 0,n=void 0,u="\n    Select *  from 水费字典收费形式   where 收费形式编号 =:num\n    ",e.next=4,M.query(u,{replacements:{num:t.收费形式编号},type:M.QueryTypes.SELECT});case 4:if(r=e.sent,s={a1:t.收费形式编号,a2:t.收费形式},0!==r.length){e.next=13;break}return o="\n        insert into 水费字典收费形式 (收费形式编号,收费形式) values(:a1,:a2)\n        ",e.next=10,M.query(o,{replacements:s,type:M.QueryTypes.INSERT});case 10:n=e.sent,e.next=17;break;case 13:return c="\n        Update 水费字典收费形式 set 收费形式=:a2 where 收费形式编号=:a1\n        ",e.next=16,M.query(c,{replacements:s,type:M.QueryTypes.UPDATE});case 16:n=e.sent;case 17:return e.abrupt("return",n);case 18:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),m=function(){var e=(0,u.default)(a.default.mark(function e(t,r){var n,u;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.num,e.prev=1,e.next=4,v(n);case 4:u=e.sent,D.ResourceFound(r,u),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),D.InternalServerError(r,e.t0,{});case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),v=function(){var e=(0,u.default)(a.default.mark(function e(t){var r,n;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r="\n    delete from 水费字典收费形式 where 收费形式编号=:num\n    ",e.next=3,M.query(r,{replacements:{num:t},type:M.QueryTypes.DELETE});case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),x=function(){var e=(0,u.default)(a.default.mark(function e(t,r){var n;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,w();case 3:n=e.sent,D.ResourceFound(r,n),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),D.InternalServerError(r,e.t0,{});case 10:case"end":return e.stop()}},e,this,[[0,7]])}));return function(t,r){return e.apply(this,arguments)}}(),w=function(){var e=(0,u.default)(a.default.mark(function e(){var t,r;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t="\n    Select * from 水费字典抄表形式 order by 抄表形式编号\n    ",e.next=3,M.query(t,{replacements:{},type:M.QueryTypes.SELECT});case 3:return r=e.sent,e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),b=function(){var e=(0,u.default)(a.default.mark(function e(t,r){var n,u;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,E(n);case 4:u=e.sent,D.ResourceFound(r,u),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),D.InternalServerError(r,e.t0,{});case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),E=function(){var e=(0,u.default)(a.default.mark(function e(t){var r,n,u,s,o,c;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=void 0,n=void 0,u="\n    Select *  from 水费字典抄表形式   where 抄表形式编号  =:num\n    ",e.next=4,M.query(u,{replacements:{num:t.抄表形式编号},type:M.QueryTypes.SELECT});case 4:if(r=e.sent,s={a1:t.抄表形式编号,a2:t.抄表形式},0!==r.length){e.next=13;break}return o="\n        insert into 水费字典抄表形式 (抄表形式编号,抄表形式) values(:a1,:a2)\n        ",e.next=10,M.query(o,{replacements:s,type:M.QueryTypes.INSERT});case 10:n=e.sent,e.next=17;break;case 13:return c="\n        Update 水费字典抄表形式 set 抄表形式=:a2 where 抄表形式编号=:a1 \n        ",e.next=16,M.query(c,{replacements:s,type:M.QueryTypes.UPDATE});case 16:n=e.sent;case 17:return e.abrupt("return",n);case 18:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),S=function(){var e=(0,u.default)(a.default.mark(function e(t,r){var n,u;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.num,e.prev=1,e.next=4,k(n);case 4:u=e.sent,D.ResourceFound(r,u),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),D.InternalServerError(r,e.t0,{});case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),k=function(){var e=(0,u.default)(a.default.mark(function e(t){var r,n;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r="\n    delete from 水费字典抄表形式 where 抄表形式编号=:num\n    ",e.next=3,M.query(r,{replacements:{num:t},type:M.QueryTypes.DELETE});case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),g=function(){var e=(0,u.default)(a.default.mark(function e(t,r){var n;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T();case 3:n=e.sent,D.ResourceFound(r,n),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),D.InternalServerError(r,e.t0,{});case 10:case"end":return e.stop()}},e,this,[[0,7]])}));return function(t,r){return e.apply(this,arguments)}}(),T=function(){var e=(0,u.default)(a.default.mark(function e(){var t,r;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t="\n    Select * from 水费字典费用标准 order by 区号\n    ",e.next=3,M.query(t,{replacements:{},type:M.QueryTypes.SELECT});case 3:return r=e.sent,e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),F=function(){var e=(0,u.default)(a.default.mark(function e(t,r){var n,u;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,C(n);case 4:u=e.sent,D.ResourceFound(r,u),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),D.InternalServerError(r,e.t0,{});case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),C=function(){var e=(0,u.default)(a.default.mark(function e(t){var r,n,u,s,o,c;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=void 0,n=void 0,u="\n    Select *  from 水费字典费用标准   where 区号 =:num\n    ",e.next=4,M.query(u,{replacements:{num:t.区号},type:M.QueryTypes.SELECT});case 4:if(r=e.sent,s={a1:t.区号,a2:t.单位类别,a3:t.单价,a4:t.超计划,a5:t.排污费单价,a6:t.排污费超额},0!==r.length){e.next=13;break}return o="\n        insert into 水费字典费用标准 (区号,单位类别,单价,超计划,排污费单价,排污费超额) values(:a1,:a2,:a3,:a4,:a5,:a6)\n        ",e.next=10,M.query(o,{replacements:s,type:M.QueryTypes.INSERT});case 10:n=e.sent,e.next=17;break;case 13:return c="\n        Update 水费字典费用标准 set 单位类别=:a2,单价=:a3,超计划=:a4,排污费单价=:a5,排污费超额=:a6 where 区号=:a1 \n        ",e.next=16,M.query(c,{replacements:s,type:M.QueryTypes.UPDATE});case 16:n=e.sent;case 17:return e.abrupt("return",n);case 18:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),q=function(){var e=(0,u.default)(a.default.mark(function e(t,r){var n,u;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.num,e.prev=1,e.next=4,I(n);case 4:u=e.sent,D.ResourceFound(r,u),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),D.InternalServerError(r,e.t0,{});case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),I=function(){var e=(0,u.default)(a.default.mark(function e(t){var r,n;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r="\n    delete from 水费字典费用标准 where 区号=:num\n    ",e.next=3,M.query(r,{replacements:{num:t},type:M.QueryTypes.DELETE});case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),A=function(){var e=(0,u.default)(a.default.mark(function e(t,r){var n;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,L();case 3:n=e.sent,D.ResourceFound(r,n),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),D.InternalServerError(r,e.t0,{});case 10:case"end":return e.stop()}},e,this,[[0,7]])}));return function(t,r){return e.apply(this,arguments)}}(),L=function(){var e=(0,u.default)(a.default.mark(function e(){var t,r;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t="\n    Select * from 水费字典防火标准 order by 防火标准编号\n    ",e.next=3,M.query(t,{replacements:{},type:M.QueryTypes.SELECT});case 3:return r=e.sent,e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),R=function(){var e=(0,u.default)(a.default.mark(function e(t,r){var n,u;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,_(n);case 4:u=e.sent,D.ResourceFound(r,u),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),D.InternalServerError(r,e.t0,{});case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),_=function(){var e=(0,u.default)(a.default.mark(function e(t){var r,n,u,s,o,c;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=void 0,n=void 0,u="\n    Select *  from 水费字典防火标准   where 防火标准编号 =:num\n    ",e.next=4,M.query(u,{replacements:{num:t.防火标准编号},type:M.QueryTypes.SELECT});case 4:if(r=e.sent,s={a1:t.防火标准编号,a2:t.管径,a3:t.防火费},0!==r.length){e.next=13;break}return o="\n        insert into 水费字典防火标准 (防火标准编号,管径,防火费) values(:a1,:a2,:a3)\n        ",e.next=10,M.query(o,{replacements:s,type:M.QueryTypes.INSERT});case 10:n=e.sent,e.next=17;break;case 13:return c="\n        Update 水费字典防火标准 set 管径=:a2,防火费=:a3 where 防火标准编号=:a1\n        ",e.next=16,M.query(c,{replacements:s,type:M.QueryTypes.UPDATE});case 16:n=e.sent;case 17:return e.abrupt("return",n);case 18:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),Q=function(){var e=(0,u.default)(a.default.mark(function e(t,r){var n,u;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.num,e.prev=1,e.next=4,N(n);case 4:u=e.sent,D.ResourceFound(r,u),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),D.InternalServerError(r,e.t0,{});case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),N=function(){var e=(0,u.default)(a.default.mark(function e(t){var r,n;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r="\n    delete from 水费字典防火标准 where 防火标准编号=:num\n    ",e.next=3,M.query(r,{replacements:{num:t},type:M.QueryTypes.DELETE});case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),D=(r(12),r(1)),M=r(8);e.exports.queryUseKind=s,e.exports.createUpdateUseKind=c,e.exports.deleteUseKind=p,e.exports.queryChargeKind=f,e.exports.createUpdateChargeKind=y,e.exports.deleteChargeKind=m,e.exports.queryInputKind=x,e.exports.createUpdateInputKind=b,e.exports.deleteInputKind=S,e.exports.queryChargeStandard=g,e.exports.createUpdateChargeStandard=F,e.exports.deleteChargeStandard=q,e.exports.queryFireStandard=A,e.exports.createUpdateFireStandard=R,e.exports.deleteFireStandard=Q},function(e,t,r){"use strict";var n=r(0).Router(),a=r(226),u=a.ContractToWord,s=a.queryContractByNum,o=a.deleteContract,c=a.SaveFiles,i=a.searchFiles,p=a.TearDownToWord,l=a.queryTearDownByNum,f=a.deleteTearDown,d=a.TearDownComplete;n.post("/word",u),n.post("/teardown/word",p),n.post("/files",c),n.post("/files/search",i),n.get("/contracts/:num",function(e,t,r){var n=e.params.num;s(n,t)}),n.get("/teardown/:num",function(e,t,r){var n=e.params.num;l(n,t)}),n.put("/teardown/:num",d),n.delete("/contracts/:num/:year",o),n.delete("/teardown/:num",f),e.exports=n},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){e[t]&&e[t].length>0&&(e[t]="%"+e[t]+"%")}function u(e,t,r,n,a,u){e[t]&&e[t].length>=1&&(u.push(r),n&&(a[n]=e[t]))}var s=n(r(3)),o=n(r(4)),c=function(){var e=(0,o.default)(s.default.mark(function e(t,r){var n,a;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,p(n);case 4:return a=e.sent,e.next=7,i(a);case 7:r.writeHead(200,[["Content-Type","application/vnd.openxmlformats-officedocument.wordprocessingml.document"]]),r.end(new Buffer(a.buf,"base64")),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),T.InternalServerError(r,e.t0,{});case 14:case"end":return e.stop()}},e,this,[[1,11]])}));return function(t,r){return e.apply(this,arguments)}}(),i=function(){var e=(0,o.default)(s.default.mark(function e(t){var r,n,a,u,o,c,i,p,l,f,d;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.para,n=r.编号,a=r.年份,u=r.user,o=t.item,c=t.savename,i="\n    select 编号 from 水费合同表 where (编号=:num) and (年=:year)           \n    ",e.next=6,F.query(i,{replacements:{num:n,year:a},type:F.QueryTypes.SELECT});case 6:if(p=e.sent,l=g(new Date,"yyyy-mm-dd"),!(p.length>0)){e.next=14;break}return f="\n        update 水费合同表 set  操作员=:a1,操作时间=:a2,文件=:a3\n            where (年=:a4) and (编号=:a5)\n        ",e.next=12,F.query(f,{replacements:{a1:u,a2:l,a3:c,a4:a,a5:n},type:F.QueryTypes.UPDATE});case 12:e.next=17;break;case 14:return d="\n        Insert Into 水费合同表 (编号,户名,年,操作员,操作时间,合同编号,用水指标,文件)\n            Values (:a1,:a2,:a3,:a4,:a5,:a6,:a7,:a8)                \n        ",e.next=17,F.query(d,{replacements:{a1:o.编号,a2:o.户名,a3:a,a4:u,a5:l,a6:o.编号,a7:o.申请水量,a8:c},type:F.QueryTypes.INSERT});case 17:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),p=function(){var e=(0,o.default)(s.default.mark(function e(t){var r,n,a,u;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.编号,e.next=3,I(r);case 3:if(n=e.sent,a={},!(n&&n.length>0)){e.next=20;break}(u=n[0]).帐户地址=u.帐户地址?u.帐户地址:"",u.联系人=u.联系人?u.联系人:"",u.电话=u.电话?u.电话:"",u.开户行行名=u.开户行行名?u.开户行行名:"",u.开户行行号=u.开户行行号?u.开户行行号:"",u.帐号=u.帐号?u.帐号:"",u.业务种类=u.业务种类?u.业务种类:"",u.协议书号=u.协议书号?u.协议书号:"",(a=C("contract",u,!0)).item=u,a.para=t,e.next=21;break;case 20:throw new Error("没有找到对应的用水企业");case 21:return e.abrupt("return",a);case 22:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),l=function(){var e=(0,o.default)(s.default.mark(function e(t,r){var n,a,u,o;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params,a=n.num,u=n.year,e.prev=1,e.next=4,f(a,u);case 4:o=e.sent,T.ResourceFound(r,o),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),T.InternalServerError(r,e.t0,{});case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),f=function(){var e=(0,o.default)(s.default.mark(function e(t,r){var n,a;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n="\n    delete from 水费合同表 where 编号=:num and 年=:year\n    ",e.next=3,F.query(n,{replacements:{num:t,year:r},type:F.QueryTypes.DELETE});case 3:return a=e.sent,e.abrupt("return",a);case 5:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}(),d=function(){var e=(0,o.default)(s.default.mark(function e(t,r){var n,a;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,y(n);case 4:a=e.sent,T.ResourceFound(r,a),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),T.InternalServerError(r,e.t0,{});case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),y=function(){var e=(0,o.default)(s.default.mark(function e(t){var r,n,a,u,o,c,i,p,l,f,d;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.编号,n=t.户名,a=t.名称,u=t.分类,o=t.备注,c=t.fileList,i=t.files,p=t.user,l=g(new Date,"yyyy-mm-dd"),f="\n        Insert Into 企业文档表 (编号,户名,名称,分类,备注,操作员,操作时间,原始文件, 本地文件)\n            Values (:a1,:a2,:a3,:a4,:a5,:a6,:a7,:a8,:a9)                \n        ",e.next=5,F.query(f,{replacements:{a1:r,a2:n,a3:a,a4:u,a5:o||"",a6:p,a7:l,a8:c.join(","),a9:i.join(",")},type:F.QueryTypes.INSERT});case 5:return d=e.sent,e.abrupt("return",d);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),h=function(){var e=(0,o.default)(s.default.mark(function e(t,r){var n,a;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,m(n);case 4:a=e.sent,T.ResourceFound(r,a),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),T.InternalServerError(r,e.t0,n);case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),m=function(){var e=(0,o.default)(s.default.mark(function e(t){var r,n,o,c,i;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r="\n    SELECT * from 企业文档表   \n    ",n={},o=[],a(t,"编号"),a(t,"户名"),a(t,"名称"),a(t,"分类"),u(t,"编号"," (编号 like :num) ","num",n,o),u(t,"户名"," (户名 like :name) ","name",n,o),u(t,"名称"," (名称 like :filename) ","filename",n,o),u(t,"分类"," (分类 like :filecategory) ","filecategory",n,o),c=o.join(" and "),r+=c.length>2?" where "+c:"",e.next=15,F.query(r,{replacements:n,type:F.QueryTypes.SELECT});case 15:return i=e.sent,e.abrupt("return",i);case 17:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),v=function(){var e=(0,o.default)(s.default.mark(function e(t,r){var n,a;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,w(n);case 4:return a=e.sent,e.next=7,x(a);case 7:r.writeHead(200,[["Content-Type","application/vnd.openxmlformats-officedocument.wordprocessingml.document"]]),r.end(new Buffer(a.buf,"base64")),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),T.InternalServerError(r,e.t0,{});case 14:case"end":return e.stop()}},e,this,[[1,11]])}));return function(t,r){return e.apply(this,arguments)}}(),x=function(){var e=(0,o.default)(s.default.mark(function e(t){var r,n,a,u,o,c,i,p,l,f;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.para,n=r.编号,a=r.user,u=t.item,o=t.savename,c="\n    select 编号 from 终止供水合同表 where (编号=:num)          \n    ",e.next=6,F.query(c,{replacements:{num:n},type:F.QueryTypes.SELECT});case 6:if(i=e.sent,p=g(new Date,"yyyy-mm-dd"),!(i.length>0)){e.next=14;break}return l="\n        update 终止供水合同表 set  操作员=:a1,操作时间=:a2,文件=:a3,完成时间=:a4,状态=:a5\n            where 编号=:a7 \n        ",e.next=12,F.query(l,{replacements:{a1:a,a2:p,a3:o,a4:"",a5:"已提交申请",a7:n},type:F.QueryTypes.UPDATE});case 12:e.next=17;break;case 14:return f="\n        Insert Into 终止供水合同表 (编号,户名,操作员,操作时间,状态,完成时间,文件)\n            Values (:a1,:a2,:a3,:a4,:a5,:a6,:a7)                \n        ",e.next=17,F.query(f,{replacements:{a1:u.编号,a2:u.户名,a3:a,a4:p,a5:"已提交申请",a6:"",a7:o},type:F.QueryTypes.INSERT});case 17:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),w=function(){var e=(0,o.default)(s.default.mark(function e(t){var r,n,a,u,o,c;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.编号,e.next=3,A(r);case 3:if(n=e.sent,a={},!(n&&n.length>0)){e.next=16;break}for((u={}).items=[],o=n[0],u.户名=o.户名?o.户名:"",c=1;c<=n.length;c++)u.items.push({index:c,"编号":n[c-1].编号});(a=C("teardown",u,!0)).item=o,a.para=t,e.next=17;break;case 16:throw new Error("没有找到对应的用水企业");case 17:return e.abrupt("return",a);case 18:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),b=function(){var e=(0,o.default)(s.default.mark(function e(t,r){var n,a;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.num,e.prev=1,e.next=4,E(n);case 4:a=e.sent,T.ResourceFound(r,a),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),T.InternalServerError(r,e.t0,{});case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),E=function(){var e=(0,o.default)(s.default.mark(function e(t){var r,n;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=g(new Date,"yyyy-mm-dd"),n="\n        update 终止供水合同表 set  完成时间=:a1,状态=:a2\n            where 编号=:a3 \n        ",e.next=4,F.query(n,{replacements:{a1:r,a2:"完成",a3:t},type:F.QueryTypes.UPDATE});case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),S=function(){var e=(0,o.default)(s.default.mark(function e(t,r){var n,a;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.num,e.prev=1,e.next=4,k(n);case 4:a=e.sent,T.ResourceFound(r,a),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),T.InternalServerError(r,e.t0,{});case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),k=function(){var e=(0,o.default)(s.default.mark(function e(t,r){var n,a;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n="\n    delete from 终止供水合同表 where 编号=:num\n    ",e.next=3,F.query(n,{replacements:{num:t,year:r},type:F.QueryTypes.DELETE});case 3:return a=e.sent,e.abrupt("return",a);case 5:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}(),g=r(12),T=r(1),F=r(8),C=r(53).toWord,q=r(52),I=q.queryUnitByNumImpt,A=q.queryUnitByDownNumImpt;e.exports.ContractToWord=c,e.exports.queryContractByNum=function(e,t){F.query("\n    Select * from 水费合同表  where (编号=:a1) \n    ",{replacements:{a1:e},type:F.QueryTypes.SELECT}).then(function(r){r.length>0?T.ResourceFound(t,r):T.ResourceNotFound(t,{num:e})}).catch(function(r){T.InternalServerError(t,r,{num:e})})},e.exports.deleteContract=l,e.exports.SaveFiles=d,e.exports.searchFiles=h,e.exports.TearDownToWord=v,e.exports.queryTearDownByNum=function(e,t){"undefined"!==e?F.query("\n        Select * from 终止供水合同表  where (编号=:a1) \n        ",{replacements:{a1:e},type:F.QueryTypes.SELECT}).then(function(r){r.length>0?T.ResourceFound(t,r):T.ResourceNotFound(t,{num:e})}).catch(function(r){T.InternalServerError(t,r,{num:e})}):F.query("\n        Select * from 终止供水合同表\n        ",{replacements:{},type:F.QueryTypes.SELECT}).then(function(r){r.length>0?T.ResourceFound(t,r):T.ResourceNotFound(t,{num:e})}).catch(function(r){T.InternalServerError(t,r,{num:e})})},e.exports.TearDownComplete=b,e.exports.deleteTearDown=S},function(e,t,r){"use strict";var n=r(0).Router(),a=r(9);n.get("/contract/:name",function(e,t,r){var n=e.params.name,u=a.join("./","output","word",n+".docx");t.download(u)}),n.get("/contract/html/:name",function(e,t,r){var n=e.params.name,u=a.join("./","output","word",n+".docx");t.download(u)}),n.get("/file/:name",function(e,t,r){var n=e.params.name,u=a.join("./","uploadfiles",n);t.download(u)}),e.exports=n},function(e,t,r){"use strict";var n=r(0).Router(),a=r(229),u=a.queryReminder,s=a.sendReminderSMS,o=a.ReminderToWord;n.get("/items/:ss/:ee",u),n.post("/sms",s),n.post("/:category/word",o),e.exports=n},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return parseFloat((e+t).toFixed(10))}function u(e,t){var r=t.月,n=t.年,a=void 0;a=w("12"===r?"01-10-"+(parseInt(n)+1):parseInt(r)+1+"-10-"+n,"MM-DD-YYYY");var u=e.diff(a,"days"),s=function(e,t,r){for(var n=parseFloat(e),a=1;a<=r;a++)n*=1+t;return n}(t.实收水费,T,u);return s-=parseFloat(t.实收水费),s=Math.round(100*s)/100}var s=n(r(50)),o=n(r(48)),c=n(r(49)),i=n(r(3)),p=n(r(4)),l=function(){var e=(0,p.default)(i.default.mark(function e(t,r){var n,a,u,s;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params,a=n.ss,u=n.ee,e.prev=1,e.next=4,f(a,u);case 4:s=e.sent,E.ResourceFound(r,s),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),E.InternalServerError(r,e.t0,{ss:a,ee:u});case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),f=function(){var e=(0,p.default)(i.default.mark(function e(t,r){var n,s,p,l,f,d,y,h,m,v,x;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=void 0,s=w(),p="\n    select 编号, 户名, 年, 月, 实收水费\n        from dbo.水费基本表\n        where (年+月>=:date1) and (年+月<=:date2) and 欠费标志 = '2'\n        order by 编号, 年,月\n    ",e.next=5,k.query(p,{replacements:{date1:t,date2:r},type:k.QueryTypes.SELECT});case 5:for(n=e.sent,l=new c.default,n.forEach(function(e){var t=e.编号;if(l.has(t)){var r=u(s,e),n=l.get(t);n.年1=parseInt(n.年1)>parseInt(e.年)?e.年:n.年1,n.月1=parseInt(n.年1)>=parseInt(e.年)&&parseInt(n.月1)>=parseInt(e.月)?e.月:n.月1,n.年2=parseInt(n.年1)<parseInt(e.年)?e.年:n.年1,n.月2=parseInt(n.年1)<=parseInt(e.年)&&parseInt(n.月1)<=parseInt(e.月)?e.月:n.月1,n.实收水费+=e.实收水费,n.滞纳金+=r,n.合计+=a(e.实收水费,r),n.月数+=1}else{var o=u(s,e);l.set(t,{"编号":e.编号,"户名":e.户名,"年1":e.年,"月1":e.月,"年2":e.年,"月2":e.月,"实收水费":e.实收水费,"滞纳金":o,"合计":a(e.实收水费,o),"月数":1})}}),f=[],d=!0,y=!1,h=void 0,e.prev=12,m=(0,o.default)(l);!(d=(v=m.next()).done);d=!0)x=v.value,f.push(x[1]);e.next=20;break;case 16:e.prev=16,e.t0=e.catch(12),y=!0,h=e.t0;case 20:e.prev=20,e.prev=21,!d&&m.return&&m.return();case 23:if(e.prev=23,!y){e.next=26;break}throw h;case 26:return e.finish(23);case 27:return e.finish(20);case 28:return e.abrupt("return",f);case 29:case"end":return e.stop()}},e,this,[[12,16,20,28],[21,,23,27]])}));return function(t,r){return e.apply(this,arguments)}}(),d=function(){var e=(0,p.default)(i.default.mark(function e(t,r){var n,a;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body||{},e.prev=1,e.next=4,y(n);case 4:a=e.sent,E.ResourceFound(r,a),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),E.InternalServerError(r,e.t0,{obj:n});case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),y=function(){var e=(0,p.default)(i.default.mark(function e(t){var r,n,a,u,o,c,p=this;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return void 0,r=t.length,n=function(e,t){return e.map(function(e){return e[t]})}(t,"编号"),e.next=5,h(n);case 5:a=e.sent,u=[],o=i.default.mark(function e(r){var n,o,c;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t[r],!((o=a.find(function(e){return e.编号===n.编号}))&&o.托收联系人&&o.托收电话)){e.next=9;break}return e.next=5,S(o.托收电话,"迄今为止贵企业共欠"+n.月数+"个月水费,金额为"+n.实收水费+",滞纳金为"+n.滞纳金+",合计"+n.合计+",请尽快缴清。");case 5:c=e.sent,u.push((0,s.default)({},n,{desc:c.data})),e.next=10;break;case 9:u.push((0,s.default)({},n,{desc:"error:Missing recipient"}));case 10:case"end":return e.stop()}},e,p)}),c=0;case 9:if(!(c<r)){e.next=14;break}return e.delegateYield(o(c),"t0",11);case 11:c++,e.next=9;break;case 14:return e.abrupt("return",u);case 15:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),h=function(){var e=(0,p.default)(i.default.mark(function e(t){var r,n;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r="\n    select 编号, 托收联系人, 托收电话\n        from dbo.水费单位信息 \n        where 编号 in ("+t.join(",")+")\n    ",e.next=3,k.query(r,{replacements:{},type:k.QueryTypes.SELECT});case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),m=function(){var e=(0,p.default)(i.default.mark(function e(t,r){var n,a,u;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.category,a=t.body||{},e.prev=2,e.next=5,v(a,n);case 5:u=e.sent,r.writeHead(200,[["Content-Type","application/vnd.openxmlformats-officedocument.wordprocessingml.document"]]),r.end(new Buffer(u.buf,"base64")),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2),E.InternalServerError(r,e.t0,{});case 13:case"end":return e.stop()}},e,this,[[2,10]])}));return function(t,r){return e.apply(this,arguments)}}(),v=function(){var e=(0,p.default)(i.default.mark(function e(t,r){var n,a,u;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=x(new Date,"yyyy-mm-dd").split("-"),t.forEach(function(e){e.年=n[0],e.月=n[1],e.日=n[2],e.break='</w:p><w:p><w:br w:type="page" /></w:p>'}),t[t.length-1].break="",a={items:t},u=g(r,a,!1),e.abrupt("return",u);case 6:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}(),x=r(12),w=(r(88),r(90)),b=r(91),E=r(1),S=r(92).sendSMS,k=r(8),g=r(53).toWord,T=.005;e.exports.queryReminder=l,b.config({DECIMAL_PLACES:2}),e.exports.sendReminderSMS=d,e.exports.ReminderToWord=m},function(e,t,r){"use strict";var n=r(231),a=r(0).Router();a.use("/mobile",n),e.exports=a},function(e,t,r){"use strict";var n=r(0),a=r(83),u=a.queryWaterFees,s=a.calculateWaterFee,o=a.saveWaterFees,c=n.Router();c.get("/fees/:year/:month/:type",function(e,t,r){var n=e.params,a=n.year,s=n.month,o=n.type;u(a,s,o,t)}),c.post("/calfee",s),c.put("/fees",o),e.exports=c}]);